import{a as O}from"./chunk-F34TZV5U.js";import{a as y}from"./chunk-WKMSXF5P.js";import{A as v,B as T,C as c,E as p,G as d,I as t,J as l,x as _,z as S}from"./chunk-QFAIQ2LR.js";import{$ as A,ea as f}from"./chunk-7EJ4QSIG.js";import{a as s,g as n}from"./chunk-RA2WU32H.js";var P=class h{firestore=f(_);disponibilidadService=f(O);auth_service=f(y);colTurnos=T(this.firestore,"Turnos");colUsuarios=T(this.firestore,"Usuarios");constructor(){}getEspecialistas(){let a=d(this.colUsuarios,l("rol","==","especialista"));return S(a,{idField:"uid"})}getAllTurnos(){return n(this,null,function*(){return(yield p(this.colTurnos)).docs.map(i=>{let e=i.data();return s(s(s(s(s(s({uid:i.id,id_especialista:e.id_especialista,especialista:e.especialista,id_paciente:e.id_paciente,paciente:e.paciente,especialidad:e.especialidad,fecha:e.fecha,hora:e.hora,fecha_emision:e.fecha_emision,estado:e.estado},e.resenia&&{resenia:e.resenia}),e.encuesta&&{encuesta:e.encuesta}),e.clasificacion&&{clasificacion:e.clasificacion}),e.diagnostico&&{diagnostico:e.diagnostico}),e.comentario_especialista&&{comentario_especialista:e.comentario_especialista}),e.comentario_paciente&&{comentario_paciente:e.comentario_paciente})})})}crearTurno(a){return n(this,null,function*(){return yield v(this.colTurnos,a)})}getTurnosPorFiltros(a){return n(this,null,function*(){let o=this.colTurnos;return a.forEach(e=>{let u=e.valor;(e.columna==="id_paciente"||e.columna==="id_especialista")&&typeof e.valor=="string"?(u=c(this.firestore,"Usuarios",e.valor),console.log("la columna es: ",e.columna)):(console.log("ERROR la columna es: ",e.columna),console.log(u)),o=d(o,l(e.columna,"==",u))}),(yield p(o)).docs.map(e=>s({uid:e.id},e.data()))})}getTurnosDisponibles(a,o){return n(this,null,function*(){let e=(yield p(d(this.colUsuarios,l("rol","==","Especialista"),l("especialidad","array-contains",o),l("activo","==",!0)))).docs.map(r=>s({uid:r.id},r.data())),u=[],I=this.obtenerDiaSemana(a);for(let r of e){let D=r.disponibilidad?.[o]?.[I]||[];for(let m of D){let N=m.totalTurnos||1,[R,U]=m.desde.split(":").map(Number),j=30,L=R*60+U;for(let w=0;w<N;w++){let E=L+j*w,b=Math.floor(E/60),z=E%60,g=`${b.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`;if(!r?.uid)throw new Error("El especialista no tiene UID definido");(yield p(d(this.colTurnos,l("id_especialista","==",c(this.firestore,"Usuarios",r.uid)),l("fecha","==",a),l("hora","==",g)))).empty?u.push({id_especialista:c(this.firestore,"Usuarios",r.uid),especialista:`${r.Apellido} ${r.Nombre}`,id_paciente:null,paciente:"Disponible",especialidad:o,fecha:a,hora:g,estado:"disponible",fecha_emision:new Date}):console.log("turnoOcupado!!!!")}}}return u})}obtenerDiaSemana(a){if(a.includes("-")){let[I,r,D]=a.split("-").map(Number),m=new Date(I,r-1,D);return["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"][m.getDay()]}let[o,i,e]=a.split("/").map(Number),u=new Date(e,i-1,o);return["domingo","lunes","martes","mi\xE9rcoles","jueves","viernes","s\xE1bado"][u.getDay()]}settearEstadoTurno(a,o){return n(this,null,function*(){if(!a.uid)throw new Error("El turno no tiene UID, no se puede actualizar.");let i=c(this.firestore,"Turnos",a.uid);yield t(i,{estado:o})})}settearEstadoTurnov2(a,o,i){return n(this,null,function*(){if(!a.uid)throw new Error("El turno no tiene UID.");let e=c(this.firestore,"Turnos",a.uid);switch(o){case"finalizado":if(!i||!i.diagnostico)throw new Error("Para finalizar un turno debes proporcionar un diagn\xF3stico.");yield t(e,{estado:o,diagnostico:i.diagnostico});break;case"cancelado_paciente":if(!i||!i.comentario||i.comentario.length<3)throw new Error("Para cancelar un turno es necesaria una raz\xF3n.");yield t(e,{estado:o,comentario_paciente:i.comentario});break;case"cancelado_especialista":if(!i||!i.comentario||i.comentario.length<3)throw new Error("Para cancelar un turno es necesaria una raz\xF3n.");yield t(e,{estado:o,comentario_especialista:i.comentario});break;case"rechazado":if(!i||!i.comentario||i.comentario.length<3)throw new Error("Para rechazar un turno es necesario dejar un comentario.");yield t(e,{estado:o,comentario_especialista:i.comentario});break;case"rechazado_administracion":if(!i||!i.comentario||i.comentario.length<3)throw new Error("Para rechazar un turno es necesario dejar un comentario.");yield t(e,{estado:o,comentario_administracion:i.comentario});break;default:yield t(e,{estado:o});break}})}settearClasificacion(a,o){return n(this,null,function*(){if(!a.uid)throw new Error("El turno no tiene UID.");let i=c(this.firestore,"Turnos",a.uid);yield t(i,{clasificacion:o})})}settearResenia(a,o){return n(this,null,function*(){if(!a.uid)throw new Error("El turno no tiene UID.");let i=c(this.firestore,"Turnos",a.uid);yield t(i,{resenia:o})})}settearEncuesta(a,o){return n(this,null,function*(){if(!a.uid)throw new Error("El turno no tiene UID.");let i=c(this.firestore,"Turnos",a.uid);yield t(i,{resenia:o})})}static \u0275fac=function(o){return new(o||h)};static \u0275prov=A({token:h,factory:h.\u0275fac,providedIn:"root"})};export{P as a};
