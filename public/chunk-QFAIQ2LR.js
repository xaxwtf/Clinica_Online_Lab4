import{$ as vh,Ec as xo,Ga as Eh,W as _h,X as yh,Y as No,c as it,ca as In,cb as ze,ea as je,fa as En,h as mh,ha as Ih,i as gh,ia as wi,k as Po,l as Co,m as ko,na as wt,pa as Oo,s as Do,ua as Vo,wa as Ti,wc as wh,xa as Ne}from"./chunk-7EJ4QSIG.js";import{a as So,b as Ro,f as Et,g as I}from"./chunk-RA2WU32H.js";var Th=()=>{};var Sh=function(n){let e=[],t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},vg=function(n){let e=[],t=0,r=0;for(;t<n.length;){let i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){let o=n[t++];e[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){let o=n[t++],a=n[t++],u=n[t++],l=((i&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{let o=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Ai={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let o=n[i],a=i+1<n.length,u=a?n[i+1]:0,l=i+2<n.length,d=l?n[i+2]:0,p=o>>2,g=(o&3)<<4|u>>4,v=(u&15)<<2|d>>6,R=d&63;l||(R=64,a||(v=64)),r.push(t[p],t[g],t[v],t[R])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Sh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):vg(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let o=t[n.charAt(i++)],u=i<n.length?t[n.charAt(i)]:0;++i;let d=i<n.length?t[n.charAt(i)]:64;++i;let g=i<n.length?t[n.charAt(i)]:64;if(++i,o==null||u==null||d==null||g==null)throw new Mo;let v=o<<2|u>>4;if(r.push(v),d!==64){let R=u<<4&240|d>>2;if(r.push(R),g!==64){let k=d<<6&192|g;r.push(k)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Mo=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Ig=function(n){let e=Sh(n);return Ai.encodeByteArray(e,!0)},yr=function(n){return Ig(n).replace(/\./g,"")},bi=function(n){try{return Ai.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Uo(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Eg=()=>Uo().__FIREBASE_DEFAULTS__,wg=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Tg=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&bi(n[1]);return e&&JSON.parse(e)},Si=()=>{try{return Th()||Eg()||wg()||Tg()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Bo=n=>{var e,t;return(t=(e=Si())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Rh=n=>{let e=Bo(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},qo=()=>{var n;return(n=Si())===null||n===void 0?void 0:n.config},$o=n=>{var e;return(e=Si())===null||e===void 0?void 0:e[`_${n}`]};var Gt=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}};function Tt(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Ri(n){return I(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Ph(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[yr(JSON.stringify(t)),yr(JSON.stringify(a)),""].join(".")}var _r={};function Ag(){let n={prod:[],emulator:[]};for(let e of Object.keys(_r))_r[e]?n.emulator.push(e):n.prod.push(e);return n}function bg(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Ah=!1;function Pi(n,e){if(typeof window>"u"||typeof document>"u"||!Tt(window.location.host)||_r[n]===e||_r[n]||Ah)return;_r[n]=e;function t(v){return`__firebase__banner__${v}`}let r="__firebase__banner",o=Ag().prod.length>0;function a(){let v=document.getElementById(r);v&&v.remove()}function u(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function l(v,R){v.setAttribute("width","24"),v.setAttribute("id",R),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function d(){let v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{Ah=!0,a()},v}function p(v,R){v.setAttribute("id",R),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function g(){let v=bg(r),R=t("text"),k=document.getElementById(R)||document.createElement("span"),V=t("learnmore"),D=document.getElementById(V)||document.createElement("a"),$=t("preprendIcon"),U=document.getElementById($)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){let j=v.element;u(j),p(D,V);let Y=d();l(U,$),j.append(U,k,D,Y),document.body.appendChild(j)}o?(k.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,k.innerText="Preview backend running in this workspace."),k.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function de(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ch(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(de())}function Sg(){var n;let e=(n=Si())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Dh(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Nh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Oh(){let n=de();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Vh(){return!Sg()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function vr(){try{return typeof indexedDB=="object"}catch{return!1}}function xh(){return new Promise((n,e)=>{try{let t=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var o;e(((o=i.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}var Rg="FirebaseError",Pe=class n extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Rg,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Me.prototype.create)}},Me=class{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},i=`${this.service}/${e}`,o=this.errors[e],a=o?Pg(o,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new Pe(i,u,r)}};function Pg(n,e){return n.replace(Cg,(t,r)=>{let i=e[r];return i!=null?String(i):`<${r}?>`})}var Cg=/\{\$([^}]+)}/g;function Lh(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function We(n,e){if(n===e)return!0;let t=Object.keys(n),r=Object.keys(e);for(let i of t){if(!r.includes(i))return!1;let o=n[i],a=e[i];if(bh(o)&&bh(a)){if(!We(o,a))return!1}else if(o!==a)return!1}for(let i of r)if(!t.includes(i))return!1;return!0}function bh(n){return n!==null&&typeof n=="object"}function Ir(n){let e=[];for(let[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Mh(n,e){let t=new Fo(n,e);return t.subscribe.bind(t)}var Fo=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");kg(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Lo),i.error===void 0&&(i.error=Lo),i.complete===void 0&&(i.complete=Lo);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),o}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function kg(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Lo(){}var Zw=14400*1e3;function se(n){return n&&n._delegate?n._delegate:n}var Se=class{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var Kt="[DEFAULT]";var jo=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let r=new Gt;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(e?.identifier),i=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ng(e))try{this.getOrInitializeService({instanceIdentifier:Kt})}catch{}for(let[t,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(t);try{let o=this.getOrInitializeService({instanceIdentifier:i});r.resolve(o)}catch{}}}}clearInstance(e=Kt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return I(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=Kt){return this.instances.has(e)}getOptions(e=Kt){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[o,a]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(i)}return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(e),this.onInitCallbacks.set(i,o);let a=this.instances.get(i);return a&&e(a,i),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Dg(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Kt){return this.component?this.component.multipleInstances?e:Kt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Dg(n){return n===Kt?void 0:n}function Ng(n){return n.instantiationMode==="EAGER"}var Ci=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new jo(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var Og=[],W=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(W||{}),Vg={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},xg=W.INFO,Lg={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},Mg=(n,e,...t)=>{if(e<n.logLevel)return;let r=new Date().toISOString(),i=Lg[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Ge=class{constructor(e){this.name=e,this._logLevel=xg,this._logHandler=Mg,this._userLogHandler=null,Og.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in W))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Vg[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...e),this._logHandler(this,W.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...e),this._logHandler(this,W.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,W.INFO,...e),this._logHandler(this,W.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,W.WARN,...e),this._logHandler(this,W.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...e),this._logHandler(this,W.ERROR,...e)}};var Fg=(n,e)=>e.some(t=>n instanceof t),Fh,Uh;function Ug(){return Fh||(Fh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Bg(){return Uh||(Uh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Bh=new WeakMap,Wo=new WeakMap,qh=new WeakMap,zo=new WeakMap,Ko=new WeakMap;function qg(n){let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(Ke(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Bh.set(t,n)}).catch(()=>{}),Ko.set(e,n),e}function $g(n){if(Wo.has(n))return;let e=new Promise((t,r)=>{let i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Wo.set(n,e)}var Go={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Wo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||qh.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ke(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function $h(n){Go=n(Go)}function jg(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let r=n.call(ki(this),e,...t);return qh.set(r,e.sort?e.sort():[e]),Ke(r)}:Bg().includes(n)?function(...e){return n.apply(ki(this),e),Ke(Bh.get(this))}:function(...e){return Ke(n.apply(ki(this),e))}}function zg(n){return typeof n=="function"?jg(n):(n instanceof IDBTransaction&&$g(n),Fg(n,Ug())?new Proxy(n,Go):n)}function Ke(n){if(n instanceof IDBRequest)return qg(n);if(zo.has(n))return zo.get(n);let e=zg(n);return e!==n&&(zo.set(n,e),Ko.set(e,n)),e}var ki=n=>Ko.get(n);function zh(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(n,e),u=Ke(a);return r&&a.addEventListener("upgradeneeded",l=>{r(Ke(a.result),l.oldVersion,l.newVersion,Ke(a.transaction),l)}),t&&a.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),u.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var Wg=["get","getKey","getAll","getAllKeys","count"],Gg=["put","add","delete","clear"],Ho=new Map;function jh(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ho.get(e))return Ho.get(e);let t=e.replace(/FromIndex$/,""),r=e!==t,i=Gg.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Wg.includes(t)))return;let o=function(a,...u){return I(this,null,function*(){let l=this.transaction(a,i?"readwrite":"readonly"),d=l.store;return r&&(d=d.index(u.shift())),(yield Promise.all([d[t](...u),i&&l.done]))[0]})};return Ho.set(e,o),o}$h(n=>Ro(So({},n),{get:(e,t,r)=>jh(e,t)||n.get(e,t,r),has:(e,t)=>!!jh(e,t)||n.has(e,t)}));var Jo=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Kg(t)){let r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}};function Kg(n){let e=n.getComponent();return e?.type==="VERSION"}var Yo="@firebase/app",Wh="0.13.2";var st=new Ge("@firebase/app"),Hg="@firebase/app-compat",Qg="@firebase/analytics-compat",Jg="@firebase/analytics",Yg="@firebase/app-check-compat",Xg="@firebase/app-check",Zg="@firebase/auth",e_="@firebase/auth-compat",t_="@firebase/database",n_="@firebase/data-connect",r_="@firebase/database-compat",i_="@firebase/functions",s_="@firebase/functions-compat",o_="@firebase/installations",a_="@firebase/installations-compat",c_="@firebase/messaging",u_="@firebase/messaging-compat",l_="@firebase/performance",h_="@firebase/performance-compat",d_="@firebase/remote-config",f_="@firebase/remote-config-compat",p_="@firebase/storage",m_="@firebase/storage-compat",g_="@firebase/firestore",__="@firebase/ai",y_="@firebase/firestore-compat",v_="firebase",I_="11.10.0";var Xo="[DEFAULT]",E_={[Yo]:"fire-core",[Hg]:"fire-core-compat",[Jg]:"fire-analytics",[Qg]:"fire-analytics-compat",[Xg]:"fire-app-check",[Yg]:"fire-app-check-compat",[Zg]:"fire-auth",[e_]:"fire-auth-compat",[t_]:"fire-rtdb",[n_]:"fire-data-connect",[r_]:"fire-rtdb-compat",[i_]:"fire-fn",[s_]:"fire-fn-compat",[o_]:"fire-iid",[a_]:"fire-iid-compat",[c_]:"fire-fcm",[u_]:"fire-fcm-compat",[l_]:"fire-perf",[h_]:"fire-perf-compat",[d_]:"fire-rc",[f_]:"fire-rc-compat",[p_]:"fire-gcs",[m_]:"fire-gcs-compat",[g_]:"fire-fst",[y_]:"fire-fst-compat",[__]:"fire-vertex","fire-js":"fire-js",[v_]:"fire-js-all"};var Er=new Map,w_=new Map,Zo=new Map;function Gh(n,e){try{n.container.addComponent(e)}catch(t){st.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Fe(n){let e=n.name;if(Zo.has(e))return st.debug(`There were multiple attempts to register component ${e}.`),!1;Zo.set(e,n);for(let t of Er.values())Gh(t,n);for(let t of w_.values())Gh(t,n);return!0}function wn(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Oe(n){return n==null?!1:n.settings!==void 0}var T_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},At=new Me("app","Firebase",T_);var ea=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Se("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw At.create("app-deleted",{appName:this._name})}};var bt=I_;function ra(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let r=Object.assign({name:Xo,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw At.create("bad-app-name",{appName:String(i)});if(t||(t=qo()),!t)throw At.create("no-options");let o=Er.get(i);if(o){if(We(t,o.options)&&We(r,o.config))return o;throw At.create("duplicate-app",{appName:i})}let a=new Ci(i);for(let l of Zo.values())a.addComponent(l);let u=new ea(t,r,a);return Er.set(i,u),u}function Ht(n=Xo){let e=Er.get(n);if(!e&&n===Xo&&qo())return ra();if(!e)throw At.create("no-app",{appName:n});return e}function Di(){return Array.from(Er.values())}function re(n,e,t){var r;let i=(r=E_[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);let o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){let u=[`Unable to register library "${i}" with version "${e}":`];o&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),st.warn(u.join(" "));return}Fe(new Se(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}var A_="firebase-heartbeat-database",b_=1,wr="firebase-heartbeat-store",Qo=null;function Jh(){return Qo||(Qo=zh(A_,b_,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(wr)}catch(t){console.warn(t)}}}}).catch(n=>{throw At.create("idb-open",{originalErrorMessage:n.message})})),Qo}function S_(n){return I(this,null,function*(){try{let t=(yield Jh()).transaction(wr),r=yield t.objectStore(wr).get(Yh(n));return yield t.done,r}catch(e){if(e instanceof Pe)st.warn(e.message);else{let t=At.create("idb-get",{originalErrorMessage:e?.message});st.warn(t.message)}}})}function Kh(n,e){return I(this,null,function*(){try{let r=(yield Jh()).transaction(wr,"readwrite");yield r.objectStore(wr).put(e,Yh(n)),yield r.done}catch(t){if(t instanceof Pe)st.warn(t.message);else{let r=At.create("idb-set",{originalErrorMessage:t?.message});st.warn(r.message)}}})}function Yh(n){return`${n.name}!${n.options.appId}`}var R_=1024,P_=30,ta=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new na(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return I(this,null,function*(){var e,t;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Hh();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:i}),this._heartbeatsCache.heartbeats.length>P_){let a=k_(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){st.warn(r)}})}getHeartbeatsHeader(){return I(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=Hh(),{heartbeatsToSend:r,unsentEntries:i}=C_(this._heartbeatsCache.heartbeats),o=yr(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return st.warn(t),""}})}};function Hh(){return new Date().toISOString().substring(0,10)}function C_(n,e=R_){let t=[],r=n.slice();for(let i of n){let o=t.find(a=>a.agent===i.agent);if(o){if(o.dates.push(i.date),Qh(t)>e){o.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),Qh(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}var na=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return I(this,null,function*(){return vr()?xh().then(()=>!0).catch(()=>!1):!1})}read(){return I(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield S_(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return I(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Kh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return I(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Kh(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return})}};function Qh(n){return yr(JSON.stringify({version:2,heartbeats:n})).length}function k_(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function D_(n){Fe(new Se("platform-logger",e=>new Jo(e),"PRIVATE")),Fe(new Se("heartbeat",e=>new ta(e),"PRIVATE")),re(Yo,Wh,n),re(Yo,Wh,"esm2017"),re("fire-js","")}D_("");var N_="firebase",O_="11.10.0";re(N_,O_,"app");function LT(n,e){let r=!e?.manualCleanup?e?.injector?.get(Oo)??je(Oo):null,i=V_(e?.equal),o;e?.requireSync?o=Vo({kind:0},{equal:i}):o=Vo({kind:1,value:e?.initialValue},{equal:i});let a,u=n.subscribe({next:l=>o.set({kind:1,value:l}),error:l=>{o.set({kind:2,error:l}),a?.()},complete:()=>{a?.()}});if(e?.requireSync&&o().kind===0)throw new No(601,!1);return a=r?.onDestroy(u.unsubscribe.bind(u)),wh(()=>{let l=o();switch(l.kind){case 1:return l.value;case 2:throw l.error;case 0:throw new No(601,!1)}},{equal:e?.equal})}function V_(n=Object.is){return(e,t)=>e.kind===1&&t.kind===1&&n(e.value,t.value)}function Xh(n){n===void 0&&(n=je(wt));let e=n.get(Ti);return t=>new it(r=>{let i=e.add(),o=!1;function a(){o||(i(),o=!0)}let u=t.subscribe({next:l=>{r.next(l),a()},complete:()=>{r.complete(),a()},error:l=>{r.error(l),a()}});return u.add(()=>{r.unsubscribe(),a()}),u})}var St=new _h("ANGULARFIRE2_VERSION");function Tr(n,e,t){if(e){if(e.length===1)return e[0];let o=e.filter(a=>a.app===t);if(o.length===1)return o[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var An=(n,e)=>{let t=e?[e]:Di(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(a=>{r.includes(a)||r.push(a)})}),r},Tn=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(Tn||{}),Zh=xo()&&typeof Zone<"u"?Tn.WARN:Tn.SILENT;var Ni=class{zone;delegate;constructor(e,t=gh){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,o=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(o,t,r)}},Rt=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=je(ze);this.outsideAngular=t.runOutsideAngular(()=>new Ni(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new Ni(typeof Zone>"u"?void 0:Zone.current,mh))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=vh({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),ed=!1;function x_(n,e){!ed&&(Zh>Tn.SILENT||xo())&&(ed=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Zh>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function L_(n){let e=je(ze,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Qt(n){let e=je(ze,{optional:!0});return e?e.run(()=>n()):n()}var M_=(n,e,t)=>(...r)=>(e&&setTimeout(e,0),wi(t,()=>Qt(()=>n.apply(void 0,r)))),fe=(n,e,t)=>(t||=e?Tn.WARN:Tn.VERBOSE,function(){let r,i=arguments,o,a,u;try{o=je(Rt),a=je(Ti),u=je(Ih)}catch{return x_(n,t),n.apply(this,i)}for(let d=0;d<arguments.length;d++)typeof i[d]=="function"&&(e&&(r||=Qt(()=>a.add())),i[d]=M_(i[d],r,u));let l=L_(()=>n.apply(this,i));return e?l instanceof it?l.pipe(ko(o.outsideAngular),Co(o.insideAngular),Xh(u)):l instanceof Promise?Qt(()=>{let d=a.add();return new Promise((p,g)=>{l.then(v=>wi(u,()=>Qt(()=>p(v))),v=>wi(u,()=>Qt(()=>g(v)))).finally(d)})}):typeof l=="function"&&r?function(){return setTimeout(r,0),l.apply(this,arguments)}:Qt(()=>l):l instanceof it?l.pipe(ko(o.outsideAngular),Co(o.insideAngular)):Qt(()=>l)});var ot=class{constructor(e){return e}},Jt=class{constructor(){return Di()}};function F_(n){return n&&n.length===1?n[0]:new ot(Ht())}var ia=new In("angularfire2._apps"),U_={provide:ot,useFactory:F_,deps:[[new Ne,ia]]},B_={provide:Jt,deps:[[new Ne,ia]]};function q_(n){return(e,t)=>{let r=t.get(Eh);re("angularfire",St.full,"core"),re("angularfire",St.full,"app"),re("angular",yh.full,r.toString());let i=e.runOutsideAngular(()=>n(t));return new ot(i)}}function nA(n,...e){return En([U_,B_,{provide:ia,useFactory:q_(n),multi:!0,deps:[ze,wt,Rt,...e]}])}var rA=fe(ra,!0);var $_=new Map,j_={activated:!1,tokenObservers:[]},z_={initialized:!1,enabled:!1};function Ue(n){return $_.get(n)||Object.assign({},j_)}function id(){return z_}var W_="https://content-firebaseappcheck.googleapis.com/v1";var G_="exchangeDebugToken",td={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},dA=1440*60*1e3;var aa=class{constructor(e,t,r,i,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=i,i>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return I(this,null,function*(){this.stop();try{this.pending=new Gt,this.pending.promise.catch(t=>{}),yield K_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Gt,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function K_(n){return new Promise(e=>{setTimeout(e,n)})}var H_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Pt=new Me("appCheck","AppCheck",H_);function sd(n){if(!Ue(n).activated)throw Pt.create("use-before-activation",{appName:n.name})}function od(r,i){return I(this,arguments,function*({url:n,body:e},t){let o={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let R=yield a.getHeartbeatsHeader();R&&(o["X-Firebase-Client"]=R)}let u={method:"POST",body:JSON.stringify(e),headers:o},l;try{l=yield fetch(n,u)}catch(R){throw Pt.create("fetch-network-error",{originalErrorMessage:R?.message})}if(l.status!==200)throw Pt.create("fetch-status-error",{httpStatus:l.status});let d;try{d=yield l.json()}catch(R){throw Pt.create("fetch-parse-error",{originalErrorMessage:R?.message})}let p=d.ttl.match(/^([\d.]+)(s)$/);if(!p||!p[2]||isNaN(Number(p[1])))throw Pt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let g=Number(p[1])*1e3,v=Date.now();return{token:d.token,expireTimeMillis:v+g,issuedAtTimeMillis:v}})}function ad(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${W_}/projects/${t}/apps/${r}:${G_}?key=${i}`,body:{debug_token:e}}}var Q_="firebase-app-check-database",J_=1,ca="firebase-app-check-store";var Oi=null;function Y_(){return Oi||(Oi=new Promise((n,e)=>{try{let t=indexedDB.open(Q_,J_);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Pt.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(ca,{keyPath:"compositeKey"})}}}catch(t){e(Pt.create("storage-open",{originalErrorMessage:t?.message}))}}),Oi)}function X_(n,e){return Z_(ey(n),e)}function Z_(n,e){return I(this,null,function*(){let r=(yield Y_()).transaction(ca,"readwrite"),o=r.objectStore(ca).put({compositeKey:n,value:e});return new Promise((a,u)=>{o.onsuccess=l=>{a()},r.onerror=l=>{var d;u(Pt.create("storage-set",{originalErrorMessage:(d=l.target.error)===null||d===void 0?void 0:d.message}))}})})}function ey(n){return`${n.options.appId}-${n.name}`}var Ar=new Ge("@firebase/app-check");function sa(n,e){return vr()?X_(n,e).catch(t=>{Ar.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function cd(){return id().enabled}function ud(){return I(this,null,function*(){let n=id();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var ty={error:"UNKNOWN_ERROR"};function ny(n){return Ai.encodeString(JSON.stringify(n),!1)}function ua(n,e=!1,t=!1){return I(this,null,function*(){let r=n.app;sd(r);let i=Ue(r),o=i.token,a;if(o&&!br(o)&&(i.token=void 0,o=void 0),!o){let d=yield i.cachedTokenPromise;d&&(br(d)?o=d:yield sa(r,void 0))}if(!e&&o&&br(o))return{token:o.token};let u=!1;if(cd())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=od(ad(r,yield ud()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);let d=yield i.exchangeTokenPromise;return yield sa(r,d),i.token=d,{token:d.token}}catch(d){return d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?Ar.warn(d.message):t&&Ar.error(d),oa(d)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),o=yield Ue(r).exchangeTokenPromise}catch(d){d.code==="appCheck/throttled"||d.code==="appCheck/initial-throttle"?Ar.warn(d.message):t&&Ar.error(d),a=d}let l;return o?a?br(o)?l={token:o.token,internalError:a}:l=oa(a):(l={token:o.token},i.token=o,yield sa(r,o)):l=oa(a),u&&oy(r,l),l})}function ry(n){return I(this,null,function*(){let e=n.app;sd(e);let{provider:t}=Ue(e);if(cd()){let r=yield ud(),{token:i}=yield od(ad(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function iy(n,e,t,r){let{app:i}=n,o=Ue(i),a={next:t,error:r,type:e};if(o.tokenObservers=[...o.tokenObservers,a],o.token&&br(o.token)){let u=o.token;Promise.resolve().then(()=>{t({token:u.token}),nd(n)}).catch(()=>{})}o.cachedTokenPromise.then(()=>nd(n))}function ld(n,e){let t=Ue(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function nd(n){let{app:e}=n,t=Ue(e),r=t.tokenRefresher;r||(r=sy(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function sy(n){let{app:e}=n;return new aa(()=>I(null,null,function*(){let t=Ue(e),r;if(t.token?r=yield ua(n,!0):r=yield ua(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=Ue(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},td.RETRIAL_MIN_WAIT,td.RETRIAL_MAX_WAIT)}function oy(n,e){let t=Ue(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function br(n){return n.expireTimeMillis-Date.now()>0}function oa(n){return{token:ny(ty),error:n}}var la=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ue(this.app);for(let t of e)ld(this.app,t.next);return Promise.resolve()}};function ay(n,e){return new la(n,e)}function cy(n){return{getToken:e=>ua(n,e),getLimitedUseToken:()=>ry(n),addTokenListener:e=>iy(n,"INTERNAL",e),removeTokenListener:e=>ld(n.app,e)}}var uy="@firebase/app-check",ly="0.10.1";var hy="app-check",rd="app-check-internal";function dy(){Fe(new Se(hy,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return ay(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(rd).initialize()})),Fe(new Se(rd,n=>{let e=n.getProvider("app-check").getImmediate();return cy(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),re(uy,ly)}dy();var fy="app-check";var bn=class{constructor(){return An(fy)}};var py=["localhost","0.0.0.0","127.0.0.1"],bA=typeof window<"u"&&py.includes(window.location.hostname);function bd(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Sd=bd,Rd=new Me("auth","Firebase",bd());var Ui=new Ge("@firebase/auth");function my(n,...e){Ui.logLevel<=W.WARN&&Ui.warn(`Auth (${bt}): ${n}`,...e)}function xi(n,...e){Ui.logLevel<=W.ERROR&&Ui.error(`Auth (${bt}): ${n}`,...e)}function Dt(n,...e){throw ka(n,...e)}function Xt(n,...e){return ka(n,...e)}function Pd(n,e,t){let r=Object.assign(Object.assign({},Sd()),{[e]:t});return new Me("auth","Firebase",r).create(e,{appName:n.name})}function Yt(n){return Pd(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ka(n,...e){if(typeof n!="string"){let t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Rd.create(n,...e)}function F(n,e,...t){if(!n)throw ka(e,...t)}function at(n){let e="INTERNAL ASSERTION FAILED: "+n;throw xi(e),new Error(e)}function Nt(n,e){n||at(e)}function pa(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function gy(){return hd()==="http:"||hd()==="https:"}function hd(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function _y(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gy()||Dh()||"connection"in navigator)?navigator.onLine:!0}function yy(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Zt=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,Nt(t>e,"Short delay should be less than long delay!"),this.isMobile=Ch()||Nh()}get(){return _y()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Da(n,e){Nt(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var Bi=class{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;at("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;at("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;at("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var vy={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Iy=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Ey=new Zt(3e4,6e4);function Na(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function Sn(o,a,u,l){return I(this,arguments,function*(n,e,t,r,i={}){return Cd(n,i,()=>I(null,null,function*(){let d={},p={};r&&(e==="GET"?p=r:d={body:JSON.stringify(r)});let g=Ir(Object.assign({key:n.config.apiKey},p)).slice(1),v=yield n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);let R=Object.assign({method:e,headers:v},d);return kh()||(R.referrerPolicy="no-referrer"),n.emulatorConfig&&Tt(n.emulatorConfig.host)&&(R.credentials="include"),Bi.fetch()(yield kd(n,n.config.apiHost,t,g),R)}))})}function Cd(n,e,t){return I(this,null,function*(){n._canInitEmulator=!1;let r=Object.assign(Object.assign({},vy),e);try{let i=new ma(n),o=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();let a=yield o.json();if("needConfirmation"in a)throw Vi(n,"account-exists-with-different-credential",a);if(o.ok&&!("errorMessage"in a))return a;{let u=o.ok?a.errorMessage:a.error.message,[l,d]=u.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Vi(n,"credential-already-in-use",a);if(l==="EMAIL_EXISTS")throw Vi(n,"email-already-in-use",a);if(l==="USER_DISABLED")throw Vi(n,"user-disabled",a);let p=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Pd(n,p,d);Dt(n,p)}}catch(i){if(i instanceof Pe)throw i;Dt(n,"network-request-failed",{message:String(i)})}})}function wy(o,a,u,l){return I(this,arguments,function*(n,e,t,r,i={}){let d=yield Sn(n,e,t,r,i);return"mfaPendingCredential"in d&&Dt(n,"multi-factor-auth-required",{_serverResponse:d}),d})}function kd(n,e,t,r){return I(this,null,function*(){let i=`${e}${t}?${r}`,o=n,a=o.config.emulator?Da(n.config,i):`${n.config.apiScheme}://${i}`;return Iy.includes(t)&&(yield o._persistenceManagerAvailable,o._getPersistenceType()==="COOKIE")?o._getPersistence()._getFinalTarget(a).toString():a})}var ma=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Xt(this.auth,"network-request-failed")),Ey.get())})}};function Vi(n,e,t){let r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);let i=Xt(n,e,r);return i.customData._tokenResponse=t,i}function Ty(n,e){return I(this,null,function*(){return Sn(n,"POST","/v1/accounts:delete",e)})}function qi(n,e){return I(this,null,function*(){return Sn(n,"POST","/v1/accounts:lookup",e)})}function Sr(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function Oa(n,e=!1){return I(this,null,function*(){let t=se(n),r=yield t.getIdToken(e),i=Va(r);F(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");let o=typeof i.firebase=="object"?i.firebase:void 0,a=o?.sign_in_provider;return{claims:i,token:r,authTime:Sr(ha(i.auth_time)),issuedAtTime:Sr(ha(i.iat)),expirationTime:Sr(ha(i.exp)),signInProvider:a||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function ha(n){return Number(n)*1e3}function Va(n){let[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return xi("JWT malformed, contained fewer than 3 sections"),null;try{let i=bi(t);return i?JSON.parse(i):(xi("Failed to decode base64 JWT payload"),null)}catch(i){return xi("Caught error parsing JWT payload as JSON",i?.toString()),null}}function dd(n){let e=Va(n);return F(e,"internal-error"),F(typeof e.exp<"u","internal-error"),F(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Pr(n,e,t=!1){return I(this,null,function*(){if(t)return e;try{return yield e}catch(r){throw r instanceof Pe&&Ay(r)&&n.auth.currentUser===n&&(yield n.auth.signOut()),r}})}function Ay({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var ga=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;let i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>I(this,null,function*(){yield this.iteration()}),t)}iteration(){return I(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var Cr=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Sr(this.lastLoginAt),this.creationTime=Sr(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function $i(n){return I(this,null,function*(){var e;let t=n.auth,r=yield n.getIdToken(),i=yield Pr(n,qi(t,{idToken:r}));F(i?.users.length,t,"internal-error");let o=i.users[0];n._notifyReloadListener(o);let a=!((e=o.providerUserInfo)===null||e===void 0)&&e.length?Dd(o.providerUserInfo):[],u=by(n.providerData,a),l=n.isAnonymous,d=!(n.email&&o.passwordHash)&&!u?.length,p=l?d:!1,g={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new Cr(o.createdAt,o.lastLoginAt),isAnonymous:p};Object.assign(n,g)})}function xa(n){return I(this,null,function*(){let e=se(n);yield $i(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function by(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Dd(n){return n.map(e=>{var{providerId:t}=e,r=Po(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}function Sy(n,e){return I(this,null,function*(){let t=yield Cd(n,{},()=>I(null,null,function*(){let r=Ir({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:o}=n.config,a=yield kd(n,i,"/v1/token",`key=${o}`),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:u,body:r};return n.emulatorConfig&&Tt(n.emulatorConfig.host)&&(l.credentials="include"),Bi.fetch()(a,l)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function Ry(n,e){return I(this,null,function*(){return Sn(n,"POST","/v2/accounts:revokeToken",Na(n,e))})}var Rr=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){F(e.idToken,"internal-error"),F(typeof e.idToken<"u","internal-error"),F(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):dd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){F(e.length!==0,"internal-error");let t=dd(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return I(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(F(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return I(this,null,function*(){let{accessToken:r,refreshToken:i,expiresIn:o}=yield Sy(e,t);this.updateTokensAndExpiration(r,i,Number(o))})}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:o}=t,a=new n;return r&&(F(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(F(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),o&&(F(typeof o=="number","internal-error",{appName:e}),a.expirationTime=o),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return at("not implemented")}};function Ct(n,e){F(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var kt=class n{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,o=Po(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ga(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new Cr(o.createdAt||void 0,o.lastLoginAt||void 0)}getIdToken(e){return I(this,null,function*(){let t=yield Pr(this,this.stsTokenManager.getToken(this.auth,e));return F(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return Oa(this,e)}reload(){return xa(this)}_assign(e){this!==e&&(F(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){F(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return I(this,null,function*(){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&(yield $i(this)),yield this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)})}delete(){return I(this,null,function*(){if(Oe(this.auth.app))return Promise.reject(Yt(this.auth));let e=yield this.getIdToken();return yield Pr(this,Ty(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,o,a,u,l,d,p;let g=(r=t.displayName)!==null&&r!==void 0?r:void 0,v=(i=t.email)!==null&&i!==void 0?i:void 0,R=(o=t.phoneNumber)!==null&&o!==void 0?o:void 0,k=(a=t.photoURL)!==null&&a!==void 0?a:void 0,V=(u=t.tenantId)!==null&&u!==void 0?u:void 0,D=(l=t._redirectEventId)!==null&&l!==void 0?l:void 0,$=(d=t.createdAt)!==null&&d!==void 0?d:void 0,U=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:j,emailVerified:Y,isAnonymous:Te,providerData:J,stsTokenManager:w}=t;F(j&&w,e,"internal-error");let m=Rr.fromJSON(this.name,w);F(typeof j=="string",e,"internal-error"),Ct(g,e.name),Ct(v,e.name),F(typeof Y=="boolean",e,"internal-error"),F(typeof Te=="boolean",e,"internal-error"),Ct(R,e.name),Ct(k,e.name),Ct(V,e.name),Ct(D,e.name),Ct($,e.name),Ct(U,e.name);let y=new n({uid:j,auth:e,email:v,emailVerified:Y,displayName:g,isAnonymous:Te,photoURL:k,phoneNumber:R,tenantId:V,stsTokenManager:m,createdAt:$,lastLoginAt:U});return J&&Array.isArray(J)&&(y.providerData=J.map(E=>Object.assign({},E))),D&&(y._redirectEventId=D),y}static _fromIdTokenResponse(e,t,r=!1){return I(this,null,function*(){let i=new Rr;i.updateFromServerResponse(t);let o=new n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return yield $i(o),o})}static _fromGetAccountInfoResponse(e,t,r){return I(this,null,function*(){let i=t.users[0];F(i.localId!==void 0,"internal-error");let o=i.providerUserInfo!==void 0?Dd(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!o?.length,u=new Rr;u.updateFromIdToken(r);let l=new n({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:a}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Cr(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!o?.length};return Object.assign(l,d),l})}};var fd=new Map;function ct(n){Nt(n instanceof Function,"Expected a class definition");let e=fd.get(n);return e?(Nt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,fd.set(n,e),e)}var Py=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return I(this,null,function*(){return!0})}_set(t,r){return I(this,null,function*(){this.storage[t]=r})}_get(t){return I(this,null,function*(){let r=this.storage[t];return r===void 0?null:r})}_remove(t){return I(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}return n.type="NONE",n})(),_a=Py;function Li(n,e,t){return`firebase:${n}:${e}:${t}`}var ji=class n{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:o}=this.auth;this.fullUserKey=Li(this.userKey,i.apiKey,o),this.fullPersistenceKey=Li("persistence",i.apiKey,o),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return I(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield qi(this.auth,{idToken:e}).catch(()=>{});return t?kt._fromGetAccountInfoResponse(this.auth,t,e):null}return kt._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return I(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,r="authUser"){return I(this,null,function*(){if(!t.length)return new n(ct(_a),e,r);let i=(yield Promise.all(t.map(d=>I(null,null,function*(){if(yield d._isAvailable())return d})))).filter(d=>d),o=i[0]||ct(_a),a=Li(r,e.config.apiKey,e.name),u=null;for(let d of t)try{let p=yield d._get(a);if(p){let g;if(typeof p=="string"){let v=yield qi(e,{idToken:p}).catch(()=>{});if(!v)break;g=yield kt._fromGetAccountInfoResponse(e,v,p)}else g=kt._fromJSON(e,p);d!==o&&(u=g),o=d;break}}catch{}let l=i.filter(d=>d._shouldAllowMigration);return!o._shouldAllowMigration||!l.length?new n(o,e,r):(o=l[0],u&&(yield o._set(a,u.toJSON())),yield Promise.all(t.map(d=>I(null,null,function*(){if(d!==o)try{yield d._remove(a)}catch{}}))),new n(o,e,r))})}};function pd(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(xd(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Nd(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Md(e))return"Blackberry";if(Fd(e))return"Webos";if(Od(e))return"Safari";if((e.includes("chrome/")||Vd(e))&&!e.includes("edge/"))return"Chrome";if(Ld(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Nd(n=de()){return/firefox\//i.test(n)}function Od(n=de()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Vd(n=de()){return/crios\//i.test(n)}function xd(n=de()){return/iemobile/i.test(n)}function Ld(n=de()){return/android/i.test(n)}function Md(n=de()){return/blackberry/i.test(n)}function Fd(n=de()){return/webos/i.test(n)}function La(n=de()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Cy(n=de()){var e;return La(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ky(){return Oh()&&document.documentMode===10}function Ud(n=de()){return La(n)||Ld(n)||Fd(n)||Md(n)||/windows phone/i.test(n)||xd(n)}function Bd(n,e=[]){let t;switch(n){case"Browser":t=pd(de());break;case"Worker":t=`${pd(de())}-${n}`;break;default:t=n}let r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${bt}/${r}`}var ya=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=o=>new Promise((a,u)=>{try{let l=e(o);a(l)}catch(l){u(l)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return I(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)yield r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(let i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}})}};function Dy(t){return I(this,arguments,function*(n,e={}){return Sn(n,"GET","/v2/passwordPolicy",Na(n,e))})}var Ny=6,va=class{constructor(e){var t,r,i,o;let a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:Ny,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(o=e.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,o,a,u;let l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,l),this.validatePasswordCharacterOptions(e,l),l.isValid&&(l.isValid=(t=l.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),l.isValid&&(l.isValid=(r=l.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(i=l.containsLowercaseLetter)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(o=l.containsUppercaseLetter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNumericCharacter)!==null&&a!==void 0?a:!0),l.isValid&&(l.isValid=(u=l.containsNonAlphanumericCharacter)!==null&&u!==void 0?u:!0),l}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,o){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=o))}};var Ia=class{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new zi(this),this.idTokenSubscription=new zi(this),this.beforeStateQueue=new ya(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Rd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(o=>this._resolvePersistenceManagerAvailable=o)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ct(t)),this._initializationPromise=this.queue(()=>I(this,null,function*(){var r,i,o;if(!this._deleted&&(this.persistenceManager=yield ji.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((o=this.currentUser)===null||o===void 0?void 0:o.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return I(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return I(this,null,function*(){try{let t=yield qi(this,{idToken:e}),r=yield kt._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return I(this,null,function*(){var t;if(Oe(this.app)){let a=this.app.settings.authIdToken;return a?new Promise(u=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(u,u))}):this.directlySetCurrentUser(null)}let r=yield this.assertedPersistence.getCurrentUser(),i=r,o=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,u=i?._redirectEventId,l=yield this.tryRedirectSignIn(e);(!a||a===u)&&l?.user&&(i=l.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{yield this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return F(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return I(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return I(this,null,function*(){try{yield $i(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=yy()}_delete(){return I(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return I(this,null,function*(){if(Oe(this.app))return Promise.reject(Yt(this));let t=e?se(e):null;return t&&F(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return I(this,null,function*(){if(!this._deleted)return e&&F(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>I(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return I(this,null,function*(){return Oe(this.app)?Promise.reject(Yt(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return Oe(this.app)?Promise.reject(Yt(this)):this.queue(()=>I(this,null,function*(){yield this.assertedPersistence.setPersistence(ct(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return I(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return I(this,null,function*(){let e=yield Dy(this),t=new va(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Me("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}revokeAccessToken(e){return I(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),yield Ry(this,r)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return I(this,null,function*(){let r=yield this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return I(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&ct(e)||this._popupRedirectResolver;F(t,this,"argument-error"),this.redirectPersistenceManager=yield ji.create(this,[ct(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return I(this,null,function*(){var t,r;return this._isInitialized&&(yield this.queue(()=>I(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return I(this,null,function*(){if(e===this.currentUser)return this.queue(()=>I(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let o=typeof t=="function"?t:t.next.bind(t),a=!1,u=this._isInitialized?Promise.resolve():this._initializationPromise;if(F(u,this,"internal-error"),u.then(()=>{a||o(this.currentUser)}),typeof t=="function"){let l=e.addObserver(t,r,i);return()=>{a=!0,l()}}else{let l=e.addObserver(t);return()=>{a=!0,l()}}}directlySetCurrentUser(e){return I(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return F(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Bd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return I(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();r&&(t["X-Firebase-Client"]=r);let i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return I(this,null,function*(){var e;if(Oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&my(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function Ma(n){return se(n)}var zi=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=Mh(t=>this.observer=t)}get next(){return F(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var Fa={loadJS(){return I(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Oy(n){Fa=n}function Vy(n){return Fa.loadJS(n)}function xy(){return Fa.gapiScript}function qd(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Ua(n,e){let t=wn(n,"auth");if(t.isInitialized()){let i=t.getImmediate(),o=t.getOptions();if(We(o,e??{}))return i;Dt(i,"already-initialized")}return t.initialize({options:e})}function Ly(n,e){let t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map(ct);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function Ba(n,e,t){let r=Ma(n);F(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");let i=!!t?.disableWarnings,o=$d(e),{host:a,port:u}=My(e),l=u===null?"":`:${u}`,d={url:`${o}//${a}${l}/`},p=Object.freeze({host:a,port:u,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){F(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),F(We(d,r.config.emulator)&&We(p,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=p,r.settings.appVerificationDisabledForTesting=!0,Tt(a)?(Ri(`${o}//${a}${l}`),Pi("Auth",!0)):i||Fy()}function $d(n){let e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function My(n){let e=$d(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};let r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let o=i[1];return{host:o,port:md(r.substr(o.length+1))}}else{let[o,a]=r.split(":");return{host:o,port:md(a)}}}function md(n){if(!n)return null;let e=Number(n);return isNaN(e)?null:e}function Fy(){function n(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var Wi=class{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return at("not implemented")}_getIdTokenResponse(e){return at("not implemented")}_linkToIdToken(e,t){return at("not implemented")}_getReauthenticationResolver(e){return at("not implemented")}};function da(n,e){return I(this,null,function*(){return wy(n,"POST","/v1/accounts:signInWithIdp",Na(n,e))})}var Gi=class{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}};var Ea=class extends Gi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}};var kr=class n{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,r,i=!1){return I(this,null,function*(){let o=yield kt._fromIdTokenResponse(e,r,i),a=gd(r);return new n({user:o,providerId:a,_tokenResponse:r,operationType:t})})}static _forOperation(e,t,r){return I(this,null,function*(){yield e._updateTokensIfNecessary(r,!0);let i=gd(r);return new n({user:e,providerId:i,_tokenResponse:r,operationType:t})})}};function gd(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var wa=class n extends Pe{constructor(e,t,r,i){var o;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,n.prototype),this.customData={appName:e.name,tenantId:(o=e.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new n(e,t,r,i)}};function jd(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?wa._fromErrorAndOperation(n,o,e,r):o})}function Uy(n,e,t=!1){return I(this,null,function*(){let r=yield Pr(n,e._linkToIdToken(n.auth,yield n.getIdToken()),t);return kr._forOperation(n,"link",r)})}function By(n,e,t=!1){return I(this,null,function*(){let{auth:r}=n;if(Oe(r.app))return Promise.reject(Yt(r));let i="reauthenticate";try{let o=yield Pr(n,jd(r,i,e,n),t);F(o.idToken,r,"internal-error");let a=Va(o.idToken);F(a,r,"internal-error");let{sub:u}=a;return F(n.uid===u,r,"user-mismatch"),kr._forOperation(n,i,o)}catch(o){throw o?.code==="auth/user-not-found"&&Dt(r,"user-mismatch"),o}})}function qy(n,e,t=!1){return I(this,null,function*(){if(Oe(n.app))return Promise.reject(Yt(n));let r="signIn",i=yield jd(n,r,e),o=yield kr._fromIdTokenResponse(n,r,i);return t||(yield n._updateCurrentUser(o.user)),o})}function Yi(n,e,t,r){return se(n).onIdTokenChanged(e,t,r)}function qa(n,e,t){return se(n).beforeAuthStateChanged(e,t)}function Xi(n,e,t,r){return se(n).onAuthStateChanged(e,t,r)}var Ki="__sak";var Hi=class{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ki,"1"),this.storage.removeItem(Ki),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}};var $y=1e3,jy=10,zy=(()=>{class n extends Hi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ud(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(let r of Object.keys(this.listeners)){let i=this.storage.getItem(r),o=this.localCache[r];i!==o&&t(r,o,i)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((u,l,d)=>{this.notifyListeners(u,d)});return}let i=t.key;r?this.detachListener():this.stopPolling();let o=()=>{let u=this.storage.getItem(i);!r&&this.localCache[i]===u||this.notifyListeners(i,u)},a=this.storage.getItem(i);ky()&&a!==t.newValue&&t.newValue!==t.oldValue?setTimeout(o,jy):o()}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:i}),!0)})},$y)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return I(this,null,function*(){yield Et(n.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return I(this,null,function*(){let r=yield Et(n.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return I(this,null,function*(){yield Et(n.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}return n.type="LOCAL",n})(),zd=zy;var Wy=(()=>{class n extends Hi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}return n.type="SESSION",n})(),$a=Wy;function Gy(n){return Promise.all(n.map(e=>I(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}var Ky=(()=>{class n{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){let r=this.receivers.find(o=>o.isListeningto(t));if(r)return r;let i=new n(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}handleEvent(t){return I(this,null,function*(){let r=t,{eventId:i,eventType:o,data:a}=r.data,u=this.handlersMap[o];if(!u?.size)return;r.ports[0].postMessage({status:"ack",eventId:i,eventType:o});let l=Array.from(u).map(p=>I(this,null,function*(){return p(r.origin,a)})),d=yield Gy(l);r.ports[0].postMessage({status:"done",eventId:i,eventType:o,response:d})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function Wd(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}var Ta=class{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,r=50){return I(this,null,function*(){let i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let o,a;return new Promise((u,l)=>{let d=Wd("",20);i.port1.start();let p=setTimeout(()=>{l(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(g){let v=g;if(v.data.eventId===d)switch(v.data.status){case"ack":clearTimeout(p),o=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),u(v.data.response);break;default:clearTimeout(p),clearTimeout(o),l(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})})}};function He(){return window}function Hy(n){He().location.href=n}function Gd(){return typeof He().WorkerGlobalScope<"u"&&typeof He().importScripts=="function"}function Qy(){return I(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch{return null}})}function Jy(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Yy(){return Gd()?self:null}var Kd="firebaseLocalStorageDb",Xy=1,Qi="firebaseLocalStorage",Hd="fbase_key",en=class{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}};function Zi(n,e){return n.transaction([Qi],e?"readwrite":"readonly").objectStore(Qi)}function Zy(){let n=indexedDB.deleteDatabase(Kd);return new en(n).toPromise()}function Aa(){let n=indexedDB.open(Kd,Xy);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{let r=n.result;try{r.createObjectStore(Qi,{keyPath:Hd})}catch(i){t(i)}}),n.addEventListener("success",()=>I(null,null,function*(){let r=n.result;r.objectStoreNames.contains(Qi)?e(r):(r.close(),yield Zy(),e(yield Aa()))}))})}function _d(n,e,t){return I(this,null,function*(){let r=Zi(n,!0).put({[Hd]:e,value:t});return new en(r).toPromise()})}function ev(n,e){return I(this,null,function*(){let t=Zi(n,!1).get(e),r=yield new en(t).toPromise();return r===void 0?null:r.value})}function yd(n,e){let t=Zi(n,!0).delete(e);return new en(t).toPromise()}var tv=800,nv=3,rv=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return I(this,null,function*(){return this.db?this.db:(this.db=yield Aa(),this.db)})}_withRetries(t){return I(this,null,function*(){let r=0;for(;;)try{let i=yield this._openDb();return yield t(i)}catch(i){if(r++>nv)throw i;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return I(this,null,function*(){return Gd()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return I(this,null,function*(){this.receiver=Ky._getInstance(Yy()),this.receiver._subscribe("keyChanged",(t,r)=>I(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>I(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return I(this,null,function*(){var t,r;if(this.activeServiceWorker=yield Qy(),!this.activeServiceWorker)return;this.sender=new Ta(this.activeServiceWorker);let i=yield this.sender._send("ping",{},800);i&&!((t=i[0])===null||t===void 0)&&t.fulfilled&&!((r=i[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return I(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||Jy()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}})}_isAvailable(){return I(this,null,function*(){try{if(!indexedDB)return!1;let t=yield Aa();return yield _d(t,Ki,"1"),yield yd(t,Ki),!0}catch{}return!1})}_withPendingWrite(t){return I(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return I(this,null,function*(){return this._withPendingWrite(()=>I(this,null,function*(){return yield this._withRetries(i=>_d(i,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return I(this,null,function*(){let r=yield this._withRetries(i=>ev(i,t));return this.localCache[t]=r,r})}_remove(t){return I(this,null,function*(){return this._withPendingWrite(()=>I(this,null,function*(){return yield this._withRetries(r=>yd(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return I(this,null,function*(){let t=yield this._withRetries(o=>{let a=Zi(o,!1).getAll();return new en(a).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];let r=[],i=new Set;if(t.length!==0)for(let{fbase_key:o,value:a}of t)i.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(a)&&(this.notifyListeners(o,a),r.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!i.has(o)&&(this.notifyListeners(o,null),r.push(o));return r})}notifyListeners(t,r){this.localCache[t]=r;let i=this.listeners[t];if(i)for(let o of Array.from(i))o(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>I(this,null,function*(){return this._poll()}),tv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),Qd=rv;var xA=qd("rcb"),LA=new Zt(3e4,6e4);function iv(n,e){return e?ct(e):(F(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var Dr=class extends Wi{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return da(e,this._buildIdpRequest())}_linkToIdToken(e,t){return da(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return da(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}};function sv(n){return qy(n.auth,new Dr(n),n.bypassAuthState)}function ov(n){let{auth:e,user:t}=n;return F(t,e,"internal-error"),By(t,new Dr(n),n.bypassAuthState)}function av(n){return I(this,null,function*(){let{auth:e,user:t}=n;return F(t,e,"internal-error"),Uy(t,new Dr(n),n.bypassAuthState)})}var ba=class{constructor(e,t,r,i,o=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>I(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}}))}onAuthEvent(e){return I(this,null,function*(){let{urlResponse:t,sessionId:r,postBody:i,tenantId:o,error:a,type:u}=e;if(a){this.reject(a);return}let l={auth:this.auth,requestUri:t,sessionId:r,tenantId:o||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(u)(l))}catch(d){this.reject(d)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return sv;case"linkViaPopup":case"linkViaRedirect":return av;case"reauthViaPopup":case"reauthViaRedirect":return ov;default:Dt(this.auth,"internal-error")}}resolve(e){Nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Nt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var MA=new Zt(2e3,1e4);var cv="pendingRedirect",Mi=new Map,Sa=class n extends ba{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}execute(){return I(this,null,function*(){let e=Mi.get(this.auth._key());if(!e){try{let r=(yield uv(this.resolver,this.auth))?yield Et(n.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Mi.set(this.auth._key(),e)}return this.bypassAuthState||Mi.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return I(this,null,function*(){if(e.type==="signInViaRedirect")return Et(n.prototype,this,"onAuthEvent").call(this,e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){let t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,Et(n.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}})}onExecution(){return I(this,null,function*(){})}cleanUp(){}};function uv(n,e){return I(this,null,function*(){let t=dv(e),r=hv(n);if(!(yield r._isAvailable()))return!1;let i=(yield r._get(t))==="true";return yield r._remove(t),i})}function lv(n,e){Mi.set(n._key(),e)}function hv(n){return ct(n._redirectPersistence)}function dv(n){return Li(cv,n.config.apiKey,n.name)}function fv(n,e,t=!1){return I(this,null,function*(){if(Oe(n.app))return Promise.reject(Yt(n));let r=Ma(n),i=iv(r,e),a=yield new Sa(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,e)),a})}var pv=600*1e3,Ra=class{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!mv(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Jd(e)){let i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Xt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=pv&&this.cachedEventUids.clear(),this.cachedEventUids.has(vd(e))}saveEventToCache(e){this.cachedEventUids.add(vd(e)),this.lastProcessedEventTime=Date.now()}};function vd(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Jd({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function mv(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Jd(n);default:return!1}}function gv(t){return I(this,arguments,function*(n,e={}){return Sn(n,"GET","/v1/projects",e)})}var _v=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yv=/^https?/;function vv(n){return I(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:e}=yield gv(n);for(let t of e)try{if(Iv(t))return}catch{}Dt(n,"unauthorized-domain")})}function Iv(n){let e=pa(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){let a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!yv.test(t))return!1;if(_v.test(n))return r===n;let i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}var Ev=new Zt(3e4,6e4);function Id(){let n=He().___jsl;if(n?.H){for(let e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function wv(n){return new Promise((e,t)=>{var r,i,o;function a(){Id(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Id(),t(Xt(n,"network-request-failed"))},timeout:Ev.get()})}if(!((i=(r=He().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((o=He().gapi)===null||o===void 0)&&o.load)a();else{let u=qd("iframefcb");return He()[u]=()=>{gapi.load?a():t(Xt(n,"network-request-failed"))},Vy(`${xy()}?onload=${u}`).catch(l=>t(l))}}).catch(e=>{throw Fi=null,e})}var Fi=null;function Tv(n){return Fi=Fi||wv(n),Fi}var Av=new Zt(5e3,15e3),bv="__/auth/iframe",Sv="emulator/auth/iframe",Rv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Pv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Cv(n){let e=n.config;F(e.authDomain,n,"auth-domain-config-required");let t=e.emulator?Da(e,Sv):`https://${n.config.authDomain}/${bv}`,r={apiKey:e.apiKey,appName:n.name,v:bt},i=Pv.get(n.config.apiHost);i&&(r.eid=i);let o=n._getFrameworks();return o.length&&(r.fw=o.join(",")),`${t}?${Ir(r).slice(1)}`}function kv(n){return I(this,null,function*(){let e=yield Tv(n),t=He().gapi;return F(t,n,"internal-error"),e.open({where:document.body,url:Cv(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Rv,dontclear:!0},r=>new Promise((i,o)=>I(null,null,function*(){yield r.restyle({setHideOnLeave:!1});let a=Xt(n,"network-request-failed"),u=He().setTimeout(()=>{o(a)},Av.get());function l(){He().clearTimeout(u),i(r)}r.ping(l).then(l,()=>{o(a)})})))})}var Dv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Nv=500,Ov=600,Vv="_blank",xv="http://localhost",Ji=class{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}};function Lv(n,e,t,r=Nv,i=Ov){let o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),u="",l=Object.assign(Object.assign({},Dv),{width:r.toString(),height:i.toString(),top:o,left:a}),d=de().toLowerCase();t&&(u=Vd(d)?Vv:t),Nd(d)&&(e=e||xv,l.scrollbars="yes");let p=Object.entries(l).reduce((v,[R,k])=>`${v}${R}=${k},`,"");if(Cy(d)&&u!=="_self")return Mv(e||"",u),new Ji(null);let g=window.open(e||"",u,p);F(g,n,"popup-blocked");try{g.focus()}catch{}return new Ji(g)}function Mv(n,e){let t=document.createElement("a");t.href=n,t.target=e;let r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}var Fv="__/auth/handler",Uv="emulator/auth/handler",Bv=encodeURIComponent("fac");function Ed(n,e,t,r,i,o){return I(this,null,function*(){F(n.config.authDomain,n,"auth-domain-config-required"),F(n.config.apiKey,n,"invalid-api-key");let a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:bt,eventId:i};if(e instanceof Gi){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Lh(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(let[p,g]of Object.entries(o||{}))a[p]=g}if(e instanceof Ea){let p=e.getScopes().filter(g=>g!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);let u=a;for(let p of Object.keys(u))u[p]===void 0&&delete u[p];let l=yield n._getAppCheckToken(),d=l?`#${Bv}=${encodeURIComponent(l)}`:"";return`${qv(n)}?${Ir(u).slice(1)}${d}`})}function qv({config:n}){return n.emulator?Da(n,Uv):`https://${n.authDomain}/${Fv}`}var fa="webStorageSupport",Pa=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$a,this._completeRedirectFn=fv,this._overrideRedirectResult=lv}_openPopup(e,t,r,i){return I(this,null,function*(){var o;Nt((o=this.eventManagers[e._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");let a=yield Ed(e,t,r,pa(),i);return Lv(e,a,Wd())})}_openRedirect(e,t,r,i){return I(this,null,function*(){yield this._originValidation(e);let o=yield Ed(e,t,r,pa(),i);return Hy(o),new Promise(()=>{})})}_initialize(e){let t=e._key();if(this.eventManagers[t]){let{manager:i,promise:o}=this.eventManagers[t];return i?Promise.resolve(i):(Nt(o,"If manager is not set, promise should be"),o)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}initAndGetManager(e){return I(this,null,function*(){let t=yield kv(e),r=new Ra(e);return t.register("authEvent",i=>(F(i?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(fa,{type:fa},i=>{var o;let a=(o=i?.[0])===null||o===void 0?void 0:o[fa];a!==void 0&&t(!!a),Dt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=vv(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ud()||Od()||La()}},Yd=Pa;var wd="@firebase/auth",Td="1.10.8";var Ca=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return I(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){F(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function $v(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function jv(n){Fe(new Se("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:u}=r.options;F(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let l={apiKey:a,authDomain:u,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Bd(n)},d=new Ia(r,i,o,l);return Ly(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Fe(new Se("auth-internal",e=>{let t=Ma(e.getProvider("auth").getImmediate());return(r=>new Ca(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),re(wd,Td,$v(n)),re(wd,Td,"esm2017")}var zv=300,Wv=$o("authIdTokenMaxAge")||zv,Ad=null,Gv=n=>e=>I(null,null,function*(){let t=e&&(yield e.getIdTokenResult()),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>Wv)return;let i=t?.token;Ad!==i&&(Ad=i,yield fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});function ja(n=Ht()){let e=wn(n,"auth");if(e.isInitialized())return e.getImmediate();let t=Ua(n,{popupRedirectResolver:Yd,persistence:[Qd,zd,$a]}),r=$o("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(r,location.origin);if(location.origin===o.origin){let a=Gv(o.toString());qa(t,a,()=>a(t.currentUser)),Yi(t,u=>a(u))}}let i=Bo("auth");return i&&Ba(t,`http://${i}`),t}function Kv(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Oy({loadJS(n){return new Promise((e,t)=>{let r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{let o=Xt("internal-error");o.customData=i,t(o)},r.type="text/javascript",r.charset="UTF-8",Kv().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});jv("Browser");function Zd(n){return new it(function(e){var t=Xi(n,e.next.bind(e),e.error.bind(e),e.complete.bind(e));return{unsubscribe:t}})}var ef="auth",Nr=class{constructor(e){return e}},Or=class{constructor(){return An(ef)}};var za=new In("angularfire2.auth-instances");function UI(n,e){let t=Tr(ef,n,e);return t&&new Nr(t)}function BI(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new Nr(r)}}var qI={provide:Or,deps:[[new Ne,za]]},$I={provide:Nr,useFactory:UI,deps:[[new Ne,za],ot]};function Ob(n,...e){return re("angularfire",St.full,"auth"),En([$I,qI,{provide:za,useFactory:BI(n),multi:!0,deps:[ze,wt,Rt,Jt,[new Ne,bn],...e]}])}var Vb=fe(Zd,!0);var xb=fe(ja,!0);var tf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},nf={};var ut,Wa;(function(){var n;function e(w,m){function y(){}y.prototype=m.prototype,w.D=m.prototype,w.prototype=new y,w.prototype.constructor=w,w.C=function(E,T,b){for(var _=Array(arguments.length-2),tt=2;tt<arguments.length;tt++)_[tt-2]=arguments[tt];return m.prototype[T].apply(E,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,m,y){y||(y=0);var E=Array(16);if(typeof m=="string")for(var T=0;16>T;++T)E[T]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(T=0;16>T;++T)E[T]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=w.g[0],y=w.g[1],T=w.g[2];var b=w.g[3],_=m+(b^y&(T^b))+E[0]+3614090360&4294967295;m=y+(_<<7&4294967295|_>>>25),_=b+(T^m&(y^T))+E[1]+3905402710&4294967295,b=m+(_<<12&4294967295|_>>>20),_=T+(y^b&(m^y))+E[2]+606105819&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(m^T&(b^m))+E[3]+3250441966&4294967295,y=T+(_<<22&4294967295|_>>>10),_=m+(b^y&(T^b))+E[4]+4118548399&4294967295,m=y+(_<<7&4294967295|_>>>25),_=b+(T^m&(y^T))+E[5]+1200080426&4294967295,b=m+(_<<12&4294967295|_>>>20),_=T+(y^b&(m^y))+E[6]+2821735955&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(m^T&(b^m))+E[7]+4249261313&4294967295,y=T+(_<<22&4294967295|_>>>10),_=m+(b^y&(T^b))+E[8]+1770035416&4294967295,m=y+(_<<7&4294967295|_>>>25),_=b+(T^m&(y^T))+E[9]+2336552879&4294967295,b=m+(_<<12&4294967295|_>>>20),_=T+(y^b&(m^y))+E[10]+4294925233&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(m^T&(b^m))+E[11]+2304563134&4294967295,y=T+(_<<22&4294967295|_>>>10),_=m+(b^y&(T^b))+E[12]+1804603682&4294967295,m=y+(_<<7&4294967295|_>>>25),_=b+(T^m&(y^T))+E[13]+4254626195&4294967295,b=m+(_<<12&4294967295|_>>>20),_=T+(y^b&(m^y))+E[14]+2792965006&4294967295,T=b+(_<<17&4294967295|_>>>15),_=y+(m^T&(b^m))+E[15]+1236535329&4294967295,y=T+(_<<22&4294967295|_>>>10),_=m+(T^b&(y^T))+E[1]+4129170786&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(m^y))+E[6]+3225465664&4294967295,b=m+(_<<9&4294967295|_>>>23),_=T+(m^y&(b^m))+E[11]+643717713&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(T^b))+E[0]+3921069994&4294967295,y=T+(_<<20&4294967295|_>>>12),_=m+(T^b&(y^T))+E[5]+3593408605&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(m^y))+E[10]+38016083&4294967295,b=m+(_<<9&4294967295|_>>>23),_=T+(m^y&(b^m))+E[15]+3634488961&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(T^b))+E[4]+3889429448&4294967295,y=T+(_<<20&4294967295|_>>>12),_=m+(T^b&(y^T))+E[9]+568446438&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(m^y))+E[14]+3275163606&4294967295,b=m+(_<<9&4294967295|_>>>23),_=T+(m^y&(b^m))+E[3]+4107603335&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(T^b))+E[8]+1163531501&4294967295,y=T+(_<<20&4294967295|_>>>12),_=m+(T^b&(y^T))+E[13]+2850285829&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^T&(m^y))+E[2]+4243563512&4294967295,b=m+(_<<9&4294967295|_>>>23),_=T+(m^y&(b^m))+E[7]+1735328473&4294967295,T=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(T^b))+E[12]+2368359562&4294967295,y=T+(_<<20&4294967295|_>>>12),_=m+(y^T^b)+E[5]+4294588738&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^T)+E[8]+2272392833&4294967295,b=m+(_<<11&4294967295|_>>>21),_=T+(b^m^y)+E[11]+1839030562&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^m)+E[14]+4259657740&4294967295,y=T+(_<<23&4294967295|_>>>9),_=m+(y^T^b)+E[1]+2763975236&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^T)+E[4]+1272893353&4294967295,b=m+(_<<11&4294967295|_>>>21),_=T+(b^m^y)+E[7]+4139469664&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^m)+E[10]+3200236656&4294967295,y=T+(_<<23&4294967295|_>>>9),_=m+(y^T^b)+E[13]+681279174&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^T)+E[0]+3936430074&4294967295,b=m+(_<<11&4294967295|_>>>21),_=T+(b^m^y)+E[3]+3572445317&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^m)+E[6]+76029189&4294967295,y=T+(_<<23&4294967295|_>>>9),_=m+(y^T^b)+E[9]+3654602809&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^T)+E[12]+3873151461&4294967295,b=m+(_<<11&4294967295|_>>>21),_=T+(b^m^y)+E[15]+530742520&4294967295,T=b+(_<<16&4294967295|_>>>16),_=y+(T^b^m)+E[2]+3299628645&4294967295,y=T+(_<<23&4294967295|_>>>9),_=m+(T^(y|~b))+E[0]+4096336452&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~T))+E[7]+1126891415&4294967295,b=m+(_<<10&4294967295|_>>>22),_=T+(m^(b|~y))+E[14]+2878612391&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~m))+E[5]+4237533241&4294967295,y=T+(_<<21&4294967295|_>>>11),_=m+(T^(y|~b))+E[12]+1700485571&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~T))+E[3]+2399980690&4294967295,b=m+(_<<10&4294967295|_>>>22),_=T+(m^(b|~y))+E[10]+4293915773&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~m))+E[1]+2240044497&4294967295,y=T+(_<<21&4294967295|_>>>11),_=m+(T^(y|~b))+E[8]+1873313359&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~T))+E[15]+4264355552&4294967295,b=m+(_<<10&4294967295|_>>>22),_=T+(m^(b|~y))+E[6]+2734768916&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~m))+E[13]+1309151649&4294967295,y=T+(_<<21&4294967295|_>>>11),_=m+(T^(y|~b))+E[4]+4149444226&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~T))+E[11]+3174756917&4294967295,b=m+(_<<10&4294967295|_>>>22),_=T+(m^(b|~y))+E[2]+718787259&4294967295,T=b+(_<<15&4294967295|_>>>17),_=y+(b^(T|~m))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+m&4294967295,w.g[1]=w.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,w.g[2]=w.g[2]+T&4294967295,w.g[3]=w.g[3]+b&4294967295}r.prototype.u=function(w,m){m===void 0&&(m=w.length);for(var y=m-this.blockSize,E=this.B,T=this.h,b=0;b<m;){if(T==0)for(;b<=y;)i(this,w,b),b+=this.blockSize;if(typeof w=="string"){for(;b<m;)if(E[T++]=w.charCodeAt(b++),T==this.blockSize){i(this,E),T=0;break}}else for(;b<m;)if(E[T++]=w[b++],T==this.blockSize){i(this,E),T=0;break}}this.h=T,this.o+=m},r.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var m=1;m<w.length-8;++m)w[m]=0;var y=8*this.o;for(m=w.length-8;m<w.length;++m)w[m]=y&255,y/=256;for(this.u(w),w=Array(16),m=y=0;4>m;++m)for(var E=0;32>E;E+=8)w[y++]=this.g[m]>>>E&255;return w};function o(w,m){var y=u;return Object.prototype.hasOwnProperty.call(y,w)?y[w]:y[w]=m(w)}function a(w,m){this.h=m;for(var y=[],E=!0,T=w.length-1;0<=T;T--){var b=w[T]|0;E&&b==m||(y[T]=b,E=!1)}this.g=y}var u={};function l(w){return-128<=w&&128>w?o(w,function(m){return new a([m|0],0>m?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return g;if(0>w)return D(d(-w));for(var m=[],y=1,E=0;w>=y;E++)m[E]=w/y|0,y*=4294967296;return new a(m,0)}function p(w,m){if(w.length==0)throw Error("number format error: empty string");if(m=m||10,2>m||36<m)throw Error("radix out of range: "+m);if(w.charAt(0)=="-")return D(p(w.substring(1),m));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=d(Math.pow(m,8)),E=g,T=0;T<w.length;T+=8){var b=Math.min(8,w.length-T),_=parseInt(w.substring(T,T+b),m);8>b?(b=d(Math.pow(m,b)),E=E.j(b).add(d(_))):(E=E.j(y),E=E.add(d(_)))}return E}var g=l(0),v=l(1),R=l(16777216);n=a.prototype,n.m=function(){if(V(this))return-D(this).m();for(var w=0,m=1,y=0;y<this.g.length;y++){var E=this.i(y);w+=(0<=E?E:4294967296+E)*m,m*=4294967296}return w},n.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(k(this))return"0";if(V(this))return"-"+D(this).toString(w);for(var m=d(Math.pow(w,6)),y=this,E="";;){var T=Y(y,m).g;y=$(y,T.j(m));var b=((0<y.g.length?y.g[0]:y.h)>>>0).toString(w);if(y=T,k(y))return b+E;for(;6>b.length;)b="0"+b;E=b+E}},n.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function k(w){if(w.h!=0)return!1;for(var m=0;m<w.g.length;m++)if(w.g[m]!=0)return!1;return!0}function V(w){return w.h==-1}n.l=function(w){return w=$(this,w),V(w)?-1:k(w)?0:1};function D(w){for(var m=w.g.length,y=[],E=0;E<m;E++)y[E]=~w.g[E];return new a(y,~w.h).add(v)}n.abs=function(){return V(this)?D(this):this},n.add=function(w){for(var m=Math.max(this.g.length,w.g.length),y=[],E=0,T=0;T<=m;T++){var b=E+(this.i(T)&65535)+(w.i(T)&65535),_=(b>>>16)+(this.i(T)>>>16)+(w.i(T)>>>16);E=_>>>16,b&=65535,_&=65535,y[T]=_<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function $(w,m){return w.add(D(m))}n.j=function(w){if(k(this)||k(w))return g;if(V(this))return V(w)?D(this).j(D(w)):D(D(this).j(w));if(V(w))return D(this.j(D(w)));if(0>this.l(R)&&0>w.l(R))return d(this.m()*w.m());for(var m=this.g.length+w.g.length,y=[],E=0;E<2*m;E++)y[E]=0;for(E=0;E<this.g.length;E++)for(var T=0;T<w.g.length;T++){var b=this.i(E)>>>16,_=this.i(E)&65535,tt=w.i(T)>>>16,Xn=w.i(T)&65535;y[2*E+2*T]+=_*Xn,U(y,2*E+2*T),y[2*E+2*T+1]+=b*Xn,U(y,2*E+2*T+1),y[2*E+2*T+1]+=_*tt,U(y,2*E+2*T+1),y[2*E+2*T+2]+=b*tt,U(y,2*E+2*T+2)}for(E=0;E<m;E++)y[E]=y[2*E+1]<<16|y[2*E];for(E=m;E<2*m;E++)y[E]=0;return new a(y,0)};function U(w,m){for(;(w[m]&65535)!=w[m];)w[m+1]+=w[m]>>>16,w[m]&=65535,m++}function j(w,m){this.g=w,this.h=m}function Y(w,m){if(k(m))throw Error("division by zero");if(k(w))return new j(g,g);if(V(w))return m=Y(D(w),m),new j(D(m.g),D(m.h));if(V(m))return m=Y(w,D(m)),new j(D(m.g),m.h);if(30<w.g.length){if(V(w)||V(m))throw Error("slowDivide_ only works with positive integers.");for(var y=v,E=m;0>=E.l(w);)y=Te(y),E=Te(E);var T=J(y,1),b=J(E,1);for(E=J(E,2),y=J(y,2);!k(E);){var _=b.add(E);0>=_.l(w)&&(T=T.add(y),b=_),E=J(E,1),y=J(y,1)}return m=$(w,T.j(m)),new j(T,m)}for(T=g;0<=w.l(m);){for(y=Math.max(1,Math.floor(w.m()/m.m())),E=Math.ceil(Math.log(y)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),b=d(y),_=b.j(m);V(_)||0<_.l(w);)y-=E,b=d(y),_=b.j(m);k(b)&&(b=v),T=T.add(b),w=$(w,_)}return new j(T,w)}n.A=function(w){return Y(this,w).h},n.and=function(w){for(var m=Math.max(this.g.length,w.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)&w.i(E);return new a(y,this.h&w.h)},n.or=function(w){for(var m=Math.max(this.g.length,w.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)|w.i(E);return new a(y,this.h|w.h)},n.xor=function(w){for(var m=Math.max(this.g.length,w.g.length),y=[],E=0;E<m;E++)y[E]=this.i(E)^w.i(E);return new a(y,this.h^w.h)};function Te(w){for(var m=w.g.length+1,y=[],E=0;E<m;E++)y[E]=w.i(E)<<1|w.i(E-1)>>>31;return new a(y,w.h)}function J(w,m){var y=m>>5;m%=32;for(var E=w.g.length-y,T=[],b=0;b<E;b++)T[b]=0<m?w.i(b+y)>>>m|w.i(b+y+1)<<32-m:w.i(b+y);return new a(T,w.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Wa=nf.Md5=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,ut=nf.Integer=a}).apply(typeof tf<"u"?tf:typeof self<"u"?self:typeof window<"u"?window:{});var es=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},lt={};var Ga,jI,Rn,Ka,Vr,ts,Ha,Qa,Ja;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,c,h){return s==Array.prototype||s==Object.prototype||(s[c]=h.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof es=="object"&&es];for(var c=0;c<s.length;++c){var h=s[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function i(s,c){if(c)e:{var h=r;s=s.split(".");for(var f=0;f<s.length-1;f++){var A=s[f];if(!(A in h))break e;h=h[A]}s=s[s.length-1],f=h[s],c=c(f),c!=f&&c!=null&&e(h,s,{configurable:!0,writable:!0,value:c})}}function o(s,c){s instanceof String&&(s+="");var h=0,f=!1,A={next:function(){if(!f&&h<s.length){var S=h++;return{value:c(S,s[S]),done:!1}}return f=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(s){return s||function(){return o(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(s){var c=typeof s;return c=c!="object"?c:s?Array.isArray(s)?"array":c:"null",c=="array"||c=="object"&&typeof s.length=="number"}function d(s){var c=typeof s;return c=="object"&&s!=null||c=="function"}function p(s,c,h){return s.call.apply(s.bind,arguments)}function g(s,c,h){if(!s)throw Error();if(2<arguments.length){var f=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,f),s.apply(c,A)}}return function(){return s.apply(c,arguments)}}function v(s,c,h){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:g,v.apply(null,arguments)}function R(s,c){var h=Array.prototype.slice.call(arguments,1);return function(){var f=h.slice();return f.push.apply(f,arguments),s.apply(this,f)}}function k(s,c){function h(){}h.prototype=c.prototype,s.aa=c.prototype,s.prototype=new h,s.prototype.constructor=s,s.Qb=function(f,A,S){for(var N=Array(arguments.length-2),X=2;X<arguments.length;X++)N[X-2]=arguments[X];return c.prototype[A].apply(f,N)}}function V(s){let c=s.length;if(0<c){let h=Array(c);for(let f=0;f<c;f++)h[f]=s[f];return h}return[]}function D(s,c){for(let h=1;h<arguments.length;h++){let f=arguments[h];if(l(f)){let A=s.length||0,S=f.length||0;s.length=A+S;for(let N=0;N<S;N++)s[A+N]=f[N]}else s.push(f)}}class ${constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function U(s){return/^[\s\xa0]*$/.test(s)}function j(){var s=u.navigator;return s&&(s=s.userAgent)?s:""}function Y(s){return Y[" "](s),s}Y[" "]=function(){};var Te=j().indexOf("Gecko")!=-1&&!(j().toLowerCase().indexOf("webkit")!=-1&&j().indexOf("Edge")==-1)&&!(j().indexOf("Trident")!=-1||j().indexOf("MSIE")!=-1)&&j().indexOf("Edge")==-1;function J(s,c,h){for(let f in s)c.call(h,s[f],f,s)}function w(s,c){for(let h in s)c.call(void 0,s[h],h,s)}function m(s){let c={};for(let h in s)c[h]=s[h];return c}let y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(s,c){let h,f;for(let A=1;A<arguments.length;A++){f=arguments[A];for(h in f)s[h]=f[h];for(let S=0;S<y.length;S++)h=y[S],Object.prototype.hasOwnProperty.call(f,h)&&(s[h]=f[h])}}function T(s){var c=1;s=s.split(":");let h=[];for(;0<c&&s.length;)h.push(s.shift()),c--;return s.length&&h.push(s.join(":")),h}function b(s){u.setTimeout(()=>{throw s},0)}function _(){var s=eo;let c=null;return s.g&&(c=s.g,s.g=s.g.next,s.g||(s.h=null),c.next=null),c}class tt{constructor(){this.h=this.g=null}add(c,h){let f=Xn.get();f.set(c,h),this.h?this.h.next=f:this.g=f,this.h=f}}var Xn=new $(()=>new Um,s=>s.reset());class Um{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Zn,er=!1,eo=new tt,pl=()=>{let s=u.Promise.resolve(void 0);Zn=()=>{s.then(Bm)}};var Bm=()=>{for(var s;s=_();){try{s.h.call(s.g)}catch(h){b(h)}var c=Xn;c.j(s),100>c.h&&(c.h++,s.next=c.g,c.g=s)}er=!1};function _t(){this.s=this.s,this.C=this.C}_t.prototype.s=!1,_t.prototype.ma=function(){this.s||(this.s=!0,this.N())},_t.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _e(s,c){this.type=s,this.g=this.target=c,this.defaultPrevented=!1}_e.prototype.h=function(){this.defaultPrevented=!0};var qm=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var s=!1,c=Object.defineProperty({},"passive",{get:function(){s=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return s})();function tr(s,c){if(_e.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var h=this.type=s.type,f=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=c,c=s.relatedTarget){if(Te){e:{try{Y(c.nodeName);var A=!0;break e}catch{}A=!1}A||(c=null)}}else h=="mouseover"?c=s.fromElement:h=="mouseout"&&(c=s.toElement);this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:$m[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&tr.aa.h.call(this)}}k(tr,_e);var $m={2:"touch",3:"pen",4:"mouse"};tr.prototype.h=function(){tr.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var nr="closure_listenable_"+(1e6*Math.random()|0),jm=0;function zm(s,c,h,f,A){this.listener=s,this.proxy=null,this.src=c,this.type=h,this.capture=!!f,this.ha=A,this.key=++jm,this.da=this.fa=!1}function si(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function oi(s){this.src=s,this.g={},this.h=0}oi.prototype.add=function(s,c,h,f,A){var S=s.toString();s=this.g[S],s||(s=this.g[S]=[],this.h++);var N=no(s,c,f,A);return-1<N?(c=s[N],h||(c.fa=!1)):(c=new zm(c,this.src,S,!!f,A),c.fa=h,s.push(c)),c};function to(s,c){var h=c.type;if(h in s.g){var f=s.g[h],A=Array.prototype.indexOf.call(f,c,void 0),S;(S=0<=A)&&Array.prototype.splice.call(f,A,1),S&&(si(c),s.g[h].length==0&&(delete s.g[h],s.h--))}}function no(s,c,h,f){for(var A=0;A<s.length;++A){var S=s[A];if(!S.da&&S.listener==c&&S.capture==!!h&&S.ha==f)return A}return-1}var ro="closure_lm_"+(1e6*Math.random()|0),io={};function ml(s,c,h,f,A){if(f&&f.once)return _l(s,c,h,f,A);if(Array.isArray(c)){for(var S=0;S<c.length;S++)ml(s,c[S],h,f,A);return null}return h=co(h),s&&s[nr]?s.K(c,h,d(f)?!!f.capture:!!f,A):gl(s,c,h,!1,f,A)}function gl(s,c,h,f,A,S){if(!c)throw Error("Invalid event type");var N=d(A)?!!A.capture:!!A,X=oo(s);if(X||(s[ro]=X=new oi(s)),h=X.add(c,h,f,N,S),h.proxy)return h;if(f=Wm(),h.proxy=f,f.src=s,f.listener=h,s.addEventListener)qm||(A=N),A===void 0&&(A=!1),s.addEventListener(c.toString(),f,A);else if(s.attachEvent)s.attachEvent(vl(c.toString()),f);else if(s.addListener&&s.removeListener)s.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Wm(){function s(h){return c.call(s.src,s.listener,h)}let c=Gm;return s}function _l(s,c,h,f,A){if(Array.isArray(c)){for(var S=0;S<c.length;S++)_l(s,c[S],h,f,A);return null}return h=co(h),s&&s[nr]?s.L(c,h,d(f)?!!f.capture:!!f,A):gl(s,c,h,!0,f,A)}function yl(s,c,h,f,A){if(Array.isArray(c))for(var S=0;S<c.length;S++)yl(s,c[S],h,f,A);else f=d(f)?!!f.capture:!!f,h=co(h),s&&s[nr]?(s=s.i,c=String(c).toString(),c in s.g&&(S=s.g[c],h=no(S,h,f,A),-1<h&&(si(S[h]),Array.prototype.splice.call(S,h,1),S.length==0&&(delete s.g[c],s.h--)))):s&&(s=oo(s))&&(c=s.g[c.toString()],s=-1,c&&(s=no(c,h,f,A)),(h=-1<s?c[s]:null)&&so(h))}function so(s){if(typeof s!="number"&&s&&!s.da){var c=s.src;if(c&&c[nr])to(c.i,s);else{var h=s.type,f=s.proxy;c.removeEventListener?c.removeEventListener(h,f,s.capture):c.detachEvent?c.detachEvent(vl(h),f):c.addListener&&c.removeListener&&c.removeListener(f),(h=oo(c))?(to(h,s),h.h==0&&(h.src=null,c[ro]=null)):si(s)}}}function vl(s){return s in io?io[s]:io[s]="on"+s}function Gm(s,c){if(s.da)s=!0;else{c=new tr(c,this);var h=s.listener,f=s.ha||s.src;s.fa&&so(s),s=h.call(f,c)}return s}function oo(s){return s=s[ro],s instanceof oi?s:null}var ao="__closure_events_fn_"+(1e9*Math.random()>>>0);function co(s){return typeof s=="function"?s:(s[ao]||(s[ao]=function(c){return s.handleEvent(c)}),s[ao])}function ye(){_t.call(this),this.i=new oi(this),this.M=this,this.F=null}k(ye,_t),ye.prototype[nr]=!0,ye.prototype.removeEventListener=function(s,c,h,f){yl(this,s,c,h,f)};function Ae(s,c){var h,f=s.F;if(f)for(h=[];f;f=f.F)h.push(f);if(s=s.M,f=c.type||c,typeof c=="string")c=new _e(c,s);else if(c instanceof _e)c.target=c.target||s;else{var A=c;c=new _e(f,s),E(c,A)}if(A=!0,h)for(var S=h.length-1;0<=S;S--){var N=c.g=h[S];A=ai(N,f,!0,c)&&A}if(N=c.g=s,A=ai(N,f,!0,c)&&A,A=ai(N,f,!1,c)&&A,h)for(S=0;S<h.length;S++)N=c.g=h[S],A=ai(N,f,!1,c)&&A}ye.prototype.N=function(){if(ye.aa.N.call(this),this.i){var s=this.i,c;for(c in s.g){for(var h=s.g[c],f=0;f<h.length;f++)si(h[f]);delete s.g[c],s.h--}}this.F=null},ye.prototype.K=function(s,c,h,f){return this.i.add(String(s),c,!1,h,f)},ye.prototype.L=function(s,c,h,f){return this.i.add(String(s),c,!0,h,f)};function ai(s,c,h,f){if(c=s.i.g[String(c)],!c)return!0;c=c.concat();for(var A=!0,S=0;S<c.length;++S){var N=c[S];if(N&&!N.da&&N.capture==h){var X=N.listener,ge=N.ha||N.src;N.fa&&to(s.i,N),A=X.call(ge,f)!==!1&&A}}return A&&!f.defaultPrevented}function Il(s,c,h){if(typeof s=="function")h&&(s=v(s,h));else if(s&&typeof s.handleEvent=="function")s=v(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(s,c||0)}function El(s){s.g=Il(()=>{s.g=null,s.i&&(s.i=!1,El(s))},s.l);let c=s.h;s.h=null,s.m.apply(null,c)}class Km extends _t{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:El(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rr(s){_t.call(this),this.h=s,this.g={}}k(rr,_t);var wl=[];function Tl(s){J(s.g,function(c,h){this.g.hasOwnProperty(h)&&so(c)},s),s.g={}}rr.prototype.N=function(){rr.aa.N.call(this),Tl(this)},rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var uo=u.JSON.stringify,Hm=u.JSON.parse,Qm=class{stringify(s){return u.JSON.stringify(s,void 0)}parse(s){return u.JSON.parse(s,void 0)}};function lo(){}lo.prototype.h=null;function Al(s){return s.h||(s.h=s.i())}function bl(){}var ir={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ho(){_e.call(this,"d")}k(ho,_e);function fo(){_e.call(this,"c")}k(fo,_e);var $t={},Sl=null;function ci(){return Sl=Sl||new ye}$t.La="serverreachability";function Rl(s){_e.call(this,$t.La,s)}k(Rl,_e);function sr(s){let c=ci();Ae(c,new Rl(c))}$t.STAT_EVENT="statevent";function Pl(s,c){_e.call(this,$t.STAT_EVENT,s),this.stat=c}k(Pl,_e);function be(s){let c=ci();Ae(c,new Pl(c,s))}$t.Ma="timingevent";function Cl(s,c){_e.call(this,$t.Ma,s),this.size=c}k(Cl,_e);function or(s,c){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){s()},c)}function ar(){this.g=!0}ar.prototype.xa=function(){this.g=!1};function Jm(s,c,h,f,A,S){s.info(function(){if(s.g)if(S)for(var N="",X=S.split("&"),ge=0;ge<X.length;ge++){var H=X[ge].split("=");if(1<H.length){var ve=H[0];H=H[1];var Ie=ve.split("_");N=2<=Ie.length&&Ie[1]=="type"?N+(ve+"="+H+"&"):N+(ve+"=redacted&")}}else N=null;else N=S;return"XMLHTTP REQ ("+f+") [attempt "+A+"]: "+c+`
`+h+`
`+N})}function Ym(s,c,h,f,A,S,N){s.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+A+"]: "+c+`
`+h+`
`+S+" "+N})}function gn(s,c,h,f){s.info(function(){return"XMLHTTP TEXT ("+c+"): "+Zm(s,h)+(f?" "+f:"")})}function Xm(s,c){s.info(function(){return"TIMEOUT: "+c})}ar.prototype.info=function(){};function Zm(s,c){if(!s.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(s=0;s<h.length;s++)if(Array.isArray(h[s])){var f=h[s];if(!(2>f.length)){var A=f[1];if(Array.isArray(A)&&!(1>A.length)){var S=A[0];if(S!="noop"&&S!="stop"&&S!="close")for(var N=1;N<A.length;N++)A[N]=""}}}}return uo(h)}catch{return c}}var ui={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},kl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},po;function li(){}k(li,lo),li.prototype.g=function(){return new XMLHttpRequest},li.prototype.i=function(){return{}},po=new li;function yt(s,c,h,f){this.j=s,this.i=c,this.l=h,this.R=f||1,this.U=new rr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Dl}function Dl(){this.i=null,this.g="",this.h=!1}var Nl={},mo={};function go(s,c,h){s.L=1,s.v=pi(nt(c)),s.m=h,s.P=!0,Ol(s,null)}function Ol(s,c){s.F=Date.now(),hi(s),s.A=nt(s.v);var h=s.A,f=s.R;Array.isArray(f)||(f=[String(f)]),Kl(h.i,"t",f),s.C=0,h=s.j.J,s.h=new Dl,s.g=hh(s.j,h?c:null,!s.m),0<s.O&&(s.M=new Km(v(s.Y,s,s.g),s.O)),c=s.U,h=s.g,f=s.ca;var A="readystatechange";Array.isArray(A)||(A&&(wl[0]=A.toString()),A=wl);for(var S=0;S<A.length;S++){var N=ml(h,A[S],f||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=s.H?m(s.H):{},s.m?(s.u||(s.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,c)):(s.u="GET",s.g.ea(s.A,s.u,null,c)),sr(),Jm(s.i,s.u,s.A,s.l,s.R,s.m)}yt.prototype.ca=function(s){s=s.target;let c=this.M;c&&rt(s)==3?c.j():this.Y(s)},yt.prototype.Y=function(s){try{if(s==this.g)e:{let Ie=rt(this.g);var c=this.g.Ba();let vn=this.g.Z();if(!(3>Ie)&&(Ie!=3||this.g&&(this.h.h||this.g.oa()||eh(this.g)))){this.J||Ie!=4||c==7||(c==8||0>=vn?sr(3):sr(2)),_o(this);var h=this.g.Z();this.X=h;t:if(Vl(this)){var f=eh(this.g);s="";var A=f.length,S=rt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){jt(this),cr(this);var N="";break t}this.h.i=new u.TextDecoder}for(c=0;c<A;c++)this.h.h=!0,s+=this.h.i.decode(f[c],{stream:!(S&&c==A-1)});f.length=0,this.h.g+=s,this.C=0,N=this.h.g}else N=this.g.oa();if(this.o=h==200,Ym(this.i,this.u,this.A,this.l,this.R,Ie,h),this.o){if(this.T&&!this.K){t:{if(this.g){var X,ge=this.g;if((X=ge.g?ge.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(X)){var H=X;break t}}H=null}if(h=H)gn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,yo(this,h);else{this.o=!1,this.s=3,be(12),jt(this),cr(this);break e}}if(this.P){h=!0;let Le;for(;!this.J&&this.C<N.length;)if(Le=eg(this,N),Le==mo){Ie==4&&(this.s=4,be(14),h=!1),gn(this.i,this.l,null,"[Incomplete Response]");break}else if(Le==Nl){this.s=4,be(15),gn(this.i,this.l,N,"[Invalid Chunk]"),h=!1;break}else gn(this.i,this.l,Le,null),yo(this,Le);if(Vl(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ie!=4||N.length!=0||this.h.h||(this.s=1,be(16),h=!1),this.o=this.o&&h,!h)gn(this.i,this.l,N,"[Invalid Chunked Response]"),jt(this),cr(this);else if(0<N.length&&!this.W){this.W=!0;var ve=this.j;ve.g==this&&ve.ba&&!ve.M&&(ve.j.info("Great, no buffering proxy detected. Bytes received: "+N.length),Ao(ve),ve.M=!0,be(11))}}else gn(this.i,this.l,N,null),yo(this,N);Ie==4&&jt(this),this.o&&!this.J&&(Ie==4?ah(this.j,this):(this.o=!1,hi(this)))}else _g(this.g),h==400&&0<N.indexOf("Unknown SID")?(this.s=3,be(12)):(this.s=0,be(13)),jt(this),cr(this)}}}catch{}finally{}};function Vl(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function eg(s,c){var h=s.C,f=c.indexOf(`
`,h);return f==-1?mo:(h=Number(c.substring(h,f)),isNaN(h)?Nl:(f+=1,f+h>c.length?mo:(c=c.slice(f,f+h),s.C=f+h,c)))}yt.prototype.cancel=function(){this.J=!0,jt(this)};function hi(s){s.S=Date.now()+s.I,xl(s,s.I)}function xl(s,c){if(s.B!=null)throw Error("WatchDog timer not null");s.B=or(v(s.ba,s),c)}function _o(s){s.B&&(u.clearTimeout(s.B),s.B=null)}yt.prototype.ba=function(){this.B=null;let s=Date.now();0<=s-this.S?(Xm(this.i,this.A),this.L!=2&&(sr(),be(17)),jt(this),this.s=2,cr(this)):xl(this,this.S-s)};function cr(s){s.j.G==0||s.J||ah(s.j,s)}function jt(s){_o(s);var c=s.M;c&&typeof c.ma=="function"&&c.ma(),s.M=null,Tl(s.U),s.g&&(c=s.g,s.g=null,c.abort(),c.ma())}function yo(s,c){try{var h=s.j;if(h.G!=0&&(h.g==s||vo(h.h,s))){if(!s.K&&vo(h.h,s)&&h.G==3){try{var f=h.Da.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var A=f;if(A[0]==0){e:if(!h.u){if(h.g)if(h.g.F+3e3<s.F)vi(h),_i(h);else break e;To(h),be(18)}}else h.za=A[1],0<h.za-h.T&&37500>A[2]&&h.F&&h.v==0&&!h.C&&(h.C=or(v(h.Za,h),6e3));if(1>=Fl(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Wt(h,11)}else if((s.K||h.g==s)&&vi(h),!U(c))for(A=h.Da.g.parse(c),c=0;c<A.length;c++){let H=A[c];if(h.T=H[0],H=H[1],h.G==2)if(H[0]=="c"){h.K=H[1],h.ia=H[2];let ve=H[3];ve!=null&&(h.la=ve,h.j.info("VER="+h.la));let Ie=H[4];Ie!=null&&(h.Aa=Ie,h.j.info("SVER="+h.Aa));let vn=H[5];vn!=null&&typeof vn=="number"&&0<vn&&(f=1.5*vn,h.L=f,h.j.info("backChannelRequestTimeoutMs_="+f)),f=h;let Le=s.g;if(Le){let Ei=Le.g?Le.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ei){var S=f.h;S.g||Ei.indexOf("spdy")==-1&&Ei.indexOf("quic")==-1&&Ei.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Io(S,S.h),S.h=null))}if(f.D){let bo=Le.g?Le.g.getResponseHeader("X-HTTP-Session-Id"):null;bo&&(f.ya=bo,Z(f.I,f.D,bo))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-s.F,h.j.info("Handshake RTT: "+h.R+"ms")),f=h;var N=s;if(f.qa=lh(f,f.J?f.ia:null,f.W),N.K){Ul(f.h,N);var X=N,ge=f.L;ge&&(X.I=ge),X.B&&(_o(X),hi(X)),f.g=N}else sh(f);0<h.i.length&&yi(h)}else H[0]!="stop"&&H[0]!="close"||Wt(h,7);else h.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?Wt(h,7):wo(h):H[0]!="noop"&&h.l&&h.l.ta(H),h.v=0)}}sr(4)}catch{}}var tg=class{constructor(s,c){this.g=s,this.map=c}};function Ll(s){this.l=s||10,u.PerformanceNavigationTiming?(s=u.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ml(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Fl(s){return s.h?1:s.g?s.g.size:0}function vo(s,c){return s.h?s.h==c:s.g?s.g.has(c):!1}function Io(s,c){s.g?s.g.add(c):s.h=c}function Ul(s,c){s.h&&s.h==c?s.h=null:s.g&&s.g.has(c)&&s.g.delete(c)}Ll.prototype.cancel=function(){if(this.i=Bl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let s of this.g.values())s.cancel();this.g.clear()}};function Bl(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let c=s.i;for(let h of s.g.values())c=c.concat(h.D);return c}return V(s.i)}function ng(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(l(s)){for(var c=[],h=s.length,f=0;f<h;f++)c.push(s[f]);return c}c=[],h=0;for(f in s)c[h++]=s[f];return c}function rg(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(l(s)||typeof s=="string"){var c=[];s=s.length;for(var h=0;h<s;h++)c.push(h);return c}c=[],h=0;for(let f in s)c[h++]=f;return c}}}function ql(s,c){if(s.forEach&&typeof s.forEach=="function")s.forEach(c,void 0);else if(l(s)||typeof s=="string")Array.prototype.forEach.call(s,c,void 0);else for(var h=rg(s),f=ng(s),A=f.length,S=0;S<A;S++)c.call(void 0,f[S],h&&h[S],s)}var $l=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ig(s,c){if(s){s=s.split("&");for(var h=0;h<s.length;h++){var f=s[h].indexOf("="),A=null;if(0<=f){var S=s[h].substring(0,f);A=s[h].substring(f+1)}else S=s[h];c(S,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function zt(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof zt){this.h=s.h,di(this,s.j),this.o=s.o,this.g=s.g,fi(this,s.s),this.l=s.l;var c=s.i,h=new hr;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),jl(this,h),this.m=s.m}else s&&(c=String(s).match($l))?(this.h=!1,di(this,c[1]||"",!0),this.o=ur(c[2]||""),this.g=ur(c[3]||"",!0),fi(this,c[4]),this.l=ur(c[5]||"",!0),jl(this,c[6]||"",!0),this.m=ur(c[7]||"")):(this.h=!1,this.i=new hr(null,this.h))}zt.prototype.toString=function(){var s=[],c=this.j;c&&s.push(lr(c,zl,!0),":");var h=this.g;return(h||c=="file")&&(s.push("//"),(c=this.o)&&s.push(lr(c,zl,!0),"@"),s.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&s.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&s.push("/"),s.push(lr(h,h.charAt(0)=="/"?ag:og,!0))),(h=this.i.toString())&&s.push("?",h),(h=this.m)&&s.push("#",lr(h,ug)),s.join("")};function nt(s){return new zt(s)}function di(s,c,h){s.j=h?ur(c,!0):c,s.j&&(s.j=s.j.replace(/:$/,""))}function fi(s,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);s.s=c}else s.s=null}function jl(s,c,h){c instanceof hr?(s.i=c,lg(s.i,s.h)):(h||(c=lr(c,cg)),s.i=new hr(c,s.h))}function Z(s,c,h){s.i.set(c,h)}function pi(s){return Z(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function ur(s,c){return s?c?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function lr(s,c,h){return typeof s=="string"?(s=encodeURI(s).replace(c,sg),h&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function sg(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var zl=/[#\/\?@]/g,og=/[#\?:]/g,ag=/[#\?]/g,cg=/[#\?@]/g,ug=/#/g;function hr(s,c){this.h=this.g=null,this.i=s||null,this.j=!!c}function vt(s){s.g||(s.g=new Map,s.h=0,s.i&&ig(s.i,function(c,h){s.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=hr.prototype,n.add=function(s,c){vt(this),this.i=null,s=_n(this,s);var h=this.g.get(s);return h||this.g.set(s,h=[]),h.push(c),this.h+=1,this};function Wl(s,c){vt(s),c=_n(s,c),s.g.has(c)&&(s.i=null,s.h-=s.g.get(c).length,s.g.delete(c))}function Gl(s,c){return vt(s),c=_n(s,c),s.g.has(c)}n.forEach=function(s,c){vt(this),this.g.forEach(function(h,f){h.forEach(function(A){s.call(c,A,f,this)},this)},this)},n.na=function(){vt(this);let s=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let f=0;f<c.length;f++){let A=s[f];for(let S=0;S<A.length;S++)h.push(c[f])}return h},n.V=function(s){vt(this);let c=[];if(typeof s=="string")Gl(this,s)&&(c=c.concat(this.g.get(_n(this,s))));else{s=Array.from(this.g.values());for(let h=0;h<s.length;h++)c=c.concat(s[h])}return c},n.set=function(s,c){return vt(this),this.i=null,s=_n(this,s),Gl(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[c]),this.h+=1,this},n.get=function(s,c){return s?(s=this.V(s),0<s.length?String(s[0]):c):c};function Kl(s,c,h){Wl(s,c),0<h.length&&(s.i=null,s.g.set(_n(s,c),V(h)),s.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let s=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var f=c[h];let S=encodeURIComponent(String(f)),N=this.V(f);for(f=0;f<N.length;f++){var A=S;N[f]!==""&&(A+="="+encodeURIComponent(String(N[f]))),s.push(A)}}return this.i=s.join("&")};function _n(s,c){return c=String(c),s.j&&(c=c.toLowerCase()),c}function lg(s,c){c&&!s.j&&(vt(s),s.i=null,s.g.forEach(function(h,f){var A=f.toLowerCase();f!=A&&(Wl(this,f),Kl(this,A,h))},s)),s.j=c}function hg(s,c){let h=new ar;if(u.Image){let f=new Image;f.onload=R(It,h,"TestLoadImage: loaded",!0,c,f),f.onerror=R(It,h,"TestLoadImage: error",!1,c,f),f.onabort=R(It,h,"TestLoadImage: abort",!1,c,f),f.ontimeout=R(It,h,"TestLoadImage: timeout",!1,c,f),u.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=s}else c(!1)}function dg(s,c){let h=new ar,f=new AbortController,A=setTimeout(()=>{f.abort(),It(h,"TestPingServer: timeout",!1,c)},1e4);fetch(s,{signal:f.signal}).then(S=>{clearTimeout(A),S.ok?It(h,"TestPingServer: ok",!0,c):It(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),It(h,"TestPingServer: error",!1,c)})}function It(s,c,h,f,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),f(h)}catch{}}function fg(){this.g=new Qm}function pg(s,c,h){let f=h||"";try{ql(s,function(A,S){let N=A;d(A)&&(N=uo(A)),c.push(f+S+"="+encodeURIComponent(N))})}catch(A){throw c.push(f+"type="+encodeURIComponent("_badmap")),A}}function dr(s){this.l=s.Ub||null,this.j=s.eb||!1}k(dr,lo),dr.prototype.g=function(){return new mi(this.l,this.j)},dr.prototype.i=(function(s){return function(){return s}})({});function mi(s,c){ye.call(this),this.D=s,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(mi,ye),n=mi.prototype,n.open=function(s,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=c,this.readyState=1,pr(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(c.body=s),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fr(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,pr(this)),this.g&&(this.readyState=3,pr(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Hl(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function Hl(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var c=s.value?s.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!s.done}))&&(this.response=this.responseText+=c)}s.done?fr(this):pr(this),this.readyState==3&&Hl(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,fr(this))},n.Qa=function(s){this.g&&(this.response=s,fr(this))},n.ga=function(){this.g&&fr(this)};function fr(s){s.readyState=4,s.l=null,s.j=null,s.v=null,pr(s)}n.setRequestHeader=function(s,c){this.u.append(s,c)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let s=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,s.push(h[0]+": "+h[1]),h=c.next();return s.join(`\r
`)};function pr(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(mi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Ql(s){let c="";return J(s,function(h,f){c+=f,c+=":",c+=h,c+=`\r
`}),c}function Eo(s,c,h){e:{for(f in h){var f=!1;break e}f=!0}f||(h=Ql(h),typeof s=="string"?h!=null&&encodeURIComponent(String(h)):Z(s,c,h))}function ne(s){ye.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(ne,ye);var mg=/^https?$/i,gg=["POST","PUT"];n=ne.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,c,h,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);c=c?c.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():po.g(),this.v=this.o?Al(this.o):Al(po),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(c,String(s),!0),this.B=!1}catch(S){Jl(this,S);return}if(s=h||"",h=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var A in f)h.set(A,f[A]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(let S of f.keys())h.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(h.keys()).find(S=>S.toLowerCase()=="content-type"),A=u.FormData&&s instanceof u.FormData,!(0<=Array.prototype.indexOf.call(gg,c,void 0))||f||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[S,N]of h)this.g.setRequestHeader(S,N);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Zl(this),this.u=!0,this.g.send(s),this.u=!1}catch(S){Jl(this,S)}};function Jl(s,c){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=c,s.m=5,Yl(s),gi(s)}function Yl(s){s.A||(s.A=!0,Ae(s,"complete"),Ae(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,Ae(this,"complete"),Ae(this,"abort"),gi(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gi(this,!0)),ne.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Xl(this):this.bb())},n.bb=function(){Xl(this)};function Xl(s){if(s.h&&typeof a<"u"&&(!s.v[1]||rt(s)!=4||s.Z()!=2)){if(s.u&&rt(s)==4)Il(s.Ea,0,s);else if(Ae(s,"readystatechange"),rt(s)==4){s.h=!1;try{let N=s.Z();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var f;if(f=N===0){var A=String(s.D).match($l)[1]||null;!A&&u.self&&u.self.location&&(A=u.self.location.protocol.slice(0,-1)),f=!mg.test(A?A.toLowerCase():"")}h=f}if(h)Ae(s,"complete"),Ae(s,"success");else{s.m=6;try{var S=2<rt(s)?s.g.statusText:""}catch{S=""}s.l=S+" ["+s.Z()+"]",Yl(s)}}finally{gi(s)}}}}function gi(s,c){if(s.g){Zl(s);let h=s.g,f=s.v[0]?()=>{}:null;s.g=null,s.v=null,c||Ae(s,"ready");try{h.onreadystatechange=f}catch{}}}function Zl(s){s.I&&(u.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function rt(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<rt(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var c=this.g.responseText;return s&&c.indexOf(s)==0&&(c=c.substring(s.length)),Hm(c)}};function eh(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function _g(s){let c={};s=(s.g&&2<=rt(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<s.length;f++){if(U(s[f]))continue;var h=T(s[f]);let A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let S=c[A]||[];c[A]=S,S.push(h)}w(c,function(f){return f.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function mr(s,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[s]||c}function th(s){this.Aa=0,this.i=[],this.j=new ar,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=mr("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=mr("baseRetryDelayMs",5e3,s),this.cb=mr("retryDelaySeedMs",1e4,s),this.Wa=mr("forwardChannelMaxRetries",2,s),this.wa=mr("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new Ll(s&&s.concurrentRequestLimit),this.Da=new fg,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=th.prototype,n.la=8,n.G=1,n.connect=function(s,c,h,f){be(0),this.W=s,this.H=c||{},h&&f!==void 0&&(this.H.OSID=h,this.H.OAID=f),this.F=this.X,this.I=lh(this,null,this.W),yi(this)};function wo(s){if(nh(s),s.G==3){var c=s.U++,h=nt(s.I);if(Z(h,"SID",s.K),Z(h,"RID",c),Z(h,"TYPE","terminate"),gr(s,h),c=new yt(s,s.j,c),c.L=2,c.v=pi(nt(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=hh(c.j,null),c.g.ea(c.v)),c.F=Date.now(),hi(c)}uh(s)}function _i(s){s.g&&(Ao(s),s.g.cancel(),s.g=null)}function nh(s){_i(s),s.u&&(u.clearTimeout(s.u),s.u=null),vi(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&u.clearTimeout(s.s),s.s=null)}function yi(s){if(!Ml(s.h)&&!s.s){s.s=!0;var c=s.Ga;Zn||pl(),er||(Zn(),er=!0),eo.add(c,s),s.B=0}}function yg(s,c){return Fl(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=c.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=or(v(s.Ga,s,c),ch(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;let A=new yt(this,this.j,s),S=this.o;if(this.S&&(S?(S=m(S),E(S,this.S)):S=this.S),this.m!==null||this.O||(A.H=S,S=null),this.P)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var f=this.i[h];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break t}f=void 0}if(f===void 0)break;if(c+=f,4096<c){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=ih(this,A,c),h=nt(this.I),Z(h,"RID",s),Z(h,"CVER",22),this.D&&Z(h,"X-HTTP-Session-Id",this.D),gr(this,h),S&&(this.O?c="headers="+encodeURIComponent(String(Ql(S)))+"&"+c:this.m&&Eo(h,this.m,S)),Io(this.h,A),this.Ua&&Z(h,"TYPE","init"),this.P?(Z(h,"$req",c),Z(h,"SID","null"),A.T=!0,go(A,h,null)):go(A,h,c),this.G=2}}else this.G==3&&(s?rh(this,s):this.i.length==0||Ml(this.h)||rh(this))};function rh(s,c){var h;c?h=c.l:h=s.U++;let f=nt(s.I);Z(f,"SID",s.K),Z(f,"RID",h),Z(f,"AID",s.T),gr(s,f),s.m&&s.o&&Eo(f,s.m,s.o),h=new yt(s,s.j,h,s.B+1),s.m===null&&(h.H=s.o),c&&(s.i=c.D.concat(s.i)),c=ih(s,h,1e3),h.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),Io(s.h,h),go(h,f,c)}function gr(s,c){s.H&&J(s.H,function(h,f){Z(c,f,h)}),s.l&&ql({},function(h,f){Z(c,f,h)})}function ih(s,c,h){h=Math.min(s.i.length,h);var f=s.l?v(s.l.Na,s.l,s):null;e:{var A=s.i;let S=-1;for(;;){let N=["count="+h];S==-1?0<h?(S=A[0].g,N.push("ofs="+S)):S=0:N.push("ofs="+S);let X=!0;for(let ge=0;ge<h;ge++){let H=A[ge].g,ve=A[ge].map;if(H-=S,0>H)S=Math.max(0,A[ge].g-100),X=!1;else try{pg(ve,N,"req"+H+"_")}catch{f&&f(ve)}}if(X){f=N.join("&");break e}}}return s=s.i.splice(0,h),c.D=s,f}function sh(s){if(!s.g&&!s.u){s.Y=1;var c=s.Fa;Zn||pl(),er||(Zn(),er=!0),eo.add(c,s),s.v=0}}function To(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=or(v(s.Fa,s),ch(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,oh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=or(v(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,be(10),_i(this),oh(this))};function Ao(s){s.A!=null&&(u.clearTimeout(s.A),s.A=null)}function oh(s){s.g=new yt(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var c=nt(s.qa);Z(c,"RID","rpc"),Z(c,"SID",s.K),Z(c,"AID",s.T),Z(c,"CI",s.F?"0":"1"),!s.F&&s.ja&&Z(c,"TO",s.ja),Z(c,"TYPE","xmlhttp"),gr(s,c),s.m&&s.o&&Eo(c,s.m,s.o),s.L&&(s.g.I=s.L);var h=s.g;s=s.ia,h.L=1,h.v=pi(nt(c)),h.m=null,h.P=!0,Ol(h,s)}n.Za=function(){this.C!=null&&(this.C=null,_i(this),To(this),be(19))};function vi(s){s.C!=null&&(u.clearTimeout(s.C),s.C=null)}function ah(s,c){var h=null;if(s.g==c){vi(s),Ao(s),s.g=null;var f=2}else if(vo(s.h,c))h=c.D,Ul(s.h,c),f=1;else return;if(s.G!=0){if(c.o)if(f==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var A=s.B;f=ci(),Ae(f,new Cl(f,h)),yi(s)}else sh(s);else if(A=c.s,A==3||A==0&&0<c.X||!(f==1&&yg(s,c)||f==2&&To(s)))switch(h&&0<h.length&&(c=s.h,c.i=c.i.concat(h)),A){case 1:Wt(s,5);break;case 4:Wt(s,10);break;case 3:Wt(s,6);break;default:Wt(s,2)}}}function ch(s,c){let h=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(h*=2),h*c}function Wt(s,c){if(s.j.info("Error code "+c),c==2){var h=v(s.fb,s),f=s.Xa;let A=!f;f=new zt(f||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||di(f,"https"),pi(f),A?hg(f.toString(),h):dg(f.toString(),h)}else be(2);s.G=0,s.l&&s.l.sa(c),uh(s),nh(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))};function uh(s){if(s.G=0,s.ka=[],s.l){let c=Bl(s.h);(c.length!=0||s.i.length!=0)&&(D(s.ka,c),D(s.ka,s.i),s.h.i.length=0,V(s.i),s.i.length=0),s.l.ra()}}function lh(s,c,h){var f=h instanceof zt?nt(h):new zt(h);if(f.g!="")c&&(f.g=c+"."+f.g),fi(f,f.s);else{var A=u.location;f=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;var S=new zt(null);f&&di(S,f),c&&(S.g=c),A&&fi(S,A),h&&(S.l=h),f=S}return h=s.D,c=s.ya,h&&c&&Z(f,h,c),Z(f,"VER",s.la),gr(s,f),f}function hh(s,c,h){if(c&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=s.Ca&&!s.pa?new ne(new dr({eb:h})):new ne(s.pa),c.Ha(s.J),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function dh(){}n=dh.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ii(){}Ii.prototype.g=function(s,c){return new Re(s,c)};function Re(s,c){ye.call(this),this.g=new th(c),this.l=s,this.h=c&&c.messageUrlParams||null,s=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(s?s["X-WebChannel-Content-Type"]=c.messageContentType:s={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(s?s["X-WebChannel-Client-Profile"]=c.va:s={"X-WebChannel-Client-Profile":c.va}),this.g.S=s,(s=c&&c.Sb)&&!U(s)&&(this.g.m=s),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!U(c)&&(this.g.D=c,s=this.h,s!==null&&c in s&&(s=this.h,c in s&&delete s[c])),this.j=new yn(this)}k(Re,ye),Re.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Re.prototype.close=function(){wo(this.g)},Re.prototype.o=function(s){var c=this.g;if(typeof s=="string"){var h={};h.__data__=s,s=h}else this.u&&(h={},h.__data__=uo(s),s=h);c.i.push(new tg(c.Ya++,s)),c.G==3&&yi(c)},Re.prototype.N=function(){this.g.l=null,delete this.j,wo(this.g),delete this.g,Re.aa.N.call(this)};function fh(s){ho.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var c=s.__sm__;if(c){e:{for(let h in c){s=h;break e}s=void 0}(this.i=s)&&(s=this.i,c=c!==null&&s in c?c[s]:void 0),this.data=c}else this.data=s}k(fh,ho);function ph(){fo.call(this),this.status=1}k(ph,fo);function yn(s){this.g=s}k(yn,dh),yn.prototype.ua=function(){Ae(this.g,"a")},yn.prototype.ta=function(s){Ae(this.g,new fh(s))},yn.prototype.sa=function(s){Ae(this.g,new ph)},yn.prototype.ra=function(){Ae(this.g,"b")},Ii.prototype.createWebChannel=Ii.prototype.g,Re.prototype.send=Re.prototype.o,Re.prototype.open=Re.prototype.m,Re.prototype.close=Re.prototype.close,Ja=lt.createWebChannelTransport=function(){return new Ii},Qa=lt.getStatEventTarget=function(){return ci()},Ha=lt.Event=$t,ts=lt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ui.NO_ERROR=0,ui.TIMEOUT=8,ui.HTTP_ERROR=6,Vr=lt.ErrorCode=ui,kl.COMPLETE="complete",Ka=lt.EventType=kl,bl.EventType=ir,ir.OPEN="a",ir.CLOSE="b",ir.ERROR="c",ir.MESSAGE="d",ye.prototype.listen=ye.prototype.K,Rn=lt.WebChannel=bl,jI=lt.FetchXmlHttpFactory=dr,ne.prototype.listenOnce=ne.prototype.L,ne.prototype.getLastError=ne.prototype.Ka,ne.prototype.getLastErrorCode=ne.prototype.Ba,ne.prototype.getStatus=ne.prototype.Z,ne.prototype.getResponseJson=ne.prototype.Oa,ne.prototype.getResponseText=ne.prototype.oa,ne.prototype.send=ne.prototype.ea,ne.prototype.setWithCredentials=ne.prototype.Ha,Ga=lt.XhrIo=ne}).apply(typeof es<"u"?es:typeof self<"u"?self:typeof window<"u"?window:{});var rf="@firebase/firestore",sf="4.8.0";var pe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};pe.UNAUTHENTICATED=new pe(null),pe.GOOGLE_CREDENTIALS=new pe("google-credentials-uid"),pe.FIRST_PARTY=new pe("first-party-uid"),pe.MOCK_USER=new pe("mock-user");var Hn="11.10.0";var an=new Ge("@firebase/firestore");function Pn(){return an.logLevel}function x(n,...e){if(an.logLevel<=W.DEBUG){let t=e.map(Fu);an.debug(`Firestore (${Hn}): ${n}`,...t)}}function dt(n,...e){if(an.logLevel<=W.ERROR){let t=e.map(Fu);an.error(`Firestore (${Hn}): ${n}`,...t)}}function Mt(n,...e){if(an.logLevel<=W.WARN){let t=e.map(Fu);an.warn(`Firestore (${Hn}): ${n}`,...t)}}function Fu(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function M(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,Yf(n,r,t)}function Yf(n,e,t){let r=`FIRESTORE (${Hn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw dt(r),new Error(r)}function Q(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||Yf(e,i,r)}function B(n,e){return n}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},O=class extends Pe{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Be=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var cs=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},tc=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(pe.UNAUTHENTICATED))}shutdown(){}},nc=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},rc=class{constructor(e){this.t=e,this.currentUser=pe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(this.o===void 0,42304);let r=this.i,i=l=>this.i!==r?(r=this.i,t(l)):Promise.resolve(),o=new Be;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Be,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=o;e.enqueueRetryable(()=>I(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{x("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(x("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Be)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(x("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new cs(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return Q(e===null||typeof e=="string",2055,{h:e}),new pe(e)}},ic=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=pe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},sc=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new ic(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(pe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},us=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},oc=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Oe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Q(this.o===void 0,3512);let r=o=>{o.error!=null&&x("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);let a=o.token!==this.m;return this.m=o.token,x("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>r(o))};let i=o=>{x("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>i(o)),setTimeout(()=>{if(!this.appCheck){let o=this.V.getImmediate({optional:!0});o?i(o):x("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new us(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Q(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new us(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function zI(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function Xf(){return new TextEncoder}var Br=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=zI(40);for(let o=0;o<i.length;++o)r.length<20&&i[o]<t&&(r+=e.charAt(i[o]%62))}return r}};function z(n,e){return n<e?-1:n>e?1:0}function ac(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return z(r,i);{let o=Xf(),a=WI(o.encode(of(n,t)),o.encode(of(e,t)));return a!==0?a:z(r,i)}}t+=r>65535?2:1}return z(n.length,e.length)}function of(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function WI(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return z(n[t],e[t]);return z(n.length,e.length)}function xn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}var af="__name__",ls=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&M(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&M(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let o=n.compareSegments(e.get(i),t.get(i));if(o!==0)return o}return z(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):ac(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ut.fromString(e.substring(4,e.length-2))}},te=class n extends ls{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new O(P.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},GI=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ke=class n extends ls{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return GI.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===af}static keyField(){return new n([af])}static fromServerFormat(e){let t=[],r="",i=0,o=()=>{if(r.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new O(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new O(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(o(),i++)}if(o(),a)throw new O(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var L=class n{constructor(e){this.path=e}static fromPath(e){return new n(te.fromString(e))}static fromName(e){return new n(te.fromString(e).popFirst(5))}static empty(){return new n(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new te(e.slice()))}};function Zf(n,e,t){if(!t)throw new O(P.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function KI(n,e,t,r){if(e===!0&&r===!0)throw new O(P.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function cf(n){if(!L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function uf(n){if(L.isDocumentKey(n))throw new O(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ep(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function $s(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":M(12329,{type:typeof n})}function De(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=$s(n);throw new O(P.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ue(n,e){let t={typeString:n};return e&&(t.value=e),t}function ei(n,e){if(!ep(n))throw new O(P.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,o="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let a=n[r];if(i&&typeof a!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${r}' field to equal '${o.value}'`;break}}if(t)throw new O(P.INVALID_ARGUMENT,t);return!0}var lf=-62135596800,hf=1e6,le=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*hf);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<lf)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/hf}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ei(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-lf;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};le._jsonSchemaVersion="firestore/timestamp/1.0",le._jsonSchema={type:ue("string",le._jsonSchemaVersion),seconds:ue("number"),nanoseconds:ue("number")};var q=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new le(0,0))}static max(){return new n(new le(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var qr=-1,cc=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};cc.UNKNOWN_ID=-1;function HI(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=q.fromTimestamp(r===1e9?new le(t+1,0):new le(t,r));return new cn(i,L.empty(),e)}function QI(n){return new cn(n.readTime,n.key,qr)}var cn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(q.min(),L.empty(),qr)}static max(){return new n(q.max(),L.empty(),qr)}};function JI(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=L.comparator(n.documentKey,e.documentKey),t!==0?t:z(n.largestBatchId,e.largestBatchId))}var YI="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",uc=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Qn(n){return I(this,null,function*(){if(n.code!==P.FAILED_PRECONDITION||n.message!==YI)throw n;x("LocalStore","Unexpectedly lost primary lease")})}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(r,i)},this.catchCallback=o=>{this.wrapFailure(t,o).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,o=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++o,a&&o===i&&t()},l=>r(l))}),a=!0,o===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,o)=>{r.push(t.call(this,i,o))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let o=e.length,a=new Array(o),u=0;for(let l=0;l<o;l++){let d=l;t(e[d]).next(p=>{a[d]=p,++u,u===o&&r(a)},p=>i(p))}})}static doWhile(e,t){return new n((r,i)=>{let o=()=>{e()===!0?t().next(()=>{o()},i):r()};o()})}};function XI(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Jn(n){return n.name==="IndexedDbTransactionError"}var Uu=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),Bu=-1;function js(n){return n==null}function $r(n){return n===0&&1/n==-1/0}function ZI(n){return typeof n=="number"&&Number.isInteger(n)&&!$r(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var tp="";function eE(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=df(e)),e=tE(n.get(t),e);return df(e)}function tE(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let o=n.charAt(i);switch(o){case"\0":t+="";break;case tp:t+="";break;default:t+=o}}return t}function df(n){return n+tp+""}var nE="remoteDocuments",np="owner";var rp="mutationQueues";var ip="mutations";var sp="documentMutations",rE="remoteDocumentsV14";var op="remoteDocumentGlobal";var ap="targets";var cp="targetDocuments";var up="targetGlobal",lp="collectionParents";var hp="clientMetadata";var dp="bundles";var fp="namedQueries";var iE="indexConfiguration";var sE="indexState";var oE="indexEntries";var pp="documentOverlays";var aE="globals";var cE=[rp,ip,sp,nE,ap,np,up,cp,hp,op,lp,dp,fp],Jb=[...cE,pp],uE=[rp,ip,sp,rE,ap,np,up,cp,hp,op,lp,dp,fp,pp],lE=uE,hE=[...lE,iE,sE,oE];var Yb=[...hE,aE];function ff(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function qt(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function mp(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ie=class n{constructor(e,t){this.comparator=e,this.root=t||Qe.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qe.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Nn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Nn(this.root,e,this.comparator,!1)}getReverseIterator(){return new Nn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Nn(this.root,e,this.comparator,!0)}},Nn=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?r(e.key,t):1,t&&i&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Qe=class n{constructor(e,t,r,i,o){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,o){return new n(e??this.key,t??this.value,r??this.color,i??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,o=r(e,i.key);return i=o<0?i.copy(null,null,null,i.left.insert(e,t,r),null):o===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw M(27949);return e+(this.isRed()?0:1)}};Qe.EMPTY=null,Qe.RED=!0,Qe.BLACK=!1;Qe.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(e,t,r,i,o){return this}insert(e,t,r){return new Qe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var me=class n{constructor(e){this.comparator=e,this.data=new ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new hs(this.data.getIterator())}getIteratorFrom(e){return new hs(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},hs=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var xe=class n{constructor(e){this.fields=e,e.sort(ke.comparator)}static empty(){return new n([])}unionWith(e){let t=new me(ke.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return xn(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var ds=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var we=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new ds("Invalid base64 string: "+o):o}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let o="";for(let a=0;a<i.length;++a)o+=String.fromCharCode(i[a]);return o})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};we.EMPTY_BYTE_STRING=new we("");var dE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ft(n){if(Q(!!n,39018),typeof n=="string"){let e=0,t=dE.exec(n);if(Q(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function pt(n){return typeof n=="string"?we.fromBase64String(n):we.fromUint8Array(n)}var gp="server_timestamp",_p="__type__",yp="__previous_value__",vp="__local_write_time__";function qu(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[_p])===null||t===void 0?void 0:t.stringValue)===gp}function zs(n){let e=n.mapValue.fields[yp];return qu(e)?zs(e):e}function jr(n){let e=ft(n.mapValue.fields[vp].timestampValue);return new le(e.seconds,e.nanos)}var lc=class{constructor(e,t,r,i,o,a,u,l,d,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=p}},fs="(default)",ps=class n{constructor(e,t){this.projectId=e,this.database=t||fs}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===fs}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var $u="__type__",Ip="__max__",ns={mapValue:{fields:{__type__:{stringValue:Ip}}}},ju="__vector__",Ln="value";function Ft(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qu(n)?4:wp(n)?9007199254740991:Ep(n)?10:11:M(28295,{value:n})}function Xe(n,e){if(n===e)return!0;let t=Ft(n);if(t!==Ft(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return jr(n).isEqual(jr(e));case 3:return(function(i,o){if(typeof i.timestampValue=="string"&&typeof o.timestampValue=="string"&&i.timestampValue.length===o.timestampValue.length)return i.timestampValue===o.timestampValue;let a=ft(i.timestampValue),u=ft(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,o){return pt(i.bytesValue).isEqual(pt(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,o){return ee(i.geoPointValue.latitude)===ee(o.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(o.geoPointValue.longitude)})(n,e);case 2:return(function(i,o){if("integerValue"in i&&"integerValue"in o)return ee(i.integerValue)===ee(o.integerValue);if("doubleValue"in i&&"doubleValue"in o){let a=ee(i.doubleValue),u=ee(o.doubleValue);return a===u?$r(a)===$r(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return xn(n.arrayValue.values||[],e.arrayValue.values||[],Xe);case 10:case 11:return(function(i,o){let a=i.mapValue.fields||{},u=o.mapValue.fields||{};if(ff(a)!==ff(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!Xe(a[l],u[l])))return!1;return!0})(n,e);default:return M(52216,{left:n})}}function zr(n,e){return(n.values||[]).find(t=>Xe(t,e))!==void 0}function Mn(n,e){if(n===e)return 0;let t=Ft(n),r=Ft(e);if(t!==r)return z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return(function(o,a){let u=ee(o.integerValue||o.doubleValue),l=ee(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1})(n,e);case 3:return pf(n.timestampValue,e.timestampValue);case 4:return pf(jr(n),jr(e));case 5:return ac(n.stringValue,e.stringValue);case 6:return(function(o,a){let u=pt(o),l=pt(a);return u.compareTo(l)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){let u=o.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let p=z(u[d],l[d]);if(p!==0)return p}return z(u.length,l.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){let u=z(ee(o.latitude),ee(a.latitude));return u!==0?u:z(ee(o.longitude),ee(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return mf(n.arrayValue,e.arrayValue);case 10:return(function(o,a){var u,l,d,p;let g=o.fields||{},v=a.fields||{},R=(u=g[Ln])===null||u===void 0?void 0:u.arrayValue,k=(l=v[Ln])===null||l===void 0?void 0:l.arrayValue,V=z(((d=R?.values)===null||d===void 0?void 0:d.length)||0,((p=k?.values)===null||p===void 0?void 0:p.length)||0);return V!==0?V:mf(R,k)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===ns.mapValue&&a===ns.mapValue)return 0;if(o===ns.mapValue)return 1;if(a===ns.mapValue)return-1;let u=o.fields||{},l=Object.keys(u),d=a.fields||{},p=Object.keys(d);l.sort(),p.sort();for(let g=0;g<l.length&&g<p.length;++g){let v=ac(l[g],p[g]);if(v!==0)return v;let R=Mn(u[l[g]],d[p[g]]);if(R!==0)return R}return z(l.length,p.length)})(n.mapValue,e.mapValue);default:throw M(23264,{le:t})}}function pf(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return z(n,e);let t=ft(n),r=ft(e),i=z(t.seconds,r.seconds);return i!==0?i:z(t.nanos,r.nanos)}function mf(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let o=Mn(t[i],r[i]);if(o)return o}return z(t.length,r.length)}function Fn(n){return hc(n)}function hc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=ft(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return pt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return L.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let o of t.values||[])i?i=!1:r+=",",r+=hc(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",o=!0;for(let a of r)o?o=!1:i+=",",i+=`${a}:${hc(t.fields[a])}`;return i+"}"})(n.mapValue):M(61005,{value:n})}function ss(n){switch(Ft(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=zs(n);return e?16+ss(e):16;case 5:return 2*n.stringValue.length;case 6:return pt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,o)=>i+ss(o),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return qt(r.fields,(o,a)=>{i+=o.length+ss(a)}),i})(n.mapValue);default:throw M(13486,{value:n})}}function gf(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function dc(n){return!!n&&"integerValue"in n}function zu(n){return!!n&&"arrayValue"in n}function _f(n){return!!n&&"nullValue"in n}function yf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function os(n){return!!n&&"mapValue"in n}function Ep(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[$u])===null||t===void 0?void 0:t.stringValue)===ju}function Lr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return qt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Lr(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Lr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function wp(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Ip}var Zb={mapValue:{fields:{[$u]:{stringValue:ju},[Ln]:{arrayValue:{}}}}};var Ce=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!os(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Lr(t)}setAll(e){let t=ke.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=u.popLast()}a?r[u.lastSegment()]=Lr(a):i.push(u.lastSegment())});let o=this.getFieldsMap(t);this.applyChanges(o,r,i)}delete(e){let t=this.field(e.popLast());os(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];os(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){qt(t,(i,o)=>e[i]=o);for(let i of r)delete e[i]}clone(){return new n(Lr(this.value))}};function Tp(n){let e=[];return qt(n.fields,(t,r)=>{let i=new ke([t]);if(os(r)){let o=Tp(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new xe(e)}var qe=class n{constructor(e,t,r,i,o,a,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new n(e,0,q.min(),q.min(),q.min(),Ce.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,q.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,q.min(),q.min(),Ce.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,q.min(),q.min(),Ce.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ce.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ce.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Un=class{constructor(e,t){this.position=e,this.inclusive=t}};function vf(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let o=e[i],a=n.position[i];if(o.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),t.key):r=Mn(a,t.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function If(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xe(n.position[t],e.position[t]))return!1;return!0}var Bn=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function fE(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ms=class{},ce=class n extends ms{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new pc(e,t,r):t==="array-contains"?new _c(e,r):t==="in"?new yc(e,r):t==="not-in"?new vc(e,r):t==="array-contains-any"?new Ic(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new mc(e,r):new gc(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Mn(t,this.value)):t!==null&&Ft(this.value)===Ft(t)&&this.matchesComparison(Mn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},$e=class n extends ms{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return Ap(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function Ap(n){return n.op==="and"}function bp(n){return pE(n)&&Ap(n)}function pE(n){for(let e of n.filters)if(e instanceof $e)return!1;return!0}function fc(n){if(n instanceof ce)return n.field.canonicalString()+n.op.toString()+Fn(n.value);if(bp(n))return n.filters.map(e=>fc(e)).join(",");{let e=n.filters.map(t=>fc(t)).join(",");return`${n.op}(${e})`}}function Sp(n,e){return n instanceof ce?(function(r,i){return i instanceof ce&&r.op===i.op&&r.field.isEqual(i.field)&&Xe(r.value,i.value)})(n,e):n instanceof $e?(function(r,i){return i instanceof $e&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((o,a,u)=>o&&Sp(a,i.filters[u]),!0):!1})(n,e):void M(19439)}function Rp(n){return n instanceof ce?(function(t){return`${t.field.canonicalString()} ${t.op} ${Fn(t.value)}`})(n):n instanceof $e?(function(t){return t.op.toString()+" {"+t.getFilters().map(Rp).join(" ,")+"}"})(n):"Filter"}var pc=class extends ce{constructor(e,t,r){super(e,t,r),this.key=L.fromName(r.referenceValue)}matches(e){let t=L.comparator(e.key,this.key);return this.matchesComparison(t)}},mc=class extends ce{constructor(e,t){super(e,"in",t),this.keys=Pp("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},gc=class extends ce{constructor(e,t){super(e,"not-in",t),this.keys=Pp("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Pp(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>L.fromName(r.referenceValue))}var _c=class extends ce{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return zu(t)&&zr(t.arrayValue,this.value)}},yc=class extends ce{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&zr(this.value.arrayValue,t)}},vc=class extends ce{constructor(e,t){super(e,"not-in",t)}matches(e){if(zr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!zr(this.value.arrayValue,t)}},Ic=class extends ce{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!zu(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>zr(this.value.arrayValue,r))}};var Ec=class{constructor(e,t=null,r=[],i=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=o,this.startAt=a,this.endAt=u,this.Pe=null}};function Ef(n,e=null,t=[],r=[],i=null,o=null,a=null){return new Ec(n,e,t,r,i,o,a)}function Wu(n){let e=B(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>fc(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(o){return o.field.canonicalString()+o.dir})(r)).join(","),js(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Fn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Fn(r)).join(",")),e.Pe=t}return e.Pe}function Gu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!fE(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Sp(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!If(n.startAt,e.startAt)&&If(n.endAt,e.endAt)}function wc(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}var un=class{constructor(e,t=null,r=[],i=[],o=null,a="F",u=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=l,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function mE(n,e,t,r,i,o,a,u){return new un(n,e,t,r,i,o,a,u)}function Ws(n){return new un(n)}function wf(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Cp(n){return n.collectionGroup!==null}function Mr(n){let e=B(n);if(e.Te===null){e.Te=[];let t=new Set;for(let o of e.explicitOrderBy)e.Te.push(o),t.add(o.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new me(ke.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Te.push(new Bn(o,r))}),t.has(ke.keyField().canonicalString())||e.Te.push(new Bn(ke.keyField(),r))}return e.Te}function Je(n){let e=B(n);return e.Ie||(e.Ie=gE(e,Mr(n))),e.Ie}function gE(n,e){if(n.limitType==="F")return Ef(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let o=i.dir==="desc"?"asc":"desc";return new Bn(i.field,o)});let t=n.endAt?new Un(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Un(n.startAt.position,n.startAt.inclusive):null;return Ef(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Tc(n,e){let t=n.filters.concat([e]);return new un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ac(n,e,t){return new un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Gs(n,e){return Gu(Je(n),Je(e))&&n.limitType===e.limitType}function kp(n){return`${Wu(Je(n))}|lt:${n.limitType}`}function Cn(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>Rp(i)).join(", ")}]`),js(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Fn(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Fn(i)).join(",")),`Target(${r})`})(Je(n))}; limitType=${n.limitType})`}function Ks(n,e){return e.isFoundDocument()&&(function(r,i){let o=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):L.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,e)&&(function(r,i){for(let o of Mr(r))if(!o.field.isKeyField()&&i.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let o of r.filters)if(!o.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(a,u,l){let d=vf(a,u,l);return a.inclusive?d<=0:d<0})(r.startAt,Mr(r),i)||r.endAt&&!(function(a,u,l){let d=vf(a,u,l);return a.inclusive?d>=0:d>0})(r.endAt,Mr(r),i))})(n,e)}function _E(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Dp(n){return(e,t)=>{let r=!1;for(let i of Mr(n)){let o=yE(i,e,t);if(o!==0)return o;r=r||i.field.isKeyField()}return 0}}function yE(n,e,t){let r=n.field.isKeyField()?L.comparator(e.key,t.key):(function(o,a,u){let l=a.data.field(o),d=u.data.field(o);return l!==null&&d!==null?Mn(l,d):M(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return M(19790,{direction:n.dir})}}var mt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,o]of r)if(this.equalsFn(i,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let o=0;o<i.length;o++)if(this.equalsFn(i[o][0],e))return void(i[o]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){qt(this.inner,(t,r)=>{for(let[i,o]of r)e(i,o)})}isEmpty(){return mp(this.inner)}size(){return this.innerSize}};var vE=new ie(L.comparator);function gt(){return vE}var Np=new ie(L.comparator);function xr(...n){let e=Np;for(let t of n)e=e.insert(t.key,t);return e}function Op(n){let e=Np;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function tn(){return Fr()}function Vp(){return Fr()}function Fr(){return new mt(n=>n.toString(),(n,e)=>n.isEqual(e))}var IE=new ie(L.comparator),EE=new me(L.comparator);function G(...n){let e=EE;for(let t of n)e=e.add(t);return e}var wE=new me(z);function TE(){return wE}function Ku(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$r(e)?"-0":e}}function xp(n){return{integerValue:""+n}}function AE(n,e){return ZI(e)?xp(e):Ku(n,e)}var qn=class{constructor(){this._=void 0}};function bE(n,e,t){return n instanceof $n?(function(i,o){let a={fields:{[_p]:{stringValue:gp},[vp]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return o&&qu(o)&&(o=zs(o)),o&&(a.fields[yp]=o),{mapValue:a}})(t,e):n instanceof ln?Mp(n,e):n instanceof hn?Fp(n,e):(function(i,o){let a=Lp(i,o),u=Tf(a)+Tf(i.Ee);return dc(a)&&dc(i.Ee)?xp(u):Ku(i.serializer,u)})(n,e)}function SE(n,e,t){return n instanceof ln?Mp(n,e):n instanceof hn?Fp(n,e):t}function Lp(n,e){return n instanceof jn?(function(r){return dc(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(e)?e:{integerValue:0}:null}var $n=class extends qn{},ln=class extends qn{constructor(e){super(),this.elements=e}};function Mp(n,e){let t=Up(e);for(let r of n.elements)t.some(i=>Xe(i,r))||t.push(r);return{arrayValue:{values:t}}}var hn=class extends qn{constructor(e){super(),this.elements=e}};function Fp(n,e){let t=Up(e);for(let r of n.elements)t=t.filter(i=>!Xe(i,r));return{arrayValue:{values:t}}}var jn=class extends qn{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function Tf(n){return ee(n.integerValue||n.doubleValue)}function Up(n){return zu(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function RE(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof ln&&i instanceof ln||r instanceof hn&&i instanceof hn?xn(r.elements,i.elements,Xe):r instanceof jn&&i instanceof jn?Xe(r.Ee,i.Ee):r instanceof $n&&i instanceof $n})(n.transform,e.transform)}var bc=class{constructor(e,t){this.version=e,this.transformResults=t}},ht=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function as(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var zn=class{};function Bp(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new gs(n.key,ht.none()):new dn(n.key,n.data,ht.none());{let t=n.data,r=Ce.empty(),i=new me(ke.comparator);for(let o of e.fields)if(!i.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?r.delete(o):r.set(o,a),i=i.add(o)}return new Ze(n.key,r,new xe(i.toArray()),ht.none())}}function PE(n,e,t){n instanceof dn?(function(i,o,a){let u=i.value.clone(),l=bf(i.fieldTransforms,o,a.transformResults);u.setAll(l),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Ze?(function(i,o,a){if(!as(i.precondition,o))return void o.convertToUnknownDocument(a.version);let u=bf(i.fieldTransforms,o,a.transformResults),l=o.data;l.setAll(qp(i)),l.setAll(u),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):(function(i,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Ur(n,e,t,r){return n instanceof dn?(function(o,a,u,l){if(!as(o.precondition,a))return u;let d=o.value.clone(),p=Sf(o.fieldTransforms,l,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof Ze?(function(o,a,u,l){if(!as(o.precondition,a))return u;let d=Sf(o.fieldTransforms,l,a),p=a.data;return p.setAll(qp(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(g=>g.field))})(n,e,t,r):(function(o,a,u){return as(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function CE(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),o=Lp(r.transform,i||null);o!=null&&(t===null&&(t=Ce.empty()),t.set(r.field,o))}return t||null}function Af(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&xn(r,i,(o,a)=>RE(o,a))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var dn=class extends zn{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Ze=class extends zn{constructor(e,t,r,i,o=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}};function qp(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function bf(n,e,t){let r=new Map;Q(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let o=n[i],a=o.transform,u=e.data.field(o.field);r.set(o.field,SE(a,u,t[i]))}return r}function Sf(n,e,t){let r=new Map;for(let i of n){let o=i.transform,a=t.data.field(i.field);r.set(i.field,bE(o,a,e))}return r}var gs=class extends zn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Sc=class extends zn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Rc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let o=this.mutations[i];o.key.isEqual(e.key)&&PE(o,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ur(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=Ur(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Vp();return this.mutations.forEach(i=>{let o=e.get(i.key),a=o.overlayedDocument,u=this.applyToLocalView(a,o.mutatedFields);u=t.has(i.key)?null:u;let l=Bp(a,u);l!==null&&r.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(q.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),G())}isEqual(e){return this.batchId===e.batchId&&xn(this.mutations,e.mutations,(t,r)=>Af(t,r))&&xn(this.baseMutations,e.baseMutations,(t,r)=>Af(t,r))}},Pc=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Q(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=(function(){return IE})(),o=e.mutations;for(let a=0;a<o.length;a++)i=i.insert(o[a].key,r[a].version);return new n(e,t,r,i)}};var Cc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var kc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var oe,K;function kE(n){switch(n){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:n})}}function $p(n){if(n===void 0)return dt("GRPC error has no .code"),P.UNKNOWN;switch(n){case oe.OK:return P.OK;case oe.CANCELLED:return P.CANCELLED;case oe.UNKNOWN:return P.UNKNOWN;case oe.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case oe.INTERNAL:return P.INTERNAL;case oe.UNAVAILABLE:return P.UNAVAILABLE;case oe.UNAUTHENTICATED:return P.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case oe.NOT_FOUND:return P.NOT_FOUND;case oe.ALREADY_EXISTS:return P.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return P.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case oe.ABORTED:return P.ABORTED;case oe.OUT_OF_RANGE:return P.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return P.UNIMPLEMENTED;case oe.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:n})}}(K=oe||(oe={}))[K.OK=0]="OK",K[K.CANCELLED=1]="CANCELLED",K[K.UNKNOWN=2]="UNKNOWN",K[K.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",K[K.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",K[K.NOT_FOUND=5]="NOT_FOUND",K[K.ALREADY_EXISTS=6]="ALREADY_EXISTS",K[K.PERMISSION_DENIED=7]="PERMISSION_DENIED",K[K.UNAUTHENTICATED=16]="UNAUTHENTICATED",K[K.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",K[K.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",K[K.ABORTED=10]="ABORTED",K[K.OUT_OF_RANGE=11]="OUT_OF_RANGE",K[K.UNIMPLEMENTED=12]="UNIMPLEMENTED",K[K.INTERNAL=13]="INTERNAL",K[K.UNAVAILABLE=14]="UNAVAILABLE",K[K.DATA_LOSS=15]="DATA_LOSS";var Rf=null;var DE=new ut([4294967295,4294967295],0);function Pf(n){let e=Xf().encode(n),t=new Wa;return t.update(e),new Uint8Array(t.digest())}function Cf(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new ut([t,r],0),new ut([i,o],0)]}var Dc=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new nn(`Invalid padding: ${t}`);if(r<0)throw new nn(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new nn(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new nn(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=ut.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(ut.fromNumber(r)));return i.compare(DE)===1&&(i=new ut([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=Pf(e),[r,i]=Cf(t);for(let o=0;o<this.hashCount;o++){let a=this.pe(r,i,o);if(!this.ye(a))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new n(o,i,t);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.fe===0)return;let t=Pf(e),[r,i]=Cf(t);for(let o=0;o<this.hashCount;o++){let a=this.pe(r,i,o);this.we(a)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},nn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var _s=class n{constructor(e,t,r,i,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Wr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(q.min(),i,new ie(z),gt(),G())}},Wr=class n{constructor(e,t,r,i,o){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,G(),G(),G())}};var On=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},ys=class{constructor(e,t){this.targetId=e,this.De=t}},vs=class{constructor(e,t,r=we.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Is=class{constructor(){this.ve=0,this.Ce=kf(),this.Fe=we.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=G(),t=G(),r=G();return this.Ce.forEach((i,o)=>{switch(o){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:M(38017,{changeType:o})}}),new Wr(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=kf()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Nc=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=gt(),this.je=rs(),this.Je=rs(),this.He=new ie(z)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:M(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let o=i.target;if(wc(o))if(r===0){let a=new L(o.path);this.Xe(t,a,qe.newNoDocument(a,q.min()))}else Q(r===1,20013,{expectedCount:r});else{let a=this.ot(t);if(a!==r){let u=this._t(e),l=u?this.ut(u,e,a):1;if(l!==0){this.rt(t);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,d)}Rf?.ct((function(p,g,v,R,k){var V,D,$,U,j,Y;let Te={localCacheCount:p,existenceFilterCount:g.count,databaseId:v.database,projectId:v.projectId},J=g.unchangedNames;return J&&(Te.bloomFilter={applied:k===0,hashCount:(V=J?.hashCount)!==null&&V!==void 0?V:0,bitmapLength:(U=($=(D=J?.bits)===null||D===void 0?void 0:D.bitmap)===null||$===void 0?void 0:$.length)!==null&&U!==void 0?U:0,padding:(Y=(j=J?.bits)===null||j===void 0?void 0:j.padding)!==null&&Y!==void 0?Y:0,mightContain:w=>{var m;return(m=R?.mightContain(w))!==null&&m!==void 0&&m}}),Te})(a,e.De,this.We.lt(),u,l))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:o=0}=t,a,u;try{a=pt(r).toUint8Array()}catch(l){if(l instanceof ds)return Mt("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Dc(a,i,o)}catch(l){return Mt(l instanceof nn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.fe===0?null:u}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(o=>{let a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.Xe(t,o,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((o,a)=>{let u=this.st(a);if(u){if(o.current&&wc(u.target)){let l=new L(u.target.path);this.Tt(l).has(a)||this.It(a,l)||this.Xe(a,l,qe.newNoDocument(l,e))}o.Ne&&(t.set(a,o.Le()),o.ke())}});let r=G();this.Je.forEach((o,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.st(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(o))}),this.ze.forEach((o,a)=>a.setReadTime(e));let i=new _s(e,t,this.He,this.ze,r);return this.ze=gt(),this.je=rs(),this.Je=rs(),this.He=new ie(z),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Is,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new me(z),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new me(z),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||x("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Is),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function rs(){return new ie(L.comparator)}function kf(){return new ie(L.comparator)}var NE={asc:"ASCENDING",desc:"DESCENDING"},OE={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},VE={and:"AND",or:"OR"},Oc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Vc(n,e){return n.useProto3Json||js(e)?e:{value:e}}function Es(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jp(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function xE(n,e){return Es(n,e.toTimestamp())}function Ye(n){return Q(!!n,49232),q.fromTimestamp((function(t){let r=ft(t);return new le(r.seconds,r.nanos)})(n))}function Hu(n,e){return xc(n,e).canonicalString()}function xc(n,e){let t=(function(i){return new te(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function zp(n){let e=te.fromString(n);return Q(Qp(e),10190,{key:e.toString()}),e}function Lc(n,e){return Hu(n.databaseId,e.path)}function Ya(n,e){let t=zp(e);if(t.get(1)!==n.databaseId.projectId)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new L(Gp(t))}function Wp(n,e){return Hu(n.databaseId,e)}function LE(n){let e=zp(n);return e.length===4?te.emptyPath():Gp(e)}function Mc(n){return new te(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Gp(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Df(n,e,t){return{name:Lc(n,e),fields:t.value.mapValue.fields}}function ME(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),we.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),we.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(d){let p=d.code===void 0?P.UNKNOWN:$p(d.code);return new O(p,d.message||"")})(a);t=new vs(r,i,o,u||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ya(n,r.document.name),o=Ye(r.document.updateTime),a=r.document.createTime?Ye(r.document.createTime):q.min(),u=new Ce({mapValue:{fields:r.document.fields}}),l=qe.newFoundDocument(i,o,a,u),d=r.targetIds||[],p=r.removedTargetIds||[];t=new On(d,p,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ya(n,r.document),o=r.readTime?Ye(r.readTime):q.min(),a=qe.newNoDocument(i,o),u=r.removedTargetIds||[];t=new On([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ya(n,r.document),o=r.removedTargetIds||[];t=new On([],o,i,null)}else{if(!("filter"in e))return M(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:o}=r,a=new kc(i,o),u=r.targetId;t=new ys(u,a)}}return t}function FE(n,e){let t;if(e instanceof dn)t={update:Df(n,e.key,e.value)};else if(e instanceof gs)t={delete:Lc(n,e.key)};else if(e instanceof Ze)t={update:Df(n,e.key,e.data),updateMask:KE(e.fieldMask)};else{if(!(e instanceof Sc))return M(16599,{Rt:e.type});t={verify:Lc(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(o,a){let u=a.transform;if(u instanceof $n)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ln)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof hn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof jn)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw M(20930,{transform:a.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,o){return o.updateTime!==void 0?{updateTime:xE(i,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:M(27497)})(n,e.precondition)),t}function UE(n,e){return n&&n.length>0?(Q(e!==void 0,14353),n.map(t=>(function(i,o){let a=i.updateTime?Ye(i.updateTime):Ye(o);return a.isEqual(q.min())&&(a=Ye(o)),new bc(a,i.transformResults||[])})(t,e))):[]}function BE(n,e){return{documents:[Wp(n,e.path)]}}function qE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=Wp(n,i);let o=(function(d){if(d.length!==0)return Hp($e.create(d,"and"))})(e.filters);o&&(t.structuredQuery.where=o);let a=(function(d){if(d.length!==0)return d.map(p=>(function(v){return{field:kn(v.field),direction:zE(v.dir)}})(p))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=Vc(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{Vt:t,parent:i}}function $E(n){let e=LE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){Q(r===1,65062);let p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(g){let v=Kp(g);return v instanceof $e&&bp(v)?v.getFilters():[v]})(t.where));let a=[];t.orderBy&&(a=(function(g){return g.map(v=>(function(k){return new Bn(Dn(k.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(k.direction))})(v))})(t.orderBy));let u=null;t.limit&&(u=(function(g){let v;return v=typeof g=="object"?g.value:g,js(v)?null:v})(t.limit));let l=null;t.startAt&&(l=(function(g){let v=!!g.before,R=g.values||[];return new Un(R,v)})(t.startAt));let d=null;return t.endAt&&(d=(function(g){let v=!g.before,R=g.values||[];return new Un(R,v)})(t.endAt)),mE(e,i,a,o,u,"F",l,d)}function jE(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Kp(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=Dn(t.unaryFilter.field);return ce.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=Dn(t.unaryFilter.field);return ce.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let o=Dn(t.unaryFilter.field);return ce.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Dn(t.unaryFilter.field);return ce.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ce.create(Dn(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return $e.create(t.compositeFilter.filters.map(r=>Kp(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(t.compositeFilter.op))})(n):M(30097,{filter:n})}function zE(n){return NE[n]}function WE(n){return OE[n]}function GE(n){return VE[n]}function kn(n){return{fieldPath:n.canonicalString()}}function Dn(n){return ke.fromServerFormat(n.fieldPath)}function Hp(n){return n instanceof ce?(function(t){if(t.op==="=="){if(yf(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NAN"}};if(_f(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(yf(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NOT_NAN"}};if(_f(t.value))return{unaryFilter:{field:kn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:kn(t.field),op:WE(t.op),value:t.value}}})(n):n instanceof $e?(function(t){let r=t.getFilters().map(i=>Hp(i));return r.length===1?r[0]:{compositeFilter:{op:GE(t.op),filters:r}}})(n):M(54877,{filter:n})}function KE(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Qp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Gr=class n{constructor(e,t,r,i,o=q.min(),a=q.min(),u=we.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Fc=class{constructor(e){this.gt=e}};function HE(n){let e=$E({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ac(e,e.limit,"L"):e}var ws=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(ee(e.integerValue));else if("doubleValue"in e){let r=ee(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),$r(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=ft(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(pt(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?wp(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Ep(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):M(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let o=e.fields||{};this.Ct(t,53);let a=Ln,u=((i=(r=o[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(ee(u)),this.xt(a,t),this.Dt(o[a],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),L.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};ws.Ut=new ws;var Uc=class{constructor(){this.Dn=new Bc}addToCollectionParentIndex(e,t){return this.Dn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(cn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(cn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Bc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new me(te.comparator),o=!i.has(r);return this.index[t]=i.add(r),o}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new me(te.comparator)).toArray()}};var e0=new Uint8Array(0);var Nf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Jp=41943040,Ve=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(Jp,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);var Kr=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var Of="LruGarbageCollector",QE=1048576;function Vf([n,e],[t,r]){let i=z(n,t);return i===0?z(e,r):i}var qc=class{constructor(e){this.Tr=e,this.buffer=new me(Vf),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Vf(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},$c=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){x(Of,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>I(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Jn(t)?x(Of,"Ignoring IndexedDB error during garbage collection: ",t):yield Qn(t)}yield this.Rr(3e5)}))}},jc=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(Uu.ue);let r=new qc(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(x("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Nf)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(x("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Nf):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,o,a,u,l,d,p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(x("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(r=g,u=Date.now(),this.removeTargets(e,r,t))).next(g=>(o=g,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(g=>(d=Date.now(),Pn()<=W.DEBUG&&x("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${o} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-p}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:g})))}};function JE(n,e){return new jc(n,e)}var zc=class{constructor(){this.changes=new mt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,qe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Wc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Gc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ur(r.mutation,i,xe.empty(),le.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,G()).next(()=>r))}getLocalViewOfDocuments(e,t,r=G()){let i=tn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(o=>{let a=xr();return o.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let r=tn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,G()))}populateOverlays(e,t,r){let i=[];return r.forEach(o=>{t.has(o)||i.push(o)}),this.documentOverlayCache.getOverlays(e,i).next(o=>{o.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,r,i){let o=gt(),a=Fr(),u=(function(){return Fr()})();return t.forEach((l,d)=>{let p=r.get(d.key);i.has(d.key)&&(p===void 0||p.mutation instanceof Ze)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Ur(p.mutation,d,p.mutation.getFieldMask(),le.now())):a.set(d.key,xe.empty())}),this.recalculateAndSaveOverlays(e,o).next(l=>(l.forEach((d,p)=>a.set(d,p)),t.forEach((d,p)=>{var g;return u.set(d,new Wc(p,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(e,t){let r=Fr(),i=new ie((a,u)=>a-u),o=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=t.get(l);if(d===null)return;let p=r.get(l)||xe.empty();p=u.applyToLocalView(d,p),r.set(l,p);let g=(i.get(u.batchId)||G()).add(l);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,p=l.value,g=Vp();p.forEach(v=>{if(!o.has(v)){let R=Bp(t.get(v),r.get(v));R!==null&&g.set(v,R),o=o.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,g))}return C.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Cp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(o=>{let a=i-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-o.size):C.resolve(tn()),u=qr,l=o;return a.next(d=>C.forEach(d,(p,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),o.get(p)?C.resolve():this.remoteDocumentCache.getEntry(e,p).next(v=>{l=l.insert(p,v)}))).next(()=>this.populateOverlays(e,d,o)).next(()=>this.computeViews(e,l,d,G())).next(p=>({batchId:u,changes:Op(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new L(t)).next(r=>{let i=xr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let o=t.collectionGroup,a=xr();return this.indexManager.getCollectionParents(e,o).next(u=>C.forEach(u,l=>{let d=(function(g,v){return new un(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(t,l.child(o));return this.getDocumentsMatchingCollectionQuery(e,d,r,i).next(p=>{p.forEach((g,v)=>{a=a.insert(g,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,o,i))).next(a=>{o.forEach((l,d)=>{let p=d.getKey();a.get(p)===null&&(a=a.insert(p,qe.newInvalidDocument(p)))});let u=xr();return a.forEach((l,d)=>{let p=o.get(l);p!==void 0&&Ur(p.mutation,d,xe.empty(),le.now()),Ks(t,d)&&(u=u.insert(l,d))}),u})}};var Kc=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return C.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Ye(i.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(i){return{name:i.name,query:HE(i.bundledQuery),readTime:Ye(i.readTime)}})(t)),C.resolve()}};var Hc=class{constructor(){this.overlays=new ie(L.comparator),this.kr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=tn();return C.forEach(t,i=>this.getOverlay(e,i).next(o=>{o!==null&&r.set(i,o)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,o)=>{this.wt(e,t,o)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(o=>this.overlays=this.overlays.remove(o)),this.kr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=tn(),o=t.length+1,a=new L(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===o&&l.largestBatchId>r&&i.set(l.getKey(),l)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let o=new ie((d,p)=>d-p),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=tn(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}let u=tn(),l=o.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,p)=>u.set(d,p)),!(u.size()>=i)););return C.resolve(u)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Cc(t,r));let o=this.kr.get(t);o===void 0&&(o=G(),this.kr.set(t,o)),this.kr.set(t,o.add(r.key))}};var Qc=class{constructor(){this.sessionToken=we.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Hr=class{constructor(){this.qr=new me(ae.Qr),this.$r=new me(ae.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new ae(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new ae(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new L(new te([])),r=new ae(t,e),i=new ae(t,e+1),o=[];return this.$r.forEachInRange([r,i],a=>{this.Wr(a),o.push(a.key)}),o}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new L(new te([])),r=new ae(t,e),i=new ae(t,e+1),o=G();return this.$r.forEachInRange([r,i],a=>{o=o.add(a.key)}),o}containsKey(e){let t=new ae(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},ae=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return L.comparator(e.key,t.key)||z(e.Hr,t.Hr)}static Ur(e,t){return z(e.Hr,t.Hr)||L.comparator(e.key,t.key)}};var Jc=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new me(ae.Qr)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let o=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Rc(o,t,r,i);this.mutationQueue.push(a);for(let u of i)this.Yr=this.Yr.add(new ae(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),o=i<0?0:i;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Bu:this.er-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ae(t,0),i=new ae(t,Number.POSITIVE_INFINITY),o=[];return this.Yr.forEachInRange([r,i],a=>{let u=this.Zr(a.Hr);o.push(u)}),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new me(z);return t.forEach(i=>{let o=new ae(i,0),a=new ae(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([o,a],u=>{r=r.add(u.Hr)})}),C.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,o=r;L.isDocumentKey(o)||(o=o.child(""));let a=new ae(new L(o),0),u=new me(z);return this.Yr.forEachWhile(l=>{let d=l.key.path;return!!r.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.Hr)),!0)},a),C.resolve(this.ei(u))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){Q(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return C.forEach(t.mutations,i=>{let o=new ae(i.key,t.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new ae(t,0),i=this.Yr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var Yc=class{constructor(e){this.ni=e,this.docs=(function(){return new ie(L.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),o=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():qe.newInvalidDocument(t))}getEntries(e,t){let r=gt();return t.forEach(i=>{let o=this.docs.get(i);r=r.insert(i,o?o.document.mutableCopy():qe.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let o=gt(),a=t.path,u=new L(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:p}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||JI(QI(p),r)<=0||(i.has(p.key)||Ks(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(e,t,r,i){M(9500)}ri(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Xc(this)}getSize(e){return C.resolve(this.size)}},Xc=class extends zc{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var Zc=class{constructor(e){this.persistence=e,this.ii=new mt(t=>Wu(t),Gu),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.si=0,this.oi=new Hr,this.targetCount=0,this._i=Kr.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),C.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Kr(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.hr(t),C.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,o=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=t&&r.get(u.targetId)===null&&(this.ii.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),C.waitFor(o).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,o=[];return i&&t.forEach(a=>{o.push(i.markPotentiallyOrphaned(e,a))}),C.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.oi.containsKey(t))}};var Ts=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new Uu(0),this.ci=!1,this.ci=!0,this.li=new Qc,this.referenceDelegate=e(this),this.hi=new Zc(this),this.indexManager=new Uc,this.remoteDocumentCache=(function(i){return new Yc(i)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new Fc(t),this.Ti=new Kc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new Jc(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){x("MemoryPersistence","Starting transaction:",e);let i=new eu(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(o=>this.referenceDelegate.di(i).next(()=>o)).toPromise().then(o=>(i.raiseOnCommittedEvent(),o))}Ei(e,t){return C.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},eu=class extends uc{constructor(e){super(),this.currentSequenceNumber=e}},tu=class n{constructor(e){this.persistence=e,this.Ai=new Hr,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw M(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(o=>this.mi.add(o.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.mi,r=>{let i=L.fromPath(r);return this.fi(e,i).next(o=>{o||t.removeEntry(i,q.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return C.or([()=>C.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},As=class n{constructor(e,t){this.persistence=e,this.gi=new mt(r=>eE(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=JE(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return C.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(o=>o?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(u=>{u||(r++,o.removeEntry(a,q.min()))})).next(()=>o.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=ss(e.data.value)),t}Sr(e,t,r){return C.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var nu=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=G(),i=G();for(let o of t.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:i=i.add(o.doc.key)}return new n(e,t.fromCache,r,i)}};var ru=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var iu=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return Vh()?8:XI(de())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let o={result:null};return this.ps(e,t).next(a=>{o.result=a}).next(()=>{if(!o.result)return this.ys(e,t,i,r).next(a=>{o.result=a})}).next(()=>{if(o.result)return;let a=new ru;return this.ws(e,t,a).next(u=>{if(o.result=u,this.Rs)return this.Ss(e,t,a,u.size)})}).next(()=>o.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Pn()<=W.DEBUG&&x("QueryEngine","SDK will not create cache indexes for query:",Cn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),C.resolve()):(Pn()<=W.DEBUG&&x("QueryEngine","Query:",Cn(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Pn()<=W.DEBUG&&x("QueryEngine","The SDK decides to create cache indexes for query:",Cn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Je(t))):C.resolve())}ps(e,t){if(wf(t))return C.resolve(null);let r=Je(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Ac(t,null,"F"),r=Je(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(o=>{let a=G(...o);return this.gs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(l=>{let d=this.bs(t,u);return this.Ds(t,d,a,l.readTime)?this.ps(e,Ac(t,null,"F")):this.vs(e,d,t,l)}))})))}ys(e,t,r,i){return wf(t)||i.isEqual(q.min())?C.resolve(null):this.gs.getDocuments(e,r).next(o=>{let a=this.bs(t,o);return this.Ds(t,a,r,i)?C.resolve(null):(Pn()<=W.DEBUG&&x("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Cn(t)),this.vs(e,a,t,HI(i,qr)).next(u=>u))})}bs(e,t){let r=new me(Dp(e));return t.forEach((i,o)=>{Ks(e,o)&&(r=r.add(o))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)}ws(e,t,r){return Pn()<=W.DEBUG&&x("QueryEngine","Using full collection scan to execute query:",Cn(t)),this.gs.getDocumentsMatchingQuery(e,t,cn.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(o=>(t.forEach(a=>{o=o.insert(a.key,a)}),o))}};var Qu="LocalStore",YE=3e8,su=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new ie(z),this.Ms=new mt(o=>Wu(o),Gu),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Gc(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function XE(n,e,t,r){return new su(n,e,t,r)}function Yp(n,e){return I(this,null,function*(){let t=B(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(o=>(i=o,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(o=>{let a=[],u=[],l=G();for(let d of i){a.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}for(let d of o){u.push(d.batchId);for(let p of d.mutations)l=l.add(p.key)}return t.localDocuments.getDocuments(r,l).next(d=>({Bs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function ZE(n,e){let t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),o=t.Os.newChangeBuffer({trackRemovals:!0});return(function(u,l,d,p){let g=d.batch,v=g.keys(),R=C.resolve();return v.forEach(k=>{R=R.next(()=>p.getEntry(l,k)).next(V=>{let D=d.docVersions.get(k);Q(D!==null,48541),V.version.compareTo(D)<0&&(g.applyToRemoteDocument(V,d),V.isValidDocument()&&(V.setReadTime(d.commitVersion),p.addEntry(V)))})}),R.next(()=>u.mutationQueue.removeMutationBatch(l,g))})(t,r,e,o).next(()=>o.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let l=G();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Xp(n){let e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function ew(n,e){let t=B(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{let a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let u=[];e.targetChanges.forEach((p,g)=>{let v=i.get(g);if(!v)return;u.push(t.hi.removeMatchingKeys(o,p.removedDocuments,g).next(()=>t.hi.addMatchingKeys(o,p.addedDocuments,g)));let R=v.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(g)!==null?R=R.withResumeToken(we.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):p.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(p.resumeToken,r)),i=i.insert(g,R),(function(V,D,$){return V.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=YE?!0:$.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size>0})(v,R,p)&&u.push(t.hi.updateTargetData(o,R))});let l=gt(),d=G();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))}),u.push(tw(o,a,e.documentUpdates).next(p=>{l=p.Ls,d=p.ks})),!r.isEqual(q.min())){let p=t.hi.getLastRemoteSnapshotVersion(o).next(g=>t.hi.setTargetsMetadata(o,o.currentSequenceNumber,r));u.push(p)}return C.waitFor(u).next(()=>a.apply(o)).next(()=>t.localDocuments.getLocalViewOfDocuments(o,l,d)).next(()=>l)}).then(o=>(t.Fs=i,o))}function tw(n,e,t){let r=G(),i=G();return t.forEach(o=>r=r.add(o)),e.getEntries(n,r).next(o=>{let a=gt();return t.forEach((u,l)=>{let d=o.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(q.min())?(e.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(l),a=a.insert(u,l)):x(Qu,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{Ls:a,ks:i}})}function nw(n,e){let t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Bu),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function rw(n,e){let t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(o=>o?(i=o,C.resolve(i)):t.hi.allocateTargetId(r).next(a=>(i=new Gr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}function ou(n,e,t){return I(this,null,function*(){let r=B(n),i=r.Fs.get(e),o=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",o,a=>r.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Jn(a))throw a;x(Qu,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)})}function xf(n,e,t){let r=B(n),i=q.min(),o=G();return r.persistence.runTransaction("Execute query","readwrite",a=>(function(l,d,p){let g=B(l),v=g.Ms.get(p);return v!==void 0?C.resolve(g.Fs.get(v)):g.hi.getTargetData(d,p)})(r,a,Je(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(a,u.targetId).next(l=>{o=l})}).next(()=>r.Cs.getDocumentsMatchingQuery(a,e,t?i:q.min(),t?o:G())).next(u=>(iw(r,_E(e),u),{documents:u,qs:o})))}function iw(n,e,t){let r=n.xs.get(e)||q.min();t.forEach((i,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)}),n.xs.set(e,r)}var bs=class{constructor(){this.activeTargetIds=TE()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}};var au=class{constructor(){this.Fo=new bs,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new bs,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var cu=class{xo(e){}shutdown(){}};var Lf="ConnectivityMonitor",Ss=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){x(Lf,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){x(Lf,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var is=null;function uu(){return is===null?is=(function(){return 268435456+Math.round(2147483648*Math.random())})():is++,"0x"+is.toString(16)}var Xa="RestConnection",sw={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},lu=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===fs?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,o){let a=uu(),u=this.Go(e,t.toUriEncodedString());x(Xa,`Sending RPC '${e}' ${a}:`,u,r);let l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(l,i,o);let{host:d}=new URL(u),p=Tt(d);return this.jo(e,u,l,r,p).then(g=>(x(Xa,`Received RPC '${e}' ${a}: `,g),g),g=>{throw Mt(Xa,`RPC '${e}' ${a} failed with error: `,g,"url: ",u,"request:",r),g})}Jo(e,t,r,i,o,a){return this.Wo(e,t,r,i,o)}zo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Hn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,o)=>e[o]=i),r&&r.headers.forEach((i,o)=>e[o]=i)}Go(e,t){let r=sw[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var hu=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var Ee="WebChannelConnection",du=class extends lu{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,o){let a=uu();return new Promise((u,l)=>{let d=new Ga;d.setWithCredentials(!0),d.listenOnce(Ka.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Vr.NO_ERROR:let g=d.getResponseJson();x(Ee,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),u(g);break;case Vr.TIMEOUT:x(Ee,`RPC '${e}' ${a} timed out`),l(new O(P.DEADLINE_EXCEEDED,"Request time out"));break;case Vr.HTTP_ERROR:let v=d.getStatus();if(x(Ee,`RPC '${e}' ${a} failed with status:`,v,"response text:",d.getResponseText()),v>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);let k=R?.error;if(k&&k.status&&k.message){let V=(function($){let U=$.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN})(k.status);l(new O(V,k.message))}else l(new O(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new O(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{c_:e,streamId:a,l_:d.getLastErrorCode(),h_:d.getLastError()})}}finally{x(Ee,`RPC '${e}' ${a} completed.`)}});let p=JSON.stringify(i);x(Ee,`RPC '${e}' ${a} sending request:`,i),d.send(t,"POST",p,r,15)})}P_(e,t,r){let i=uu(),o=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ja(),u=Qa(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.zo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;let p=o.join("");x(Ee,`Creating RPC '${e}' stream ${i}: ${p}`,l);let g=a.createWebChannel(p,l);this.T_(g);let v=!1,R=!1,k=new hu({Ho:D=>{R?x(Ee,`Not sending because RPC '${e}' stream ${i} is closed:`,D):(v||(x(Ee,`Opening RPC '${e}' stream ${i} transport.`),g.open(),v=!0),x(Ee,`RPC '${e}' stream ${i} sending:`,D),g.send(D))},Yo:()=>g.close()}),V=(D,$,U)=>{D.listen($,j=>{try{U(j)}catch(Y){setTimeout(()=>{throw Y},0)}})};return V(g,Rn.EventType.OPEN,()=>{R||(x(Ee,`RPC '${e}' stream ${i} transport opened.`),k.s_())}),V(g,Rn.EventType.CLOSE,()=>{R||(R=!0,x(Ee,`RPC '${e}' stream ${i} transport closed`),k.__(),this.I_(g))}),V(g,Rn.EventType.ERROR,D=>{R||(R=!0,Mt(Ee,`RPC '${e}' stream ${i} transport errored. Name:`,D.name,"Message:",D.message),k.__(new O(P.UNAVAILABLE,"The operation could not be completed")))}),V(g,Rn.EventType.MESSAGE,D=>{var $;if(!R){let U=D.data[0];Q(!!U,16349);let j=U,Y=j?.error||(($=j[0])===null||$===void 0?void 0:$.error);if(Y){x(Ee,`RPC '${e}' stream ${i} received error:`,Y);let Te=Y.status,J=(function(y){let E=oe[y];if(E!==void 0)return $p(E)})(Te),w=Y.message;J===void 0&&(J=P.INTERNAL,w="Unknown error status: "+Te+" with message "+Y.message),R=!0,k.__(new O(J,w)),g.close()}else x(Ee,`RPC '${e}' stream ${i} received:`,U),k.a_(U)}}),V(u,Ha.STAT_EVENT,D=>{D.stat===ts.PROXY?x(Ee,`RPC '${e}' stream ${i} detected buffering proxy`):D.stat===ts.NOPROXY&&x(Ee,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.o_()},0),k}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function Za(){return typeof document<"u"?document:null}function Hs(n){return new Oc(n,!0)}var Rs=class{constructor(e,t,r=1e3,i=1.5,o=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=o,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&x("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Mf="PersistentStream",Ps=class{constructor(e,t,r,i,o,a,u,l){this.Fi=e,this.w_=r,this.S_=i,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Rs(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return I(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return I(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return I(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===P.RESOURCE_EXHAUSTED?(dt(t.toString()),dt("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new O(P.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>I(this,null,function*(){this.state=0,this.start()}))}G_(e){return x(Mf,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(x(Mf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},fu=class extends Ps{constructor(e,t,r,i,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=ME(this.serializer,e),r=(function(o){if(!("targetChange"in o))return q.min();let a=o.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?Ye(a.readTime):q.min()})(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=Mc(this.serializer),t.addTarget=(function(o,a){let u,l=a.target;if(u=wc(l)?{documents:BE(o,l)}:{query:qE(o,l).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=jp(o,a.resumeToken);let d=Vc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){u.readTime=Es(o,a.snapshotVersion.toTimestamp());let d=Vc(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,e);let r=jE(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=Mc(this.serializer),t.removeTarget=e,this.k_(t)}},pu=class extends Ps{constructor(e,t,r,i,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=o}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return Q(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Q(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){Q(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=UE(e.writeResults,e.commitTime),r=Ye(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=Mc(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>FE(this.serializer,r))};this.k_(t)}};var mu=class{},gu=class extends mu{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Wo(e,xc(t,r),i,o,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(P.UNKNOWN,o.toString())})}Jo(e,t,r,i,o){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(e,xc(t,r),i,a,u,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(P.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},_u=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(dt(t),this._a=!1):x("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var fn="RemoteStore",yu=class{constructor(e,t,r,i,o){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=o,this.Ea.xo(a=>{r.enqueueAndForget(()=>I(this,null,function*(){mn(this)&&(x(fn,"Restarting streams for network reachability change."),yield(function(l){return I(this,null,function*(){let d=B(l);d.Ia.add(4),yield ti(d),d.Aa.set("Unknown"),d.Ia.delete(4),yield Qs(d)})})(this))}))}),this.Aa=new _u(r,i)}};function Qs(n){return I(this,null,function*(){if(mn(n))for(let e of n.da)yield e(!0)})}function ti(n){return I(this,null,function*(){for(let e of n.da)yield e(!1)})}function Zp(n,e){let t=B(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Zu(t)?Xu(t):Yn(t).x_()&&Yu(t,e))}function Ju(n,e){let t=B(n),r=Yn(t);t.Ta.delete(e),r.x_()&&em(t,e),t.Ta.size===0&&(r.x_()?r.B_():mn(t)&&t.Aa.set("Unknown"))}function Yu(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Yn(n).H_(e)}function em(n,e){n.Ra.$e(e),Yn(n).Y_(e)}function Xu(n){n.Ra=new Nc({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),Yn(n).start(),n.Aa.aa()}function Zu(n){return mn(n)&&!Yn(n).M_()&&n.Ta.size>0}function mn(n){return B(n).Ia.size===0}function tm(n){n.Ra=void 0}function ow(n){return I(this,null,function*(){n.Aa.set("Online")})}function aw(n){return I(this,null,function*(){n.Ta.forEach((e,t)=>{Yu(n,e)})})}function cw(n,e){return I(this,null,function*(){tm(n),Zu(n)?(n.Aa.la(e),Xu(n)):n.Aa.set("Unknown")})}function uw(n,e,t){return I(this,null,function*(){if(n.Aa.set("Online"),e instanceof vs&&e.state===2&&e.cause)try{yield(function(i,o){return I(this,null,function*(){let a=o.cause;for(let u of o.targetIds)i.Ta.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ta.delete(u),i.Ra.removeTarget(u))})})(n,e)}catch(r){x(fn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Cs(n,r)}else if(e instanceof On?n.Ra.Ye(e):e instanceof ys?n.Ra.it(e):n.Ra.et(e),!t.isEqual(q.min()))try{let r=yield Xp(n.localStore);t.compareTo(r)>=0&&(yield(function(o,a){let u=o.Ra.Pt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let p=o.Ta.get(d);p&&o.Ta.set(d,p.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let p=o.Ta.get(l);if(!p)return;o.Ta.set(l,p.withResumeToken(we.EMPTY_BYTE_STRING,p.snapshotVersion)),em(o,l);let g=new Gr(p.target,l,d,p.sequenceNumber);Yu(o,g)}),o.remoteSyncer.applyRemoteEvent(u)})(n,t))}catch(r){x(fn,"Failed to raise snapshot:",r),yield Cs(n,r)}})}function Cs(n,e,t){return I(this,null,function*(){if(!Jn(e))throw e;n.Ia.add(1),yield ti(n),n.Aa.set("Offline"),t||(t=()=>Xp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>I(null,null,function*(){x(fn,"Retrying IndexedDB access"),yield t(),n.Ia.delete(1),yield Qs(n)}))})}function nm(n,e){return e().catch(t=>Cs(n,t,e))}function Js(n){return I(this,null,function*(){let e=B(n),t=Ut(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Bu;for(;lw(e);)try{let i=yield nw(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,hw(e,i)}catch(i){yield Cs(e,i)}rm(e)&&im(e)})}function lw(n){return mn(n)&&n.Pa.length<10}function hw(n,e){n.Pa.push(e);let t=Ut(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function rm(n){return mn(n)&&!Ut(n).M_()&&n.Pa.length>0}function im(n){Ut(n).start()}function dw(n){return I(this,null,function*(){Ut(n).na()})}function fw(n){return I(this,null,function*(){let e=Ut(n);for(let t of n.Pa)e.X_(t.mutations)})}function pw(n,e,t){return I(this,null,function*(){let r=n.Pa.shift(),i=Pc.from(r,e,t);yield nm(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Js(n)})}function mw(n,e){return I(this,null,function*(){e&&Ut(n).Z_&&(yield(function(r,i){return I(this,null,function*(){if((function(a){return kE(a)&&a!==P.ABORTED})(i.code)){let o=r.Pa.shift();Ut(r).N_(),yield nm(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,i)),yield Js(r)}})})(n,e)),rm(n)&&im(n)})}function Ff(n,e){return I(this,null,function*(){let t=B(n);t.asyncQueue.verifyOperationInProgress(),x(fn,"RemoteStore received new credentials");let r=mn(t);t.Ia.add(3),yield ti(t),r&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield Qs(t)})}function gw(n,e){return I(this,null,function*(){let t=B(n);e?(t.Ia.delete(2),yield Qs(t)):e||(t.Ia.add(2),yield ti(t),t.Aa.set("Unknown"))})}function Yn(n){return n.Va||(n.Va=(function(t,r,i){let o=B(t);return o.ia(),new fu(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Zo:ow.bind(null,n),e_:aw.bind(null,n),n_:cw.bind(null,n),J_:uw.bind(null,n)}),n.da.push(e=>I(null,null,function*(){e?(n.Va.N_(),Zu(n)?Xu(n):n.Aa.set("Unknown")):(yield n.Va.stop(),tm(n))}))),n.Va}function Ut(n){return n.ma||(n.ma=(function(t,r,i){let o=B(t);return o.ia(),new pu(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:dw.bind(null,n),n_:mw.bind(null,n),ea:fw.bind(null,n),ta:pw.bind(null,n)}),n.da.push(e=>I(null,null,function*(){e?(n.ma.N_(),yield Js(n)):(yield n.ma.stop(),n.Pa.length>0&&(x(fn,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var vu=class n{constructor(e,t,r,i,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Be,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,o){let a=Date.now()+r,u=new n(e,t,a,i,o);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function el(n,e){if(dt("AsyncQueue",`${e}: ${n}`),Jn(n))return new O(P.UNAVAILABLE,`${e}: ${n}`);throw n}var ks=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||L.comparator(t.key,r.key):(t,r)=>L.comparator(t.key,r.key),this.keyedMap=xr(),this.sortedSet=new ie(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Ds=class{constructor(){this.fa=new ie(L.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):M(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},Wn=class n{constructor(e,t,r,i,o,a,u,l,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,i,o){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new n(e,t,ks.emptySet(t),a,r,i,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Gs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Iu=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},Eu=class{constructor(){this.queries=Uf(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=B(t),o=i.queries;i.queries=Uf(),o.forEach((a,u)=>{for(let l of u.wa)l.onError(r)})})(this,new O(P.ABORTED,"Firestore shutting down"))}};function Uf(){return new mt(n=>kp(n),Gs)}function tl(n,e){return I(this,null,function*(){let t=B(n),r=3,i=e.query,o=t.queries.get(i);o?!o.Sa()&&e.ba()&&(r=2):(o=new Iu,r=e.ba()?0:1);try{switch(r){case 0:o.ya=yield t.onListen(i,!0);break;case 1:o.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=el(a,`Initialization of query '${Cn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,o),o.wa.push(e),e.va(t.onlineState),o.ya&&e.Ca(o.ya)&&rl(t)})}function nl(n,e){return I(this,null,function*(){let t=B(n),r=e.query,i=3,o=t.queries.get(r);if(o){let a=o.wa.indexOf(e);a>=0&&(o.wa.splice(a,1),o.wa.length===0?i=e.ba()?0:1:!o.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function _w(n,e){let t=B(n),r=!1;for(let i of e){let o=i.query,a=t.queries.get(o);if(a){for(let u of a.wa)u.Ca(i)&&(r=!0);a.ya=i}}r&&rl(t)}function yw(n,e,t){let r=B(n),i=r.queries.get(e);if(i)for(let o of i.wa)o.onError(t);r.queries.delete(e)}function rl(n){n.Da.forEach(e=>{e.next()})}var wu,Bf;(Bf=wu||(wu={})).Fa="default",Bf.Cache="cache";var Qr=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Wn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=Wn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==wu.Cache}};var Ns=class{constructor(e){this.key=e}},Os=class{constructor(e){this.key=e}},Tu=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=G(),this.mutatedKeys=G(),this.Xa=Dp(e),this.eu=new ks(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new Ds,i=t?t.eu:this.eu,o=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,g)=>{let v=i.get(p),R=Ks(this.query,g)?g:null,k=!!v&&this.mutatedKeys.has(v.key),V=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations),D=!1;v&&R?v.data.isEqual(R.data)?k!==V&&(r.track({type:3,doc:R}),D=!0):this.iu(v,R)||(r.track({type:2,doc:R}),D=!0,(l&&this.Xa(R,l)>0||d&&this.Xa(R,d)<0)&&(u=!0)):!v&&R?(r.track({type:0,doc:R}),D=!0):v&&!R&&(r.track({type:1,doc:v}),D=!0,(l||d)&&(u=!0)),D&&(R?(a=a.add(R),o=V?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{eu:a,ru:r,Ds:u,mutatedKeys:o}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let o=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let a=e.ru.pa();a.sort((p,g)=>(function(R,k){let V=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{At:D})}};return V(R)-V(k)})(p.type,g.type)||this.Xa(p.doc,g.doc)),this.su(r),i=i!=null&&i;let u=t&&!i?this.ou():[],l=this.Za.size===0&&this.current&&!i?1:0,d=l!==this.Ya;return this.Ya=l,a.length!==0||d?{snapshot:new Wn(this.query,e.eu,o,a,e.mutatedKeys,l===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Ds,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=G(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new Os(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new Ns(r))}),t}uu(e){this.Ha=e.qs,this.Za=G();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return Wn.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},il="SyncEngine",Au=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},bu=class{constructor(e){this.key=e,this.lu=!1}},Su=class{constructor(e,t,r,i,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new mt(u=>kp(u),Gs),this.Tu=new Map,this.Iu=new Set,this.du=new ie(L.comparator),this.Eu=new Map,this.Au=new Hr,this.Ru={},this.Vu=new Map,this.mu=Kr.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function vw(n,e,t=!0){return I(this,null,function*(){let r=lm(n),i,o=r.Pu.get(e);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.cu()):i=yield sm(r,e,t,!0),i})}function Iw(n,e){return I(this,null,function*(){let t=lm(n);yield sm(t,e,!0,!1)})}function sm(n,e,t,r){return I(this,null,function*(){let i=yield rw(n.localStore,Je(e)),o=i.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t),u;return r&&(u=yield Ew(n,e,o,a==="current",i.resumeToken)),n.isPrimaryClient&&t&&Zp(n.remoteStore,i),u})}function Ew(n,e,t,r,i){return I(this,null,function*(){n.gu=(g,v,R)=>(function(V,D,$,U){return I(this,null,function*(){let j=D.view.nu($);j.Ds&&(j=yield xf(V.localStore,D.query,!1).then(({documents:w})=>D.view.nu(w,j)));let Y=U&&U.targetChanges.get(D.targetId),Te=U&&U.targetMismatches.get(D.targetId)!=null,J=D.view.applyChanges(j,V.isPrimaryClient,Y,Te);return $f(V,D.targetId,J._u),J.snapshot})})(n,g,v,R);let o=yield xf(n.localStore,e,!0),a=new Tu(e,o.qs),u=a.nu(o.documents),l=Wr.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),d=a.applyChanges(u,n.isPrimaryClient,l);$f(n,t,d._u);let p=new Au(e,t,a);return n.Pu.set(e,p),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),d.snapshot})}function ww(n,e,t){return I(this,null,function*(){let r=B(n),i=r.Pu.get(e),o=r.Tu.get(i.targetId);if(o.length>1)return r.Tu.set(i.targetId,o.filter(a=>!Gs(a,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ou(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ju(r.remoteStore,i.targetId),Ru(r,i.targetId)}).catch(Qn))):(Ru(r,i.targetId),yield ou(r.localStore,i.targetId,!0))})}function Tw(n,e){return I(this,null,function*(){let t=B(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ju(t.remoteStore,r.targetId))})}function Aw(n,e,t){return I(this,null,function*(){let r=Dw(n);try{let i=yield(function(a,u){let l=B(a),d=le.now(),p=u.reduce((R,k)=>R.add(k.key),G()),g,v;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>{let k=gt(),V=G();return l.Os.getEntries(R,p).next(D=>{k=D,k.forEach(($,U)=>{U.isValidDocument()||(V=V.add($))})}).next(()=>l.localDocuments.getOverlayedDocuments(R,k)).next(D=>{g=D;let $=[];for(let U of u){let j=CE(U,g.get(U.key).overlayedDocument);j!=null&&$.push(new Ze(U.key,j,Tp(j.value.mapValue),ht.exists(!0)))}return l.mutationQueue.addMutationBatch(R,d,$,u)}).next(D=>{v=D;let $=D.applyToLocalDocumentSet(g,V);return l.documentOverlayCache.saveOverlays(R,D.batchId,$)})}).then(()=>({batchId:v.batchId,changes:Op(g)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(a,u,l){let d=a.Ru[a.currentUser.toKey()];d||(d=new ie(z)),d=d.insert(u,l),a.Ru[a.currentUser.toKey()]=d})(r,i.batchId,t),yield ni(r,i.changes),yield Js(r.remoteStore)}catch(i){let o=el(i,"Failed to persist write");t.reject(o)}})}function om(n,e){return I(this,null,function*(){let t=B(n);try{let r=yield ew(t.localStore,e);e.targetChanges.forEach((i,o)=>{let a=t.Eu.get(o);a&&(Q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?Q(a.lu,14607):i.removedDocuments.size>0&&(Q(a.lu,42227),a.lu=!1))}),yield ni(t,r,e)}catch(r){yield Qn(r)}})}function qf(n,e,t){let r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((o,a)=>{let u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),(function(a,u){let l=B(a);l.onlineState=u;let d=!1;l.queries.forEach((p,g)=>{for(let v of g.wa)v.va(u)&&(d=!0)}),d&&rl(l)})(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function bw(n,e,t){return I(this,null,function*(){let r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),o=i&&i.key;if(o){let a=new ie(L.comparator);a=a.insert(o,qe.newNoDocument(o,q.min()));let u=G().add(o),l=new _s(q.min(),new Map,new ie(z),a,u);yield om(r,l),r.du=r.du.remove(o),r.Eu.delete(e),sl(r)}else yield ou(r.localStore,e,!1).then(()=>Ru(r,e,t)).catch(Qn)})}function Sw(n,e){return I(this,null,function*(){let t=B(n),r=e.batch.batchId;try{let i=yield ZE(t.localStore,e);cm(t,r,null),am(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield ni(t,i)}catch(i){yield Qn(i)}})}function Rw(n,e,t){return I(this,null,function*(){let r=B(n);try{let i=yield(function(a,u){let l=B(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let p;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(Q(g!==null,37113),p=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,p,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p)).next(()=>l.localDocuments.getDocuments(d,p))})})(r.localStore,e);cm(r,e,t),am(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield ni(r,i)}catch(i){yield Qn(i)}})}function am(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function cm(n,e,t){let r=B(n),i=r.Ru[r.currentUser.toKey()];if(i){let o=i.get(e);o&&(t?o.reject(t):o.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function Ru(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||um(n,r)})}function um(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(Ju(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),sl(n))}function $f(n,e,t){for(let r of t)r instanceof Ns?(n.Au.addReference(r.key,e),Pw(n,r)):r instanceof Os?(x(il,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||um(n,r.key)):M(19791,{yu:r})}function Pw(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(x(il,"New document in limbo: "+t),n.Iu.add(r),sl(n))}function sl(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new L(te.fromString(e)),r=n.mu.next();n.Eu.set(r,new bu(t)),n.du=n.du.insert(t,r),Zp(n.remoteStore,new Gr(Je(Ws(t.path)),r,"TargetPurposeLimboResolution",Uu.ue))}}function ni(n,e,t){return I(this,null,function*(){let r=B(n),i=[],o=[],a=[];r.Pu.isEmpty()||(r.Pu.forEach((u,l)=>{a.push(r.gu(l,e,t).then(d=>{var p;if((d||t)&&r.isPrimaryClient){let g=d?!d.fromCache:(p=t?.targetChanges.get(l.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(l.targetId,g?"current":"not-current")}if(d){i.push(d);let g=nu.Es(l.targetId,d);o.push(g)}}))}),yield Promise.all(a),r.hu.J_(i),yield(function(l,d){return I(this,null,function*(){let p=B(l);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>C.forEach(d,v=>C.forEach(v.Is,R=>p.persistence.referenceDelegate.addReference(g,v.targetId,R)).next(()=>C.forEach(v.ds,R=>p.persistence.referenceDelegate.removeReference(g,v.targetId,R)))))}catch(g){if(!Jn(g))throw g;x(Qu,"Failed to update sequence numbers: "+g)}for(let g of d){let v=g.targetId;if(!g.fromCache){let R=p.Fs.get(v),k=R.snapshotVersion,V=R.withLastLimboFreeSnapshotVersion(k);p.Fs=p.Fs.insert(v,V)}}})})(r.localStore,o))})}function Cw(n,e){return I(this,null,function*(){let t=B(n);if(!t.currentUser.isEqual(e)){x(il,"User change. New user:",e.toKey());let r=yield Yp(t.localStore,e);t.currentUser=e,(function(o,a){o.Vu.forEach(u=>{u.forEach(l=>{l.reject(new O(P.CANCELLED,a))})}),o.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield ni(t,r.Bs)}})}function kw(n,e){let t=B(n),r=t.Eu.get(e);if(r&&r.lu)return G().add(r.key);{let i=G(),o=t.Tu.get(e);if(!o)return i;for(let a of o){let u=t.Pu.get(a);i=i.unionWith(u.view.tu)}return i}}function lm(n){let e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=om.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=kw.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bw.bind(null,e),e.hu.J_=_w.bind(null,e.eventManager),e.hu.pu=yw.bind(null,e.eventManager),e}function Dw(n){let e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Sw.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Rw.bind(null,e),e}var hm=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return I(this,null,function*(){this.serializer=Hs(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,r){return null}Fu(t,r){return null}vu(t){return XE(this.persistence,new iu,t.initialUser,this.serializer)}Du(t){return new Ts(tu.Vi,this.serializer)}bu(t){return new au}terminate(){return I(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Pu=class extends hm{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){Q(this.persistence.referenceDelegate instanceof As,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new $c(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new Ts(r=>As.Vi(r,t),this.serializer)}};var Nw=(()=>{class n{initialize(t,r){return I(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>qf(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Cw.bind(null,this.syncEngine),yield gw(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return(function(){return new Eu})()}createDatastore(t){let r=Hs(t.databaseInfo.databaseId),i=(function(a){return new du(a)})(t.databaseInfo);return(function(a,u,l,d){return new gu(a,u,l,d)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,o,a,u,l){return new yu(i,o,a,u,l)})(this.localStore,this.datastore,t.asyncQueue,r=>qf(this.syncEngine,r,0),(function(){return Ss.C()?new Ss:new cu})())}createSyncEngine(t,r){return(function(o,a,u,l,d,p,g){let v=new Su(o,a,u,l,d,p);return g&&(v.fu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return I(this,null,function*(){var t,r;yield(function(o){return I(this,null,function*(){let a=B(o);x(fn,"RemoteStore shutting down."),a.Ia.add(5),yield ti(a),a.Ea.shutdown(),a.Aa.set("Unknown")})})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();var Jr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):dt("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Bt="FirestoreClient",Cu=class{constructor(e,t,r,i,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=pe.UNAUTHENTICATED,this.clientId=Br.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,a=>I(this,null,function*(){x(Bt,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,a=>(x(Bt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Be;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>I(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=el(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function ec(n,e){return I(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),x(Bt,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>I(null,null,function*(){r.isEqual(i)||(yield Yp(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>{Mt("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{x("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Mt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e})}function jf(n,e){return I(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Ow(n);x(Bt,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Ff(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Ff(e.remoteStore,i)),n._onlineComponents=e})}function Ow(n){return I(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){x(Bt,"Using user provided OfflineComponentProvider");try{yield ec(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===P.FAILED_PRECONDITION||i.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;Mt("Error using user provided cache. Falling back to memory cache: "+t),yield ec(n,new hm)}}else x(Bt,"Using default OfflineComponentProvider"),yield ec(n,new Pu(void 0));return n._offlineComponents})}function dm(n){return I(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(x(Bt,"Using user provided OnlineComponentProvider"),yield jf(n,n._uninitializedComponentsProvider._online)):(x(Bt,"Using default OnlineComponentProvider"),yield jf(n,new Nw))),n._onlineComponents})}function Vw(n){return dm(n).then(e=>e.syncEngine)}function Vs(n){return I(this,null,function*(){let e=yield dm(n),t=e.eventManager;return t.onListen=vw.bind(null,e.syncEngine),t.onUnlisten=ww.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Iw.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Tw.bind(null,e.syncEngine),t})}function xw(n,e,t={}){let r=new Be;return n.asyncQueue.enqueueAndForget(()=>I(null,null,function*(){return(function(o,a,u,l,d){let p=new Jr({next:v=>{p.Ou(),a.enqueueAndForget(()=>nl(o,g));let R=v.docs.has(u);!R&&v.fromCache?d.reject(new O(P.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&v.fromCache&&l&&l.source==="server"?d.reject(new O(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),g=new Qr(Ws(u.path),p,{includeMetadataChanges:!0,ka:!0});return tl(o,g)})(yield Vs(n),n.asyncQueue,e,t,r)})),r.promise}function Lw(n,e,t={}){let r=new Be;return n.asyncQueue.enqueueAndForget(()=>I(null,null,function*(){return(function(o,a,u,l,d){let p=new Jr({next:v=>{p.Ou(),a.enqueueAndForget(()=>nl(o,g)),v.fromCache&&l.source==="server"?d.reject(new O(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),g=new Qr(u,p,{includeMetadataChanges:!0,ka:!0});return tl(o,g)})(yield Vs(n),n.asyncQueue,e,t,r)})),r.promise}function fm(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var zf=new Map;var pm="firestore.googleapis.com",Wf=!0,xs=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new O(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pm,this.ssl=Wf}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:Wf;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Jp;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<QE)throw new O(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}KI("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fm((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new O(P.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Gn=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xs({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xs(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new tc;switch(r.type){case"firstParty":return new sc(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return I(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=zf.get(t);r&&(x("ComponentProvider","Removing Datastore"),zf.delete(t),r.terminate())})(this),Promise.resolve()}};function mm(n,e,t,r={}){var i;n=De(n,Gn);let o=Tt(e),a=n._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),l=`${e}:${t}`;o&&(Ri(`https://${l}`),Pi("Firestore",!0)),a.host!==pm&&a.host!==l&&Mt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let d=Object.assign(Object.assign({},a),{host:l,ssl:o,emulatorOptions:r});if(!We(d,u)&&(n._setSettings(d),r.mockUserToken)){let p,g;if(typeof r.mockUserToken=="string")p=r.mockUserToken,g=pe.MOCK_USER;else{p=Ph(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new O(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new pe(v)}n._authCredentials=new nc(new cs(p,g))}}var pn=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},he=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ot(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ei(t,n._jsonSchema))return new n(e,r||null,new L(te.fromString(t.referencePath)))}};he._jsonSchemaVersion="firestore/documentReference/1.0",he._jsonSchema={type:ue("string",he._jsonSchemaVersion),referencePath:ue("string")};var Ot=class n extends pn{constructor(e,t,r){super(e,t,Ws(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new he(this.firestore,null,new L(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function gm(n,e,...t){if(n=se(n),Zf("collection","path",e),n instanceof Gn){let r=te.fromString(e,...t);return uf(r),new Ot(n,null,r)}{if(!(n instanceof he||n instanceof Ot))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return uf(r),new Ot(n.firestore,null,r)}}function ol(n,e,...t){if(n=se(n),arguments.length===1&&(e=Br.newId()),Zf("doc","path",e),n instanceof Gn){let r=te.fromString(e,...t);return cf(r),new he(n,null,new L(r))}{if(!(n instanceof he||n instanceof Ot))throw new O(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(te.fromString(e,...t));return cf(r),new he(n.firestore,n instanceof Ot?n.converter:null,new L(r))}}var Gf="AsyncQueue",Ls=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Rs(this,"async_queue_retry"),this.oc=()=>{let r=Za();r&&x(Gf,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=Za();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=Za();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new Be;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return I(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Jn(e))throw e;x(Gf,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,dt("INTERNAL UNHANDLED ERROR: ",Kf(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=vu.createAndSchedule(this,e,t,r,o=>this.lc(o));return this.ec.push(i),i}ac(){this.tc&&M(47125,{hc:Kf(this.tc)})}verifyOperationInProgress(){}Pc(){return I(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function Kf(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Hf(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let o of r)if(o in i&&typeof i[o]=="function")return!0;return!1})(n,["next","error","complete"])}var et=class extends Gn{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Ls,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return I(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Ls(e),this._firestoreClient=void 0,yield e}})}};function _m(n,e){let t=typeof n=="object"?n:Ht(),r=typeof n=="string"?n:e||fs,i=wn(t,"firestore").getImmediate({identifier:r});if(!i._initialized){let o=Rh("firestore");o&&mm(i,...o)}return i}function Ys(n){if(n._terminated)throw new O(P.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Mw(n),n._firestoreClient}function Mw(n){var e,t,r;let i=n._freezeSettings(),o=(function(u,l,d,p){return new lc(u,l,d,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,fm(p.experimentalLongPollingOptions),p.useFetchStreams,p.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Cu(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&(function(u){let l=u?._online.build();return{_offline:u?._offline.build(l),_online:l}})(n._componentsProvider))}var Vt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(we.fromBase64String(e))}catch(t){throw new O(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(we.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ei(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Vt._jsonSchemaVersion="firestore/bytes/1.0",Vt._jsonSchema={type:ue("string",Vt._jsonSchemaVersion),bytes:ue("string")};var Kn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Yr=class{constructor(e){this._methodName=e}};var xt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(ei(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};xt._jsonSchemaVersion="firestore/geoPoint/1.0",xt._jsonSchema={type:ue("string",xt._jsonSchemaVersion),latitude:ue("number"),longitude:ue("number")};var Lt=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==i[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ei(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new O(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Lt._jsonSchemaVersion="firestore/vectorValue/1.0",Lt._jsonSchema={type:ue("string",Lt._jsonSchemaVersion),vectorValues:ue("object")};var Fw=/^__.*__$/,ku=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms):new dn(e,this.data,t,this.fieldTransforms)}},Ms=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ym(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ec:n})}}var Du=class n{constructor(e,t,r,i,o,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Ac(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Us(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(ym(this.Ec)&&Fw.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},Nu=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Hs(e)}Dc(e,t,r,i=!1){return new Du({Ec:e,methodName:t,bc:r,path:ke.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Xs(n){let e=n._freezeSettings(),t=Hs(n._databaseId);return new Nu(n._databaseId,!!e.ignoreUndefinedProperties,t)}function vm(n,e,t,r,i,o={}){let a=n.Dc(o.merge||o.mergeFields?2:0,e,t,i);al("Data must be an object, but it was:",a,r);let u=Im(r,a),l,d;if(o.merge)l=new xe(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){let p=[];for(let g of o.mergeFields){let v=Ou(e,g,t);if(!a.contains(v))throw new O(P.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);wm(p,v)||p.push(v)}l=new xe(p),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new ku(new Ce(u),l,d)}var Fs=class n extends Yr{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function Uw(n,e,t,r){let i=n.Dc(1,e,t);al("Data must be an object, but it was:",i,r);let o=[],a=Ce.empty();qt(r,(l,d)=>{let p=cl(e,l,t);d=se(d);let g=i.gc(p);if(d instanceof Fs)o.push(p);else{let v=ri(d,g);v!=null&&(o.push(p),a.set(p,v))}});let u=new xe(o);return new Ms(a,u,i.fieldTransforms)}function Bw(n,e,t,r,i,o){let a=n.Dc(1,e,t),u=[Ou(e,r,t)],l=[i];if(o.length%2!=0)throw new O(P.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<o.length;v+=2)u.push(Ou(e,o[v])),l.push(o[v+1]);let d=[],p=Ce.empty();for(let v=u.length-1;v>=0;--v)if(!wm(d,u[v])){let R=u[v],k=l[v];k=se(k);let V=a.gc(R);if(k instanceof Fs)d.push(R);else{let D=ri(k,V);D!=null&&(d.push(R),p.set(R,D))}}let g=new xe(d);return new Ms(p,g,a.fieldTransforms)}function qw(n,e,t,r=!1){return ri(t,n.Dc(r?4:3,e))}function ri(n,e){if(Em(n=se(n)))return al("Unsupported field value:",e,n),Im(n,e);if(n instanceof Yr)return(function(r,i){if(!ym(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let o=r._toFieldTransform(i);o&&i.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(r,i){let o=[],a=0;for(let u of r){let l=ri(u,i.yc(a));l==null&&(l={nullValue:"NULL_VALUE"}),o.push(l),a++}return{arrayValue:{values:o}}})(n,e)}return(function(r,i){if((r=se(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return AE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let o=le.fromDate(r);return{timestampValue:Es(i.serializer,o)}}if(r instanceof le){let o=new le(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Es(i.serializer,o)}}if(r instanceof xt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Vt)return{bytesValue:jp(i.serializer,r._byteString)};if(r instanceof he){let o=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Hu(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Lt)return(function(a,u){return{mapValue:{fields:{[$u]:{stringValue:ju},[Ln]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw u.wc("VectorValues must only contain numeric values.");return Ku(u.serializer,d)})}}}}}})(r,i);throw i.wc(`Unsupported field value: ${$s(r)}`)})(n,e)}function Im(n,e){let t={};return mp(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):qt(n,(r,i)=>{let o=ri(i,e.Vc(r));o!=null&&(t[r]=o)}),{mapValue:{fields:t}}}function Em(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof le||n instanceof xt||n instanceof Vt||n instanceof he||n instanceof Yr||n instanceof Lt)}function al(n,e,t){if(!Em(t)||!ep(t)){let r=$s(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function Ou(n,e,t){if((e=se(e))instanceof Kn)return e._internalPath;if(typeof e=="string")return cl(n,e);throw Us("Field path arguments must be of type string or ",n,!1,void 0,t)}var $w=new RegExp("[~\\*/\\[\\]]");function cl(n,e,t){if(e.search($w)>=0)throw Us(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Kn(...e.split("."))._internalPath}catch{throw Us(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Us(n,e,t,r,i){let o=r&&!r.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(o||a)&&(l+=" (found",o&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new O(P.INVALID_ARGUMENT,u+n+l)}function wm(n,e){return n.some(t=>t.isEqual(e))}var Bs=class{constructor(e,t,r,i,o){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new he(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Vu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ul("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Vu=class extends Bs{data(){return super.data()}};function ul(n,e){return typeof e=="string"?cl(n,e):e instanceof Kn?e._internalPath:e._delegate._internalPath}function Tm(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Xr=class{},xu=class extends Xr{};function Am(n,e,...t){let r=[];e instanceof Xr&&r.push(e),r=r.concat(t),(function(o){let a=o.filter(l=>l instanceof Lu).length,u=o.filter(l=>l instanceof qs).length;if(a>1||a>0&&u>0)throw new O(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var qs=class n extends xu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return Sm(e._query,t),new pn(e.firestore,e.converter,Tc(e._query,t))}_parse(e){let t=Xs(e.firestore);return(function(o,a,u,l,d,p,g){let v;if(d.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new O(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Jf(g,p);let k=[];for(let V of g)k.push(Qf(l,o,V));v={arrayValue:{values:k}}}else v=Qf(l,o,g)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Jf(g,p),v=qw(u,a,g,p==="in"||p==="not-in");return ce.create(d,p,v)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function bm(n,e,t){let r=e,i=ul("where",n);return qs._create(i,r,t)}var Lu=class n extends Xr{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:$e.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,o){let a=i,u=o.getFlattenedFilters();for(let l of u)Sm(a,l),a=Tc(a,l)})(e._query,t),new pn(e.firestore,e.converter,Tc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function Qf(n,e,t){if(typeof(t=se(t))=="string"){if(t==="")throw new O(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Cp(e)&&t.indexOf("/")!==-1)throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(te.fromString(t));if(!L.isDocumentKey(r))throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return gf(n,new L(r))}if(t instanceof he)return gf(n,t._key);throw new O(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$s(t)}.`)}function Jf(n,e){if(!Array.isArray(n)||n.length===0)throw new O(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Sm(n,e){let t=(function(i,o){for(let a of i)for(let u of a.getFlattenedFilters())if(o.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new O(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new O(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Mu=class{convertValue(e,t="none"){switch(Ft(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(pt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw M(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return qt(e,(i,o)=>{r[i]=this.convertValue(o,t)}),r}convertVectorValue(e){var t,r,i;let o=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Ln].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>ee(a.doubleValue));return new Lt(o)}convertGeoPoint(e){return new xt(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=zs(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(jr(e));default:return null}}convertTimestamp(e){let t=ft(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=te.fromString(e);Q(Qp(r),9688,{name:e});let i=new ps(r.get(1),r.get(3)),o=new L(r.popFirst(5));return i.isEqual(t)||dt(`Document ${o} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}};function Rm(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var rn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},sn=class n extends Bs{constructor(e,t,r,i,o,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Vn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(ul("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};sn._jsonSchemaVersion="firestore/documentSnapshot/1.0",sn._jsonSchema={type:ue("string",sn._jsonSchemaVersion),bundleSource:ue("string","DocumentSnapshot"),bundleName:ue("string"),bundle:ue("string")};var Vn=class extends sn{data(e={}){return super.data(e)}},on=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new rn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Vn(this._firestore,this._userDataWriter,r.key,r,new rn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,o){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new Vn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new rn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>o||u.type!==3).map(u=>{let l=new Vn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new rn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,p=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:jw(u.type),doc:l,oldIndex:d,newIndex:p}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Br.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(o=>{o._document!==null&&(t.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),i.push(o.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function jw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:n})}}function Pm(n){n=De(n,he);let e=De(n.firestore,et);return xw(Ys(e),n._key).then(t=>Om(e,n,t))}on._jsonSchemaVersion="firestore/querySnapshot/1.0",on._jsonSchema={type:ue("string",on._jsonSchemaVersion),bundleSource:ue("string","QuerySnapshot"),bundleName:ue("string"),bundle:ue("string")};var Zr=class extends Mu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new he(this.firestore,null,t)}};function Cm(n){n=De(n,pn);let e=De(n.firestore,et),t=Ys(e),r=new Zr(e);return Tm(n._query),Lw(t,n._query).then(i=>new on(e,r,n,i))}function km(n,e,t){n=De(n,he);let r=De(n.firestore,et),i=Rm(n.converter,e,t);return hl(r,[vm(Xs(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,ht.none())])}function Dm(n,e,t,...r){n=De(n,he);let i=De(n.firestore,et),o=Xs(i),a;return a=typeof(e=se(e))=="string"||e instanceof Kn?Bw(o,"updateDoc",n._key,e,t,r):Uw(o,"updateDoc",n._key,e),hl(i,[a.toMutation(n._key,ht.exists(!0))])}function Nm(n,e){let t=De(n.firestore,et),r=ol(n),i=Rm(n.converter,e);return hl(t,[vm(Xs(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,ht.exists(!1))]).then(()=>r)}function ll(n,...e){var t,r,i;n=se(n);let o={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Hf(e[a])||(o=e[a++]);let u={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Hf(e[a])){let g=e[a];e[a]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[a+1]=(r=g.error)===null||r===void 0?void 0:r.bind(g),e[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,d,p;if(n instanceof he)d=De(n.firestore,et),p=Ws(n._key.path),l={next:g=>{e[a]&&e[a](Om(d,n,g))},error:e[a+1],complete:e[a+2]};else{let g=De(n,pn);d=De(g.firestore,et),p=g._query;let v=new Zr(d);l={next:R=>{e[a]&&e[a](new on(d,v,g,R))},error:e[a+1],complete:e[a+2]},Tm(n._query)}return(function(v,R,k,V){let D=new Jr(V),$=new Qr(R,D,k);return v.asyncQueue.enqueueAndForget(()=>I(null,null,function*(){return tl(yield Vs(v),$)})),()=>{D.Ou(),v.asyncQueue.enqueueAndForget(()=>I(null,null,function*(){return nl(yield Vs(v),$)}))}})(Ys(d),p,u,l)}function hl(n,e){return(function(r,i){let o=new Be;return r.asyncQueue.enqueueAndForget(()=>I(null,null,function*(){return Aw(yield Vw(r),i,o)})),o.promise})(Ys(n),e)}function Om(n,e,t){let r=t.docs.get(e._key),i=new Zr(n);return new sn(n,i,e._key,r,new rn(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(i){Hn=i})(bt),Fe(new Se("firestore",(r,{instanceIdentifier:i,options:o})=>{let a=r.getProvider("app").getImmediate(),u=new et(new rc(r.getProvider("auth-internal")),new oc(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ps(d.options.projectId,p)})(a,i),a);return o=Object.assign({useFetchStreams:t},o),u._setSettings(o),u},"PUBLIC").setMultipleInstances(!0)),re(rf,sf,e),re(rf,sf,"esm2017")})();var Zs=function(){return Zs=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Zs.apply(this,arguments)};var Gw={includeMetadataChanges:!1};function Vm(n,e){return e===void 0&&(e=Gw),new it(function(t){var r=ll(n,e,{next:t.next.bind(t),error:t.error.bind(t),complete:t.complete.bind(t)});return{unsubscribe:r}})}function xm(n,e){var t;e===void 0&&(e={});var r=n.data(e);return!n.exists()||typeof r!="object"||r===null||!e.idField?r:Zs(Zs({},r),(t={},t[e.idField]=n.id,t))}function Lm(n){return Vm(n,{includeMetadataChanges:!0}).pipe(Do(function(e){return e.docs}))}function Mm(n,e){return e===void 0&&(e={}),Lm(n).pipe(Do(function(t){return t.map(function(r){return xm(r,e)})}))}var ii=class{constructor(e){return e}},Fm="firestore",dl=class{constructor(){return An(Fm)}};var fl=new In("angularfire2.firestore-instances");function Kw(n,e){let t=Tr(Fm,n,e);return t&&new ii(t)}function Hw(n){return(e,t)=>{let r=e.runOutsideAngular(()=>n(t));return new ii(r)}}var Qw={provide:dl,deps:[[new Ne,fl]]},Jw={provide:ii,useFactory:Kw,deps:[[new Ne,fl],ot]};function ES(n,...e){return re("angularfire",St.full,"fst"),En([Jw,Qw,{provide:fl,useFactory:Hw(n),multi:!0,deps:[ze,wt,Rt,Jt,[new Ne,Or],[new Ne,bn],...e]}])}var wS=fe(Mm,!0);var TS=fe(Nm,!0,2);var AS=fe(gm,!0,2);var bS=fe(ol,!0,2);var SS=fe(Pm,!0);var RS=fe(Cm,!0);var PS=fe(_m,!0);var CS=fe(Am,!0,2);var kS=fe(km,!0,2);var DS=fe(Dm,!0,2);var NS=fe(bm,!0,2);export{Rh as a,Tt as b,Ri as c,Ph as d,Pi as e,Pe as f,se as g,Se as h,zh as i,Fe as j,wn as k,Oe as l,bt as m,Ht as n,re as o,LT as p,fe as q,nA as r,rA as s,Nr as t,Ob as u,Vb as v,xb as w,ii as x,ES as y,wS as z,TS as A,AS as B,bS as C,SS as D,RS as E,PS as F,CS as G,kS as H,DS as I,NS as J};
